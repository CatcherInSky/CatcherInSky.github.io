<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"catcherinsky.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="CatcherInSky的前端知识库">
<meta property="og:type" content="website">
<meta property="og:title" content="Knowlegde Bases of CatcherInSky">
<meta property="og:url" content="http://catcherinsky.github.io/index.html">
<meta property="og:site_name" content="Knowlegde Bases of CatcherInSky">
<meta property="og:description" content="CatcherInSky的前端知识库">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="CatcherInSky">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://catcherinsky.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Knowlegde Bases of CatcherInSky</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
  <meta name="referrer" content="same-origin">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Knowlegde Bases of CatcherInSky</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">CatcherInSky的前端知识库</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2022/02/08/%E6%89%8B%E5%86%99Promise/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/02/08/%E6%89%8B%E5%86%99Promise/" class="post-title-link" itemprop="url">手写Promise</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-02-08 14:13:22" itemprop="dateCreated datePublished" datetime="2022-02-08T14:13:22+08:00">2022-02-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:01" itemprop="dateModified" datetime="2022-02-14T19:41:01+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">promise</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="comment">// fn的入参是resolve和reject</span></span><br><span class="line">  <span class="comment">// 全局变量</span></span><br><span class="line">  <span class="keyword">let</span> state = <span class="string">&quot;pending&quot;</span>;</span><br><span class="line">  <span class="keyword">let</span> value = <span class="literal">null</span>;</span><br><span class="line">  <span class="comment">// 队列中元素为&#123;onFulfiled, resolve&#125; 成功函数和resolve函数</span></span><br><span class="line">  <span class="keyword">const</span> callbacks = [];</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 执行函数，函数执行完成后调用resolve</span></span><br><span class="line">  <span class="title function_">fn</span>(resolve);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在fn处理完成后被调用</span></span><br><span class="line">  <span class="comment">// 下一个宏任务修改value，并调用队列中的then函数</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">resolve</span>(<span class="params">newValue</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 改变Promise对象的状态</span></span><br><span class="line">      <span class="keyword">if</span> (state !== <span class="string">&quot;pending&quot;</span>) <span class="keyword">return</span>;</span><br><span class="line">      <span class="comment">// 如果callback.onFulfilled返回的是一个promise对象3，提取then方法</span></span><br><span class="line">      <span class="keyword">if</span> (</span><br><span class="line">        newValue &amp;&amp;</span><br><span class="line">        (<span class="keyword">typeof</span> newValue === <span class="string">&quot;object&quot;</span> || <span class="keyword">typeof</span> newValue === <span class="string">&quot;function&quot;</span>)</span><br><span class="line">      ) &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; then &#125; = newValue;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">          <span class="comment">// 相当于调用了3的then方法，注入了2的resolve 为其回调</span></span><br><span class="line">          then.<span class="title function_">call</span>(newValue, resolve);</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      state = <span class="string">&quot;fulfilled&quot;</span>;</span><br><span class="line">      value = newValue;</span><br><span class="line">      <span class="title function_">handleCb</span>();</span><br><span class="line">    &#125;, <span class="number">0</span>); <span class="comment">// PromiseA+规范，但不是微任务</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 依次取出队列中的then函数并完成</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handleCb</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">while</span> (callbacks.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> fulfiledFn = callbacks.<span class="title function_">shift</span>();</span><br><span class="line">      <span class="title function_">handle</span>(fulfiledFn);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理then函数</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">handle</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="comment">// 调用then进入此分支</span></span><br><span class="line">    <span class="keyword">if</span> (state === <span class="string">&quot;pending&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 任务未完成存入队列中</span></span><br><span class="line">      callbacks.<span class="title function_">push</span>(callback);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 调用resolve进入此分支</span></span><br><span class="line">    <span class="keyword">if</span> (state === <span class="string">&quot;fulfilled&quot;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!callback.<span class="property">onFulfilled</span>) &#123;</span><br><span class="line">        <span class="comment">// 没有注册成功函数，下一个宏任务设置value</span></span><br><span class="line">        callback.<span class="title function_">resolve</span>(value);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 调用成功函数处理value</span></span><br><span class="line">        <span class="keyword">const</span> ret = callback.<span class="title function_">onFulfilled</span>(value);</span><br><span class="line">        <span class="comment">// 下一个宏任务改变value</span></span><br><span class="line">        callback.<span class="title function_">resolve</span>(ret);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 原promise对象1，then函数中新注册一个promise对象2</span></span><br><span class="line">  <span class="comment">// 1resolve后，value通过onFulFilled传入2，并在2的下一个宏任务设置为2的value</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">then</span> = <span class="keyword">function</span> (<span class="params">onFulfilled</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">promise</span>(<span class="function">(<span class="params">resove</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 构造一个callback对象，使用1的handle函数，插入1的队列中</span></span><br><span class="line">      <span class="comment">// 当callback被执行时，调用2的resolve函数，改变2的value</span></span><br><span class="line">      <span class="title function_">handle</span>(&#123;</span><br><span class="line">        onFulFilled,</span><br><span class="line">        resolve,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h2><h3 id="done"><a href="#done" class="headerlink" title="done"></a>done</h3><p>done 相当于提供了一个不会出错的 catch 方法，并且不再返回一个 promise ，一般用来结束一个 promise 链</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">done</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">catch</span>(<span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;done&#x27;</span>, reason);</span><br><span class="line">        <span class="keyword">throw</span> reason;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="finally"><a href="#finally" class="headerlink" title="finally"></a>finally</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">finally</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">then</span>(<span class="function"><span class="params">value</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fn</span>();</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;, <span class="function"><span class="params">reason</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fn</span>();</span><br><span class="line">        <span class="keyword">throw</span> reason;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h2><h3 id="all"><a href="#all" class="headerlink" title="all"></a>all</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">promise.<span class="property">all</span> = <span class="function">(<span class="params">promises</span>) =&gt;</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promises.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promises[i])</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          res.<span class="title function_">push</span>(data);</span><br><span class="line">          <span class="keyword">if</span> (res.<span class="property">length</span> === promises.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">reject</span>(err));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="allSettled"><a href="#allSettled" class="headerlink" title="allSettled"></a>allSettled</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">promise.<span class="property">all</span> = <span class="function">(<span class="params">promises</span>) =&gt;</span></span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> res = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promises.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promises[i])</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">          res.<span class="title function_">push</span>(&#123; <span class="attr">status</span>: <span class="string">&quot;fullfilled&quot;</span>, <span class="attr">value</span>: data &#125;);</span><br><span class="line">          <span class="keyword">if</span> (res.<span class="property">length</span> === promises.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>(err);</span><br><span class="line">          res.<span class="title function_">push</span>(&#123; <span class="attr">status</span>: <span class="string">&quot;rejected&quot;</span>, <span class="attr">reason</span>: err &#125;);</span><br><span class="line">          <span class="keyword">if</span> (res.<span class="property">length</span> === promises.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="title function_">resolve</span>(res);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="race"><a href="#race" class="headerlink" title="race"></a>race</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">promise.<span class="property">race</span> = <span class="keyword">function</span> (<span class="params">promises</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; promises.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(promises[i])</span><br><span class="line">        .<span class="title function_">then</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="title function_">resolve</span>(data))</span><br><span class="line">        .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">reject</span>(err));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="Timeout"><a href="#Timeout" class="headerlink" title="Timeout"></a>Timeout</h2><p>超时</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">promiseTimeout</span>(<span class="params">fn, delay</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> timeout = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">reslove, reject</span>) &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">reject</span>(<span class="string">&quot;超时啦~&quot;</span>);</span><br><span class="line">    &#125;, delay);</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">race</span>([timeout, fn]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="LazyMan"><a href="#LazyMan" class="headerlink" title="LazyMan"></a>LazyMan</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">LazyMan</span>(<span class="string">&quot;Tony&quot;</span>)</span><br><span class="line">  .<span class="title function_">eat</span>(<span class="string">&quot;lunch&quot;</span>)</span><br><span class="line">  .<span class="title function_">eat</span>(<span class="string">&quot;dinner&quot;</span>)</span><br><span class="line">  .<span class="title function_">sleep</span>(<span class="number">10</span>)</span><br><span class="line">  .<span class="title function_">sleepFirst</span>(<span class="number">5</span>)</span><br><span class="line">  .<span class="title function_">eat</span>(<span class="string">&quot;junk food&quot;</span>);</span><br><span class="line"><span class="comment">// Hi I am Tony</span></span><br><span class="line"><span class="comment">// 等待了5秒...</span></span><br><span class="line"><span class="comment">// I am eating lunch</span></span><br><span class="line"><span class="comment">// I am eating dinner</span></span><br><span class="line"><span class="comment">// 等待了10秒...</span></span><br><span class="line"><span class="comment">// I am eating junk food</span></span><br></pre></td></tr></table></figure>

<ol>
<li>构造时接收名字，并打印.</li>
<li>链式调用.</li>
<li>eat(food):直接打印.</li>
<li>sleep(t):真实的等待了 t 秒.</li>
<li>sleepFirst(t):与 sleep 基本功能 一样，但它必须紧跟着打印名字之后执行。</li>
</ol>
<h3 id="async-await-实现"><a href="#async-await-实现" class="headerlink" title="async/await 实现"></a>async/await 实现</h3><p>返回当前实例实现链式调用<br>每次增加队列防抖调用，或者也可以在初始化的时候设置一个 setTimeout 任务</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LazyMan</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stack</span> = [];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">action</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="built_in">clearTimeout</span>(<span class="variable language_">this</span>.<span class="property">timer</span>);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">timer</span> = <span class="built_in">setTimeout</span>(<span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">      <span class="keyword">while</span> (<span class="variable language_">this</span>.<span class="property">stack</span>.<span class="property">length</span>) &#123;</span><br><span class="line">        <span class="keyword">await</span> <span class="variable language_">this</span>.<span class="property">stack</span>.<span class="title function_">shift</span>()();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">eat</span>(<span class="params">food</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stack</span>.<span class="title function_">push</span>(<span class="function">() =&gt;</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>().<span class="title function_">then</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(food)));</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">action</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sleep</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stack</span>.<span class="title function_">push</span>(</span><br><span class="line">      <span class="function">() =&gt;</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span></span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`sleep for <span class="subst">$&#123;time&#125;</span>`</span>);</span><br><span class="line">            <span class="title function_">resolve</span>();</span><br><span class="line">          &#125;, time * <span class="number">1000</span>)</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">action</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">sleepFirst</span>(<span class="params">time</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">stack</span>.<span class="title function_">unshift</span>(</span><br><span class="line">      <span class="function">() =&gt;</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve</span>) =&gt;</span></span><br><span class="line">          <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`sleep first for <span class="subst">$&#123;time&#125;</span>`</span>);</span><br><span class="line">            <span class="title function_">resolve</span>();</span><br><span class="line">          &#125;, time * <span class="number">1000</span>)</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">action</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SinglePipe"><a href="#SinglePipe" class="headerlink" title="SinglePipe"></a>SinglePipe</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">singlePipe</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="comment">//</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> request = <span class="title function_">singlePipe</span>(</span><br><span class="line">  <span class="function">() =&gt;</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="keyword">function</span> (<span class="params">resolve</span>) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(value);</span><br><span class="line">      &#125;, <span class="number">1000</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="title function_">request</span>(<span class="number">1</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value));</span><br><span class="line"><span class="title function_">request</span>(<span class="number">2</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value)); <span class="comment">// 不响应</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="title function_">request</span>(<span class="number">3</span>).<span class="title function_">then</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(value)), <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">singlePipe</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> on = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">async</span> (...args) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (on) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;last pipe is running&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">reject</span>(<span class="string">&quot;no&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      on = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">const</span> res = <span class="keyword">await</span> <span class="title function_">fn</span>(...args);</span><br><span class="line">      on = <span class="literal">false</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(res);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6865704100353277965">https://juejin.cn/post/6865704100353277965</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/7059764650425974814?utm_source=gold_browser_extension">https://juejin.cn/post/7059764650425974814?utm_source=gold_browser_extension</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2022/01/25/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/25/%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82/" class="post-title-link" itemprop="url">网络请求</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-25 16:10:25" itemprop="dateCreated datePublished" datetime="2022-01-25T16:10:25+08:00">2022-01-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:01" itemprop="dateModified" datetime="2022-02-14T19:41:01+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="ajax"><a href="#ajax" class="headerlink" title="ajax"></a>ajax</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ajax</span>(<span class="params">&#123; method = <span class="string">&quot;get&quot;</span>, url, <span class="keyword">async</span> = <span class="literal">true</span>, data, timeout = <span class="number">0</span> &#125;</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line">  xhr.<span class="property">timeout</span> = timeout;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    xhr.<span class="property">ontimeout</span> = <span class="function">() =&gt;</span> <span class="title function_">reject</span>(<span class="string">&quot;请求超时&quot;</span>);</span><br><span class="line">    xhr.<span class="property">onerror</span> = <span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">reject</span>(err);</span><br><span class="line"></span><br><span class="line">    xhr.<span class="property">onreadystatechange</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (xhr.<span class="property">readyState</span> == <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((xhr.<span class="property">status</span> &gt;= <span class="number">200</span> &amp;&amp; xhr.<span class="property">status</span> &lt; <span class="number">300</span>) || xhr.<span class="property">status</span> == <span class="number">304</span>) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(xhr.<span class="property">responseText</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="title function_">reject</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> paramArr = [];</span><br><span class="line">    <span class="keyword">let</span> encodeData;</span><br><span class="line">    <span class="keyword">if</span> (data <span class="keyword">instanceof</span> <span class="title class_">Object</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> data) &#123;</span><br><span class="line">        <span class="comment">// 参数拼接需要通过 encodeURIComponent 进行编码</span></span><br><span class="line">        paramArr.<span class="title function_">push</span>(</span><br><span class="line">          <span class="built_in">encodeURIComponent</span>(key) + <span class="string">&quot;=&quot;</span> + <span class="built_in">encodeURIComponent</span>(data[key])</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      encodeData = paramArr.<span class="title function_">join</span>(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&quot;get&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 检测 url 中是否已存在 ? 及其位置</span></span><br><span class="line">      <span class="keyword">const</span> index = url.<span class="title function_">indexOf</span>(<span class="string">&quot;?&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span> (index === -<span class="number">1</span>) url += <span class="string">&quot;?&quot;</span>;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (index !== url.<span class="property">length</span> - <span class="number">1</span>) url += <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line">      <span class="comment">// 拼接 url</span></span><br><span class="line">      url += encodeData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xhr.<span class="title function_">open</span>(method, url, <span class="keyword">async</span>);</span><br><span class="line">    <span class="keyword">if</span> (method === <span class="string">&quot;get&quot;</span>) xhr.<span class="title function_">send</span>(<span class="literal">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// post 方式需要设置请求头</span></span><br><span class="line">      xhr.<span class="title function_">setRequestHeader</span>(</span><br><span class="line">        <span class="string">&quot;Content-Type&quot;</span>,</span><br><span class="line">        <span class="string">&quot;application/x-www-form-urlencoded;charset=UTF-8&quot;</span></span><br><span class="line">      );</span><br><span class="line">      xhr.<span class="title function_">send</span>(encodeData);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
<h2 id="fetch"><a href="#fetch" class="headerlink" title="fetch"></a>fetch</h2><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/27776535">https://zhuanlan.zhihu.com/p/27776535</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2022/01/24/%E6%8E%92%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/24/%E6%8E%92%E5%BA%8F/" class="post-title-link" itemprop="url">排序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-24 22:36:31" itemprop="dateCreated datePublished" datetime="2022-01-24T22:36:31+08:00">2022-01-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:01" itemprop="dateModified" datetime="2022-02-14T19:41:01+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="https://cdn.nlark.com/yuque/0/2022/webp/106384/1643035020340-79727566-7e6e-44e5-a65e-f3c1c335baf4.webp#clientId=u970ece17-dab9-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=uf4fc6c74&margin=%5Bobject%20Object%5D&originHeight=734&originWidth=1304&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u1630befa-8875-4110-a9ec-fdc781376d6&title="></p>
<h2 id="冒泡"><a href="#冒泡" class="headerlink" title="冒泡"></a>冒泡</h2><p>相邻的数据进行两两比较，小数放在前面，大数放在后面，需要用到两层 for 循环</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//冒泡O(n^2)</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">bubbleSort</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> length = arr.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; length - <span class="number">1</span> - i; ++j) &#123;</span><br><span class="line">      <span class="keyword">if</span> (arr[j] &gt; arr[j + <span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="keyword">let</span> temp = arr[j];</span><br><span class="line">        arr[j] = arr[j + <span class="number">1</span>];</span><br><span class="line">        arr[j + <span class="number">1</span>] = temp;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="复杂度"><a href="#复杂度" class="headerlink" title="复杂度"></a>复杂度</h3><p>两层 for 循环<br>O(n2)</p>
<h2 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h2><p>先在未排序序列中找到最小（大）元素，存放到排序序列的起始位置，然后，再从剩余未排序元素中继续寻找最小（大）元素，然后放到已排序序列的末尾。以此类推，直到所有元素均排序完毕。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">selectionSort</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line"> <span class="keyword">let</span> length = arr.<span class="property">length</span>,indexMin;</span><br><span class="line"> <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;length-<span class="number">1</span>;++i)&#123;</span><br><span class="line">  indexMin = i;</span><br><span class="line">  <span class="keyword">for</span>(<span class="keyword">let</span> j = i;j&lt;length;++j)&#123;</span><br><span class="line">   <span class="keyword">if</span>(arr[indexMin]&gt;arr[j])&#123;</span><br><span class="line">    indexMin = j;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(i!=indexMin)&#123;</span><br><span class="line">   <span class="keyword">let</span> temp = arr[i];</span><br><span class="line">    arr[i]=arr[indexMin];</span><br><span class="line">    arr[indexMin]=temp;</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="复杂度-1"><a href="#复杂度-1" class="headerlink" title="复杂度"></a>复杂度</h3><p>两层 for 循环<br>O(n2)</p>
<h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><p>开辟新数组，读取旧数组，按序插入新数组</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">insertionSort</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> length = arr.<span class="property">length</span>,</span><br><span class="line">    j,</span><br><span class="line">    temp;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt; ength; ++i) &#123;</span><br><span class="line">    j = i;</span><br><span class="line">    temp = arr[i];</span><br><span class="line">    <span class="keyword">while</span> (j &gt; <span class="number">0</span> &amp;&amp; arr[j - <span class="number">1</span>] &gt; temp) &#123;</span><br><span class="line">      arr[j] = arr[j - <span class="number">1</span>];</span><br><span class="line">      j--;</span><br><span class="line">    &#125;</span><br><span class="line">    arr[j] = temp;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="复杂度-2"><a href="#复杂度-2" class="headerlink" title="复杂度"></a>复杂度</h3><p>O(1)的额外空间<br>两层 for 循环<br>O(n2)</p>
<h2 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h2><p>分治， 在数据结构中选择一个元素作为基准，参照基准元素值的大小，划分无序区，所有小于基准元素的数据放入一个区间，所有大于基准元素的数据放入另一区间，递归完成</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">quickSort</span>=(<span class="params">arr</span>)=&gt;&#123;</span><br><span class="line"> <span class="title function_">quick</span>(arr,<span class="number">0</span>,arr.<span class="property">length</span>-<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> quick = (arr,left,right)&#123;</span><br><span class="line"> <span class="keyword">let</span> index</span><br><span class="line"> <span class="keyword">if</span>(arr.<span class="property">length</span>&gt;<span class="number">1</span>)&#123;</span><br><span class="line">  index = <span class="title function_">partition</span>(arr,left,right)</span><br><span class="line">  <span class="keyword">if</span>(left&lt;index-<span class="number">1</span>)&#123;</span><br><span class="line">   <span class="title function_">quick</span>(arr,left,index-<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(index&lt;right)&#123;</span><br><span class="line">   <span class="title function_">quick</span>(arr,index,right)</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">partition</span>=(<span class="params">arr,left,right</span>)=&gt;&#123;</span><br><span class="line"> <span class="keyword">let</span> pivot = arr[<span class="title class_">Math</span>.<span class="title function_">floor</span>((right+left)/<span class="number">2</span>)],</span><br><span class="line">  i=left,j=right;</span><br><span class="line"> <span class="keyword">while</span>(i&lt;=j)&#123;</span><br><span class="line">  <span class="keyword">while</span>(arr[i]&lt;pivot)&#123;</span><br><span class="line">   ++i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span>(arr[j]&gt;pivot)&#123;</span><br><span class="line">   j--</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(i&lt;=j)&#123;</span><br><span class="line">   <span class="keyword">let</span> temp = arr[j]</span><br><span class="line">   arr[j]=arr[i]</span><br><span class="line">   arr[i] = temp</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="复杂度-3"><a href="#复杂度-3" class="headerlink" title="复杂度"></a>复杂度</h3><p>分治<br>O(n logn)</p>
<h2 id="希尔"><a href="#希尔" class="headerlink" title="希尔"></a>希尔</h2><p>是插入排序的一种进</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">shellSort</span>(<span class="params">arr: number[]</span>) &#123;</span><br><span class="line">  <span class="comment">//获取增量</span></span><br><span class="line">  <span class="keyword">let</span> gap = <span class="title class_">Math</span>.<span class="title function_">floor</span>(arr.<span class="property">length</span> / <span class="number">2</span>);</span><br><span class="line">  <span class="comment">//增量等于1 即为 插入排序 原始。 一定会将数组排好 这个时候结束循环</span></span><br><span class="line">  <span class="keyword">while</span> (gap &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="comment">//进行插入排序</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = gap; i &lt; arr.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">let</span> j = i;</span><br><span class="line">      <span class="keyword">let</span> temp = arr[i];</span><br><span class="line">      <span class="keyword">while</span> (j &gt; gap - <span class="number">1</span> &amp;&amp; arr[j - gap] &gt; temp) &#123;</span><br><span class="line">        arr[j] = arr[j - gap];</span><br><span class="line">        j -= gap;</span><br><span class="line">      &#125;</span><br><span class="line">      arr[j] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//缩小增量</span></span><br><span class="line">    gap = <span class="title class_">Math</span>.<span class="title function_">floor</span>(gap / <span class="number">2</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> arr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="复杂度-4"><a href="#复杂度-4" class="headerlink" title="复杂度"></a>复杂度</h3><p>复杂度为被猜测 为 O (N ^1.3)</p>
<h2 id="归并"><a href="#归并" class="headerlink" title="归并"></a>归并</h2><p>分治 将数组 分成两半 递归进行 直到 数组长度 小于等于 1</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">mergeSort</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">  arr = <span class="title function_">mergeSortRec</span>(arr);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">mergeSortRec</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> length = arr.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">if</span> (length == <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> arr;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> mid = <span class="title class_">Math</span>.<span class="title function_">floor</span>(length / <span class="number">2</span>);</span><br><span class="line">  left = arr.<span class="title function_">slice</span>(<span class="number">0</span>, mid);</span><br><span class="line">  right = arr.<span class="title function_">slice</span>(mid, length);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">merge</span>(<span class="title function_">mergeSortRec</span>(left), <span class="title function_">mergeSortRec</span>(right));</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">merge</span> = (<span class="params">left, right</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> result = [],</span><br><span class="line">    il = <span class="number">0</span>,</span><br><span class="line">    ir = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (il &lt; left.<span class="property">length</span> &amp;&amp; ir &lt; right.<span class="property">length</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (left[il] &lt; right[ir]) &#123;</span><br><span class="line">      result.<span class="title function_">push</span>(left[il++]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result.<span class="title function_">push</span>(right[ir++]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (il &lt; left.<span class="property">length</span>) &#123;</span><br><span class="line">    result.<span class="title function_">push</span>(left[il++]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> (ir &lt; right.<span class="property">length</span>) &#123;</span><br><span class="line">    result.<span class="title function_">push</span>(right[ir++]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="复杂度-5"><a href="#复杂度-5" class="headerlink" title="复杂度"></a>复杂度</h3><h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="堆排"><a href="#堆排" class="headerlink" title="堆排"></a>堆排</h2><p>对一颗完全二叉树，作为数组，某节点 i 父节点为 Math.floor((i-1)/2),子节点 2i+1,2i+2</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">heapSort</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> heapSize = arr.<span class="property">length</span>;</span><br><span class="line">  <span class="title function_">buildHeap</span>(arr);</span><br><span class="line">  <span class="keyword">while</span> (heapSize &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    heapSize--;</span><br><span class="line">    [arr[<span class="number">0</span>], arr[heapSize]] = [arr[heapSize], arr[<span class="number">0</span>]];</span><br><span class="line">    <span class="title function_">heapify</span>(arr, heapSize, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">buildHeap</span> = (<span class="params">arr</span>) =&gt; &#123;</span><br><span class="line">  heapSize = arr.<span class="property">length</span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="title class_">Math</span>.<span class="title function_">floor</span>(arr.<span class="property">length</span> / <span class="number">2</span>); i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">    <span class="title function_">heapify</span>(arr, heapSize, i);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">heapify</span> = (<span class="params">arr, heapSize, i</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> left = <span class="number">2</span> * i + <span class="number">1</span>,</span><br><span class="line">    right = i * <span class="number">2</span> + <span class="number">2</span>,</span><br><span class="line">    largest = i;</span><br><span class="line">  <span class="keyword">if</span> (left &lt; heapSize &amp;&amp; arr[left] &gt; arr[largest]) &#123;</span><br><span class="line">    largest = left;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (right &lt; heapSize &amp;&amp; arr[right] &gt; arr[largest]) &#123;</span><br><span class="line">    largest = right;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (largest != i) &#123;</span><br><span class="line">    [arr[i], arr[largest]] = [arr[largest], arr[i]];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="复杂度-6"><a href="#复杂度-6" class="headerlink" title="复杂度"></a>复杂度</h3><h2 id="计数"><a href="#计数" class="headerlink" title="计数"></a>计数</h2><p>计数排序是一个分布式排序 , 它是用来排序整数的优秀算法（它是一个整数排序算法），时间复杂度为 O(n+k)，其中 k 是 临时计数数组的大小；但是，它确实需要更多的内存来存放临时数组。<br>将每个数 当作索引 存进 数组(count)中，如果重复出现 则 索引对应的值<br><img src="https://cdn.nlark.com/yuque/0/2022/png/106384/1643036562136-4fbe9ead-7429-4732-8733-754051d6b087.png#clientId=u970ece17-dab9-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u44f8f02d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=295&originWidth=637&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=76496&status=done&style=none&taskId=uccb9aebf-956b-4bb9-8291-2dfffce2d1a&title=" alt="image.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">countingSort</span>(<span class="params">arr: number[]</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> count = []; <span class="comment">//计数</span></span><br><span class="line">  <span class="keyword">let</span> result = []; <span class="comment">//结果</span></span><br><span class="line">  arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//将每个数字 以索引 存入 count中</span></span><br><span class="line">    <span class="keyword">if</span> (!count[el]) &#123;</span><br><span class="line">      count[el] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    count[el]++;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  count.<span class="title function_">forEach</span>(<span class="function">(<span class="params">el, i</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//将count 取出</span></span><br><span class="line">    <span class="keyword">if</span> (el &amp;&amp; el &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; el; j++) &#123;</span><br><span class="line">        result.<span class="title function_">push</span>(i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="复杂度-7"><a href="#复杂度-7" class="headerlink" title="复杂度"></a>复杂度</h3><p>空间复杂度 ON</p>
<h2 id="桶排"><a href="#桶排" class="headerlink" title="桶排"></a>桶排</h2><p>桶排序（也被称为箱排序）也是分布式排序算法，它将元素分为不同的桶（较小的数组）， 再使用一个简单的排序算法，例如插入排序（用来排序小数组的不错的算法），来对每个桶进行 排序。然后，它将所有的桶合并为结果数组。</p>
<h3 id="复杂度-8"><a href="#复杂度-8" class="headerlink" title="复杂度"></a>复杂度</h3><p>​</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903814575685646">https://juejin.cn/post/6844903814575685646</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/114851128">https://zhuanlan.zhihu.com/p/114851128</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2022/01/22/%E7%B1%BB%E5%9E%8B%E4%BD%93%E6%93%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/22/%E7%B1%BB%E5%9E%8B%E4%BD%93%E6%93%8D/" class="post-title-link" itemprop="url">类型体操</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-22 11:24:41" itemprop="dateCreated datePublished" datetime="2022-01-22T11:24:41+08:00">2022-01-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:01" itemprop="dateModified" datetime="2022-02-14T19:41:01+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="操作符"><a href="#操作符" class="headerlink" title="操作符"></a>操作符</h2><h3 id="extends"><a href="#extends" class="headerlink" title="extends"></a>extends</h3><p>约束，约束泛型为某类型</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">TupleToObject</span>&lt;T <span class="keyword">extends</span> <span class="keyword">readonly</span> (<span class="built_in">string</span> | symbol | <span class="built_in">number</span>)[]&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> T[<span class="built_in">number</span>]]: P;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="in"><a href="#in" class="headerlink" title="in"></a>in</h3><p>联合类型 <code>|</code> 的集合</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Keys</span> = <span class="string">&quot;option1&quot;</span> | <span class="string">&quot;option2&quot;</span>;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Flags</span> = &#123; [K <span class="keyword">in</span> <span class="title class_">Keys</span>]: <span class="built_in">boolean</span> &#125;;</span><br></pre></td></tr></table></figure>

<h3 id="keyof"><a href="#keyof" class="headerlink" title="keyof"></a>keyof</h3><p>结构对象生成联合类型<br>​</p>
<h3 id="infer"><a href="#infer" class="headerlink" title="infer"></a>infer</h3><p>在 extends 条件语句中待推断的类型变量<br>​</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">ParamType</span>&lt;T&gt; = T <span class="keyword">extends</span> (...<span class="attr">args</span>: infer P) =&gt; <span class="built_in">any</span> ? P : T;</span><br><span class="line"><span class="comment">// 整句表示为：如果 T 能赋值给 (...args: infer P) =&gt; any，则结果是 (...args: infer P) =&gt; any 类型中的参数 P，否则返回为 T。</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Func</span> = <span class="function">(<span class="params">user: User</span>) =&gt;</span> <span class="built_in">void</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Param</span> = <span class="title class_">ParamType</span>&lt;<span class="title class_">Func</span>&gt;; <span class="comment">// Param = User</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">AA</span> = <span class="title class_">ParamType</span>&lt;<span class="built_in">string</span>&gt;; <span class="comment">// string</span></span><br></pre></td></tr></table></figure>

<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="Pick"><a href="#Pick" class="headerlink" title="Pick"></a>Pick</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyPick</span>&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Omit"><a href="#Omit" class="headerlink" title="Omit"></a>Omit</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyOmit</span>&lt;T, U <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> <span class="title class_">Exclude</span>&lt;keyof T, U&gt;]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="Equal"><a href="#Equal" class="headerlink" title="Equal"></a>Equal</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">IsEqual</span>&lt;A, B&gt; = [A, B] <span class="keyword">extends</span> [B, A] ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Include"><a href="#Include" class="headerlink" title="Include"></a>Include</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Includes</span>&lt;T <span class="keyword">extends</span> <span class="keyword">readonly</span> <span class="built_in">any</span>[], U&gt; = T <span class="keyword">extends</span> [</span><br><span class="line">  infer <span class="title class_">First</span>,</span><br><span class="line">  ...infer <span class="title class_">Rest</span></span><br><span class="line">]</span><br><span class="line">  ? <span class="title class_">Equal</span>&lt;<span class="title class_">First</span>, U&gt; <span class="keyword">extends</span> <span class="literal">true</span></span><br><span class="line">    ? <span class="literal">true</span></span><br><span class="line">    : <span class="title class_">Includes</span>&lt;<span class="title class_">Rest</span>, U&gt;</span><br><span class="line">  : <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Exclude"><a href="#Exclude" class="headerlink" title="Exclude"></a>Exclude</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyExclude</span>&lt;T, U&gt; = T <span class="keyword">extends</span> U ? <span class="built_in">never</span> : T;</span><br></pre></td></tr></table></figure>

<h3 id="Readonly"><a href="#Readonly" class="headerlink" title="Readonly"></a>Readonly</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyReadonly</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 深度</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">DeepReadonly</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P] <span class="keyword">extends</span> <span class="built_in">object</span> ? <span class="title class_">DeepReadonly</span>&lt;T[P]&gt; : T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="First-Array"><a href="#First-Array" class="headerlink" title="First Array"></a>First Array</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">First</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> [infer P, ...infer R] ? P : <span class="built_in">never</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Awaited"><a href="#Awaited" class="headerlink" title="Awaited"></a>Awaited</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyAwaited</span>&lt;T <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;&gt; = T <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;infer R&gt;</span><br><span class="line">  ? R <span class="keyword">extends</span> <span class="title class_">Promise</span>&lt;<span class="built_in">any</span>&gt;</span><br><span class="line">    ? <span class="title class_">MyAwaited</span>&lt;R&gt;</span><br><span class="line">    : R</span><br><span class="line">  : T;</span><br></pre></td></tr></table></figure>

<h3 id="Parameters"><a href="#Parameters" class="headerlink" title="Parameters"></a>Parameters</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MyParameters</span>&lt;T <span class="keyword">extends</span> (...<span class="attr">args</span>: <span class="built_in">any</span>[]) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (</span><br><span class="line">  ...<span class="attr">args</span>: infer R</span><br><span class="line">) =&gt; <span class="built_in">any</span></span><br><span class="line">  ? R</span><br><span class="line">  : [];</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2022/01/17/HTML/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/17/HTML/" class="post-title-link" itemprop="url">HTML</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-17 23:41:31" itemprop="dateCreated datePublished" datetime="2022-01-17T23:41:31+08:00">2022-01-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:01" itemprop="dateModified" datetime="2022-02-14T19:41:01+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="document"><a href="#document" class="headerlink" title="document"></a>document</h2><p>readystate:loading 表示文档还在加载中，即处于“正在加载”状态。<br>ready 当 DOM 文档树加载完成后执行一个函数 （不包含图片，css 等）所以会比 load 较快执行 原生 dom 定义里是没有这个 api 的，jq 封装了一个<br>readystate: interactive 文档已经结束了“正在加载”状态，DOM 元素可以被访问。但是像图像，样式表和框架等资源依然还在加载。<br>DOMContentLoaded 当页面的 DOM 树解析好并且需要等待 JS 执行完才触发 不直接等待 CSS 文件、图片的加载完成<br>readystate: complete 页面所有内容都已被完全加载.<br>load 当页面所有资源全部加载完成后（包括 DOM 文档树，css 文件，js 文件，图片资源等）执行</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2022/01/10/Web%20Worker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/10/Web%20Worker/" class="post-title-link" itemprop="url">Web Worker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-10 16:15:33" itemprop="dateCreated datePublished" datetime="2022-01-10T16:15:33+08:00">2022-01-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:01" itemprop="dateModified" datetime="2022-02-14T19:41:01+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>worker 的一个优势在于能够执行处理器密集型的运算而不会阻塞 UI 线程。<br>将一些耗时的数据处理操作从主线程中剥离，使主线程更加专注于页面渲染和交互。<br>懒加载</p>
<ul>
<li>文本分析</li>
<li>流媒体数据处理</li>
<li>canvas 图形绘制</li>
<li>图像处理</li>
</ul>
<p>​</p>
<p>Web Worker 的运行不会影响主线程，但与主线程交互时仍受到主线程单线程的瓶颈制约。换言之，如果 Worker 线程频繁与主线程进行交互，主线程由于需要处理交互，仍有可能使页面发生阻塞<br>​</p>
<h2 id="为什么不用-Promise-来代替"><a href="#为什么不用-Promise-来代替" class="headerlink" title="为什么不用 Promise 来代替"></a>为什么不用 Promise 来代替</h2><p>promise 不会新开线程，resolve 前面的部分还是在主线程执行，只不过是把回调放在微任务队列而已。主要的部分计算密集依然会卡住渲染进程<br>​</p>
<p>GUI 渲染线程与 JS 引擎线程是互斥的，当 JS 引擎执行时 GUI 线程会被挂起（相当于被冻结了），GUI 更新会被保存在一个队列中等到 JS 引擎空闲时立即被执行<br>所以如果 JS 执行的时间过长，会导致页面渲染加载阻塞</p>
<blockquote>
<p>由于 JavaScript 是可操纵 DOM 的，如果在修改这些元素属性同时渲染界面（即 JS 线程和 UI 线程同时运行），那么渲染线程前后获得的元素数据就可能不一致。因此为了防止渲染出现不可预期的结果，浏览器设置 GUI 渲染线程与 JS 引擎为互斥的关系，当 JS 引擎执行时 GUI 线程会被挂起，GUI 更新则会被保存在一个队列中等到 JS 引擎线程空闲时立即被执行。</p>
</blockquote>
<p>​</p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>不能直接操作 DOM 节点，也不能使用 window 对象的默认方法和属性<br>​</p>
<p>可以使用包括 WebSockets，IndexedDB 等数据存储机制<br>​</p>
<p>可以生成新的 workers<br>​</p>
<p>可以使用 XMLHttpRequest 进行网络 I/O，但是 XMLHttpRequest 的 responseXML 和 channel 属性总会返回 null<br>​</p>
<p>importScripts()来引入脚本<br>​</p>
<p>Navigator<br>​</p>
<p>location，注意该 location 指向的是 WebWorker 创建时以 UI 线程所属页面的当前 Location 为基础创建的 WorkerLocation 对象，即使此后页面被多次重定向，该 location 的信息依然保持不变<br>​</p>
<p>setTimeout/setInterval<br>​</p>
<p>Array, Date, Math, String</p>
<h3 id="通信"><a href="#通信" class="headerlink" title="通信"></a>通信</h3><p>postMessage 发送各自的消息，使用 onmessage 事件处理函数来响应消息。这个过程中数据并不是被共享而是<strong>被复制</strong><br>​</p>
<p>onerror<br>​</p>
<h3 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h3><p>terminate<br>外部关闭<br>close<br>内部关闭</p>
<h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>引入静态资源<br>用法比较生硬，需要创建额外的 JS 文件才能运行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myWorker = <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="string">&quot;./worker.js&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>将一个函数转换为 blob，然后为这个 blob 生成 URL 对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fn2workerURL</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="string">&quot;(&quot;</span> + fn.<span class="title function_">toString</span>() + <span class="string">&quot;)()&quot;</span>], &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&quot;application/javascript&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">return</span> <span class="variable constant_">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
<p>嵌入式 worker</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/js-worker&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 该脚本不会被 JS 引擎解析，因为它的 mime-type 是 text/js-worker。</span></span></span><br><span class="line"><span class="language-javascript">  onmessage = <span class="keyword">function</span> (<span class="params">oEvent</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">postMessage</span>(myVar);</span></span><br><span class="line"><span class="language-javascript">  &#125;;</span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 剩下的 worker 代码写到这里。</span></span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 该脚本会被 JS 引擎解析，因为它的 mime-type 是 text/javascript。</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 在过去...：</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 我们使用 blob builder</span></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// ...但是现在我们使用 Blob...:</span></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">var</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>(<span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">map</span>.<span class="title function_">call</span>(</span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&quot;script[type=\&quot;text\/js-worker\&quot;]&quot;</span>),</span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> (<span class="params">oScript</span>) &#123; <span class="keyword">return</span> oScript.<span class="property">textContent</span>; &#125;),</span></span><br><span class="line"><span class="language-javascript">    &#123;<span class="attr">type</span>: <span class="string">&quot;text/javascript&quot;</span>&#125;</span></span><br><span class="line"><span class="language-javascript">  );</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 创建一个新的 document.worker 属性，包含所有 &quot;text/js-worker&quot; 脚本。</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="property">worker</span> = <span class="keyword">new</span> <span class="title class_">Worker</span>(<span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(blob));</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="property">worker</span>.<span class="property">onmessage</span> = <span class="keyword">function</span> (<span class="params">oEvent</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">    <span class="title function_">pageLog</span>(<span class="string">&quot;Received: &quot;</span> + oEvent.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="comment">// 启动 worker.</span></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="variable language_">document</span>.<span class="property">worker</span>.<span class="title function_">postMessage</span>(<span class="string">&quot;&quot;</span>); &#125;;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="数据拷贝"><a href="#数据拷贝" class="headerlink" title="数据拷贝"></a>数据拷贝</h3><p>当你使用 postMessage()方法传输这些数据时，数据会被拷贝一份再进行传输（传值而非传址），所以当你传输 100MB 的数据时，主进程和 Worker 进程都会增加 100MB 的内存使用，并且复制 100MB 的数据需要的时间可能达到几百毫秒。<br>​</p>
<p>传输 Transferable 数据类型），使用 Transferable 传输时，会直接把数据从一个执行环境（Worker 线程或主线程）传输到另一个执行环境，这样不会额外增加一份内存消耗，并且传输速度极快因为不需要数据拷贝。<br>但是一旦转移，主线程就无法再使用这些二进制数据了，这是为了防止出现多个线程同时修改数据的麻烦局面。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Transferable Objects 格式</span></span><br><span class="line">worker.<span class="title function_">postMessage</span>(arrayBuffer, [arrayBuffer]);</span><br></pre></td></tr></table></figure>

<p><strong>如果在原有的上下文环境中不再需要访问该对象时</strong>，那么使用 Transferable 对象传输是一个明智的选择。<br>​</p>
<p>Chrome 和 Edge 的 Transferable 传输性能会随着数组元素的增加呈指数级别下降，基本只要数组长度上千，性能就不如拷贝传输了。当 Tranferrable 对象过多时，Chrome 和 Edge 应该是慢在花很多时间来解析 Transferable 数组成员，来和 postMessage()方法中的第一个参数的数据成员做一一关系映射。<br>​</p>
<p>​</p>
<h2 id="SharedWorker"><a href="#SharedWorker" class="headerlink" title="SharedWorker"></a>SharedWorker</h2><p>SharedWorker 接口代表一种特定类型的 worker，可以从几个浏览上下文中访问，例如几个窗口、iframe 或其他 worker。它们实现一个不同于普通 worker 的接口，具有不同的全局作用域,<br>SharedWorker 的实质在于 share，不同的线程可以共享一个线程，他们的数据也是共享的。<br>​</p>
<p>​</p>
<p>​</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903736238669837">https://juejin.cn/post/6844903736238669837</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fsjohnhuang/p/14141311.html">https://www.cnblogs.com/fsjohnhuang/p/14141311.html</a><br><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2018/07/web-worker.html">https://www.ruanyifeng.com/blog/2018/07/web-worker.html</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers">https://developer.mozilla.org/zh-CN/docs/Web/API/Web_Workers_API/Using_web_workers</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2022/01/09/JSbrigde/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/09/JSbrigde/" class="post-title-link" itemprop="url">JSbrigde</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-09 11:47:44" itemprop="dateCreated datePublished" datetime="2022-01-09T11:47:44+08:00">2022-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:01" itemprop="dateModified" datetime="2022-02-14T19:41:01+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>在 Hybrid 模式下，H5 会经常需要使用 Native 的功能，比如打开二维码扫描、调用原生页面、获取用户信息等，同时 Native 也需要向 Web 端发送推送、更新状态等。<br>而 JavaScript 是运行在单独的 JS Context 中（Webview 容器、JSCore 等），与原生有运行环境的隔离，所以需要有一种机制实现 Native 端和 Web 端的双向通信，这就是 JSBridge：</p>
<blockquote>
<p>以 JavaScript 引擎或 Webview 容器作为媒介，通过协定协议进行通信，实现 Native 端和 Web 端双向通信的一种机制。</p>
</blockquote>
<p><img src="https://cdn.nlark.com/yuque/0/2022/webp/106384/1643266015908-28b88755-97b4-4aad-a276-74ecf7cc2103.webp#clientId=ua55a1138-753e-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u3b01a317&margin=%5Bobject%20Object%5D&originHeight=838&originWidth=1610&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u0bc0795b-5cc1-46e2-b2e9-2b269872c85&title="></p>
<h2 id="WebView"><a href="#WebView" class="headerlink" title="WebView"></a>WebView</h2><p>webView 是移动端提供的运行 JavaScript 的环境，是系统渲染 Web 网页的一个控件，可与页面 JavaScript 交互，实现混合开发<br>​</p>
<h2 id="JSB-写法"><a href="#JSB-写法" class="headerlink" title="JSB 写法"></a>JSB 写法</h2><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 向后端传参</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">useJSB</span> = (<span class="params">key = <span class="string">&#x27;jsbridge_showMessage&#x27;</span>, callback, params</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> bridge = <span class="variable language_">window</span>.<span class="property">WebViewJavascriptBridge</span></span><br><span class="line">  <span class="comment">// 检查是否被初始化</span></span><br><span class="line">  <span class="keyword">if</span>(!<span class="variable language_">window</span>.<span class="property">hasJSB</span>) &#123;</span><br><span class="line">    <span class="variable language_">window</span>.<span class="property">hasJSB</span> = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// 安卓初始化</span></span><br><span class="line">    isAndroid &amp;&amp; bridge.<span class="title function_">init</span>(<span class="function">(<span class="params">data, responseCallback</span>) =&gt;</span> &#123;&#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 调用自定义native方法</span></span><br><span class="line">  bridge.<span class="title function_">callHanlder</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;...params, <span class="attr">_</span>: <span class="number">0</span>&#125;), callback)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">registerJSB</span> = (<span class="params">key = <span class="string">&#x27;functionInJs&#x27;</span>, callback = (data, responseCallback) =&gt; &#123;</span></span><br><span class="line"><span class="params">&#125;</span>) =&gt; &#123;</span><br><span class="line"> <span class="variable language_">window</span>.<span class="property">WebViewJavascriptBridge</span>.<span class="title function_">registerHandler</span>(key, callback)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// native</span></span><br><span class="line"><span class="comment">// 需要规定好key和处理函数的对应关系</span></span><br><span class="line">webView.<span class="title function_">registerHandler</span>(<span class="string">&#x27;jsbridge_showMessage&#x27;</span>, <span class="keyword">function</span> (<span class="params">data, responseCallback</span>) &#123;</span><br><span class="line">   <span class="title function_">showResponse</span>(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">webView.<span class="title function_">callHandler</span>(<span class="string">&quot;functionInJs&quot;</span>, <span class="keyword">new</span> <span class="title class_">Gson</span>().<span class="title function_">toJson</span>(user), <span class="keyword">new</span> <span class="title class_">CallBackFunction</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">void</span> <span class="title function_">onCallBack</span>(<span class="params"><span class="built_in">String</span> data</span>) &#123;&#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="JSB-原理"><a href="#JSB-原理" class="headerlink" title="JSB 原理"></a>JSB 原理</h2><h3 id="web-向-native-传参"><a href="#web-向-native-传参" class="headerlink" title="web 向 native 传参"></a>web 向 native 传参</h3><h4 id="拦截-Webview-请求的-URL-Schema"><a href="#拦截-Webview-请求的-URL-Schema" class="headerlink" title="拦截 Webview 请求的 URL Schema"></a>拦截 Webview 请求的 URL Schema</h4><p>webview 拦截透明 iframe.src 请求获取</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果未注册JSB，开启被劫持请求，向native传参</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">WVJBCallbacks</span> = [callback];</span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WVJBIframe</span> = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;iframe&quot;</span>);</span><br><span class="line"><span class="title class_">WVJBIframe</span>.<span class="property">style</span>.<span class="property">display</span> = <span class="string">&quot;none&quot;</span>;</span><br><span class="line"><span class="comment">// 被劫持请求</span></span><br><span class="line"><span class="title class_">WVJBIframe</span>.<span class="property">src</span> = <span class="string">&quot;jsbridge://_bridge_loaded&quot;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="title function_">appendChild</span>(<span class="title class_">WVJBIframe</span>);</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2022/webp/106384/1643269526199-05f15c24-2795-430a-8377-13eee76889fd.webp#clientId=u880390e9-3c0c-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u04ba60ef&margin=%5Bobject%20Object%5D&originHeight=312&originWidth=794&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u015d117c-4075-400b-bf2c-549765c91b2&title="></p>
<h4 id="向-Webview-中注入-JS-API"><a href="#向-Webview-中注入-JS-API" class="headerlink" title="向 Webview 中注入 JS API"></a>向 Webview 中注入 JS API</h4><p>App 将 Native 的相关接口注入到 JS 的 Context（window）的对象中,Web 端就可以直接在全局 window 下使用这个暴露的全局 JS 对象，进而调用原生端的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注入全局JS对象</span></span><br><span class="line">webView.addJavascriptInterface(<span class="keyword">new</span> <span class="title class_">NativeBridge</span>(<span class="built_in">this</span>), <span class="string">&quot;NativeBridge&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NativeBridge</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Context ctx;</span><br><span class="line">  NativeBridge(Context ctx) &#123;</span><br><span class="line">    <span class="built_in">this</span>.ctx = ctx;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 增加JS调用接口</span></span><br><span class="line">  <span class="meta">@JavascriptInterface</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showNativeDialog</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AlertDialog</span>.Builder(ctx).setMessage(text).create().show();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">NativeBridge</span>.<span class="title function_">showNativeDialog</span>(<span class="string">&quot;hello&quot;</span>); <span class="comment">// 传参</span></span><br></pre></td></tr></table></figure>

<h3 id="native-向-web-传参"><a href="#native-向-web-传参" class="headerlink" title="native 向 web 传参"></a>native 向 web 传参</h3><p>将拼接的 JavaScript 代码字符串，传入 JS 解析器（webView）执行</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">webView.<span class="title function_">loadUrl</span>(<span class="string">&#x27;javascript:&#x27;</span> + code)</span><br><span class="line">webView.evaluateJavascript(code, callback) <span class="comment">// 通过callback获取返回值执行回调</span></span><br><span class="line">[webView <span class="attr">stringByEvaluatingJavaScriptFromString</span>:jsStr] <span class="comment">// iOS</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6936814903021797389">https://juejin.cn/post/6936814903021797389</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/910e058a1d63">https://www.jianshu.com/p/910e058a1d63</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/381459761">https://zhuanlan.zhihu.com/p/381459761</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/haoyanyu_/article/details/89237819">https://blog.csdn.net/haoyanyu_/article/details/89237819</a><br><a target="_blank" rel="noopener" href="https://github.com/lzyzsd/JsBridge">https://github.com/lzyzsd/JsBridge</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2022/01/03/%E6%A8%A1%E5%9D%97%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2022/01/03/%E6%A8%A1%E5%9D%97%E5%8C%96/" class="post-title-link" itemprop="url">模块化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-03 14:50:27" itemprop="dateCreated datePublished" datetime="2022-01-03T14:50:27+08:00">2022-01-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:01" itemprop="dateModified" datetime="2022-02-14T19:41:01+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <ul>
<li>将一个复杂的程序依据一定的规则(规范)封装成几个块(文件), 并进行组合在一起</li>
<li>块的内部数据与实现是私有的, 只是向外部暴露一些接口(方法)与外部其它模块通信</li>
</ul>
<p>好处</p>
<ol>
<li>避免命名冲突(减少命名空间污染)</li>
<li>更好的分离, 按需加载</li>
<li>更高复用性</li>
<li>高可维护性</li>
</ol>
<h2 id="CommonJS"><a href="#CommonJS" class="headerlink" title="CommonJS"></a>CommonJS</h2><p>**Node **应用由模块组成，采用 CommonJS 模块规范。每个文件就是一个模块，有自己的作用域。在一个文件里面定义的变量、函数、类，都是私有的，对其他文件不可见。在服务器端，模块的加载是运行时同步加载的；在浏览器端，模块需要提前编译打包处理。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line">a = <span class="built_in">require</span>(<span class="string">&quot;./a.js&quot;</span>).<span class="property">a</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<p><strong>require 命令的基本功能是，读入并执行一个 JavaScript 文件，然后返回该模块的 exports 对象</strong></p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>所有代码都运行在模块作用域，不会污染全局作用域。</li>
<li>模块可以多次加载，但是只会在第一次加载时运行一次，然后运行结果就被<strong>缓存</strong>了，以后再加载，就直接读取缓存结果。要想让模块再次运行，必须清除缓存。</li>
<li><strong>requier 获取的是被输出值的拷贝，require 之后模块内部的变化不影响获取到的值</strong></li>
<li><strong>同步加载</strong>，模块加载的顺序，按照其在代码中出现的顺序</li>
<li>主要用于服务器编程，模块文件一般都已经存在于本地硬盘，所以加载起来比较快</li>
</ul>
<p>​</p>
<h2 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h2><p><strong>require.js</strong>主要用于客户端的模块管理。AMD 规范是非同步加载模块，允许指定回调函数。<br><img src="https://cdn.nlark.com/yuque/0/2022/png/106384/1641889306615-9bc985b0-931a-4f7f-8dbf-4cb78613a1e0.png#clientId=ua7a277f0-c07b-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=uf2076acd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=466&originWidth=720&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=209610&status=done&style=none&taskId=u09c9c66f-3e57-4522-bfb9-375a1dfbefe&title=" alt="image.png"></p>
<ol>
<li>对于依赖的模块，AMD 是提前执行，CMD 是延迟执行</li>
<li>CMD 推崇依赖就近，AMD 推崇依赖前置。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">n</span>: <span class="number">1</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//b.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="comment">// 依赖一开始要写好</span></span><br><span class="line">[<span class="string">&quot;./a.js&quot;</span>], <span class="function">(<span class="params">a</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a.<span class="property">n</span>); <span class="comment">// 1</span></span><br><span class="line">  <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// c.js</span></span><br><span class="line"><span class="built_in">require</span>([<span class="string">&quot;./b.js&quot;</span>], <span class="function">(<span class="params">b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 异步引用调用</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h2><p>CMD 规范专门用于浏览器端，模块的加载是异步的，模块使用时才会加载执行。实践为<strong>Sea.js。</strong>推崇 as lazy as possible.<br>CMD 规范最大的特点就是懒加载，不需要在定义模块的时候声明依赖，可以在模块执行时动态加载依赖，并且同时支持同步和异步加载模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="function">(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">exports</span>.<span class="property">a</span> = <span class="number">1</span>;</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 依赖就近书写</span></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="title function_">define</span>(<span class="function">(<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 同步</span></span><br><span class="line">  <span class="keyword">let</span> a = <span class="built_in">require</span>(<span class="string">&quot;./a.js&quot;</span>);</span><br><span class="line">  <span class="comment">// 异步</span></span><br><span class="line">  <span class="comment">// require.async(path, (res) =&gt; &#123;&#125;)</span></span><br><span class="line">  <span class="built_in">exports</span>.<span class="property">b</span> = <span class="number">1</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h2><p><strong>ES6 <strong>模块的设计思想是尽量的静态化，使得</strong>编译时</strong>就能确定模块的依赖关系，以及输入和输出的变量。CommonJS 和 AMD 模块，都只能在运行时通过 require 和 define 确定这些东西。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="keyword">export</span> &#123;<span class="attr">a</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;a&#125; <span class="keyword">from</span> <span class="string">&#x27;./a.js&#x27;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>

<h3 id="ES6-模块与-CommonJS-模块的差异"><a href="#ES6-模块与-CommonJS-模块的差异" class="headerlink" title="ES6 模块与 CommonJS 模块的差异"></a>ES6 模块与 CommonJS 模块的差异</h3><ol>
<li>CommonJS 模块输出的是一个值的拷贝，ES6 模块输出的是<strong>值的引用</strong>。</li>
<li>CommonJS 模块是运行时加载，ES6 模块是编译时输出接口</li>
</ol>
<p>​</p>
<p>ES6 模块的运行机制与 CommonJS 不一样。ES6 模块是动态引用，并且不会缓存值，模块里面的变量绑定其所在的模块<br>第二个差异是因为 CommonJS 加载的是一个对象（即 module.exports 属性），该对象只有在脚本运行完才会生成。而 ES6 模块不是对象，它的对外接口只是一种静态定义，在代码静态解析阶段就会生成。</p>
<h2 id="tree-shaking"><a href="#tree-shaking" class="headerlink" title="tree-shaking"></a>tree-shaking</h2><p>Tree-shaking 的本质是消除无用的 js 代码。无用代码消除在广泛存在于传统的编程语言编译器中，编译器可以判断出某些代码根本不影响输出，然后消除这些代码，这个称之为 DCE（dead code elimination）。Tree-shaking 是 DCE 的一种新的实现。<br>通过 ES6 Module 的 import 来进行静态分析，并且只支持 ES6 Module 模块的使用。</p>
<h3 id="Dead-Code"><a href="#Dead-Code" class="headerlink" title="Dead Code"></a>Dead Code</h3><ol>
<li>代码不会被执行，不可到达</li>
<li>代码执行的结果不会被用到</li>
<li>代码只会影响死变量（只写不读）</li>
</ol>
<p>​</p>
<p>ES6 模块依赖关系是确定的，和运行时的状态无关，可以进行可靠的静态分析，这就是 tree-shaking 的基础。<br>​</p>
<p>但由于 JS 动态语言的的特性使得静态分析比较困难，再加上副作用的广泛存在，三大工具的 tree-shaking 对于无用代码，无用模块的消除，都是有限的，有条件的。<br>​</p>
<h2 id="UMD"><a href="#UMD" class="headerlink" title="UMD"></a>UMD</h2><p>所谓 UMD (Universal Module Definition)，就是一种 javascript 通用模块定义规范，让你的模块能在 javascript 所有运行环境中发挥作用，兼容 common AMD CMD</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">root, factory</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">module</span> === <span class="string">&quot;object&quot;</span> &amp;&amp; <span class="keyword">typeof</span> <span class="variable language_">module</span>.<span class="property">exports</span> === <span class="string">&quot;object&quot;</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;是commonjs模块规范，nodejs环境&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> depModule = <span class="built_in">require</span>(<span class="string">&quot;./umd-module-depended&quot;</span>);</span><br><span class="line">    <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>(depModule);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&quot;function&quot;</span> &amp;&amp; define.<span class="property">amd</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;是AMD模块规范，如require.js&quot;</span>);</span><br><span class="line">    <span class="title function_">define</span>([<span class="string">&quot;depModule&quot;</span>], factory);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">&quot;function&quot;</span> &amp;&amp; define.<span class="property">cmd</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;是CMD模块规范，如sea.js&quot;</span>);</span><br><span class="line">    <span class="title function_">define</span>(<span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, <span class="built_in">exports</span>, <span class="variable language_">module</span></span>) &#123;</span><br><span class="line">      <span class="keyword">var</span> depModule = <span class="built_in">require</span>(<span class="string">&quot;depModule&quot;</span>);</span><br><span class="line">      <span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title function_">factory</span>(depModule);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;没有模块环境，直接挂载在全局对象上&quot;</span>);</span><br><span class="line">    root.<span class="property">umdModule</span> = <span class="title function_">factory</span>(root.<span class="property">depModule</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)(<span class="variable language_">this</span>, <span class="keyword">function</span> (<span class="params">depModule</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;我调用了依赖模块&quot;</span>, depModule);</span><br><span class="line">  <span class="comment">// ...省略了一些代码，去代码仓库看吧</span></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;我自己是一个umd模块&quot;</span>,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>​</p>
<p>​</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/9f5a0351a532">https://www.jianshu.com/p/9f5a0351a532</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/129317481">https://zhuanlan.zhihu.com/p/129317481</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/12/31/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/31/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">年终总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-31 11:18:01" itemprop="dateCreated datePublished" datetime="2021-12-31T11:18:01+08:00">2021-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:01" itemprop="dateModified" datetime="2022-02-14T19:41:01+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="思考点"><a href="#思考点" class="headerlink" title="思考点"></a>思考点</h2><p>讲究可维护性、可扩展性，对于复杂场景，具有创造性思维，创造解决方案；<br>并能从业务中沉淀通用解决方案，造出轮子（工具、插件等），对于工具设计也有规范，保证易用性，帮助团队降本提效<br>选这个技术栈是出于什么原因，能解决什么痛点？能给业务带来什么收益？</p>
<h3 id="STAR"><a href="#STAR" class="headerlink" title="STAR"></a>STAR</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1640933860192-5ccba376-c7e0-4fa0-8683-a9558a7bbbb8.webp#clientId=u7fed9d90-58dd-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ucfad475f&margin=%5Bobject%20Object%5D&originHeight=326&originWidth=2026&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u58ce5f1f-8fcb-4608-9aa2-010f5faeb91&title="></p>
<h2 id="4399"><a href="#4399" class="headerlink" title="4399"></a>4399</h2><h3 id="推广"><a href="#推广" class="headerlink" title="推广"></a>推广</h3><h4 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h4><p>跨账户 跨渠道 跨层级 的广告管理面板。满足投手在日常投放过程中的实时看数、对数、批量操作、简单数据分析的痛点。打通渠道数据和游戏后台数据。</p>
<h4 id="技术架构"><a href="#技术架构" class="headerlink" title="技术架构"></a>技术架构</h4><p>vue 全家桶+element<br>​</p>
<h4 id="技术亮点"><a href="#技术亮点" class="headerlink" title="技术亮点"></a>技术亮点</h4><h5 id="虚拟列表"><a href="#虚拟列表" class="headerlink" title="虚拟列表"></a>虚拟列表</h5><p><a target="_blank" rel="noopener" href="https://www.yuque.com/catcherinsky/notes/yti9rs#A5WBB">https://www.yuque.com/catcherinsky/notes/yti9rs#A5WBB</a><br>​</p>
<h5 id="树形表格"><a href="#树形表格" class="headerlink" title="树形表格"></a>树形表格</h5><p>广告平台一般分账户-广告组-广告三个层级。头条一般的投放模式是堆量，跑一段时间之后再根据实际情况关停效果不好的广告。每个投手所属都有大量广告账户，数千条计划。树形表格可以展示计划归属，方便调整计划以及账户预算。<br>​</p>
<p>流程：树先序遍历扁平化成数组，数组里保存着指向树节点的引用。渲染表格时判断哪些节点有共同父节点，存在父节点的 children 里面，折叠起来。点击按钮展开时，将 children 里面的数据插入数组。</p>
<h5 id="web-worker"><a href="#web-worker" class="headerlink" title="web-worker"></a>web-worker</h5><p>使用 web-worker 创建一个新线程，并在新线程中清洗、计算数据，不阻塞浏览器的渲染。并且封装了一个可以调用的工具。输入函数，参数和环境就可以了。<br>难点：新线程里面没有 window 等对象，许多常用方法都没法用。开启新线程需要传入 js 文件的地址。而许多时候没有专门的 js 文件，只是一些函数<br>流程：</p>
<ol>
<li>将函数，环境，参数转化为字符串，跟线程通信方法 onmessage 一起被包进立即执行匿名函数的字符串里面，转成 blob，createObjectURL，生成新线程</li>
<li>使用 promise 封装 worker，使得可以异步执行</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 创建一个新的worker线程</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">String</span>&#125; string web worker 内部使用的方法的字面值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">createWorker</span> = (<span class="params">string</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> blob = <span class="keyword">new</span> <span class="title class_">Blob</span>([<span class="string">`(() =&gt; &#123;<span class="subst">$&#123;string&#125;</span>&#125;)()`</span>]);</span><br><span class="line">  <span class="keyword">var</span> url = <span class="variable language_">window</span>.<span class="property">URL</span>.<span class="title function_">createObjectURL</span>(blob);</span><br><span class="line">  <span class="keyword">var</span> worker = <span class="keyword">new</span> <span class="title class_">Worker</span>(url);</span><br><span class="line">  <span class="comment">// 释放 URL.createObjectURL() 创建的 URL 对象，通知浏览器不再保持对该 URL 对象的引用</span></span><br><span class="line">  <span class="variable constant_">URL</span>.<span class="title function_">revokeObjectURL</span>(blob);</span><br><span class="line">  <span class="keyword">return</span> worker;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在创建web worker，并完成计算工作，异步返回计算结果</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; fn 计算函数，返回计算结果</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">any</span>&#125; params 计算函数的参数</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Object</span>&#125; env 作为web worker的全局变量，属性的键为变量名， 值为常量或函数，</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> <span class="title function_">computeWorker</span> = (<span class="params">fn = () =&gt; &#123;&#125;, params, env = &#123;&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">window</span>.<span class="property">console</span>.<span class="title function_">time</span>(<span class="string">`Web Worker <span class="subst">$&#123;fn.name&#125;</span>`</span>);</span><br><span class="line">  <span class="comment">// 将参数，方法转换成字面值，传入web worker</span></span><br><span class="line">  <span class="keyword">const</span> handler = <span class="string">`const func = <span class="subst">$&#123;fn&#125;</span>;`</span>;</span><br><span class="line">  <span class="keyword">const</span> environments = <span class="title class_">Object</span>.<span class="title function_">keys</span>(env).<span class="title function_">reduce</span>(<span class="function">(<span class="params">total, key</span>) =&gt;</span> &#123;</span><br><span class="line">    total += <span class="string">`const <span class="subst">$&#123;key&#125;</span> = <span class="subst">$&#123;env[key].toString()&#125;</span>;`</span>;</span><br><span class="line">    <span class="keyword">return</span> total;</span><br><span class="line">  &#125;, <span class="string">&quot;&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> message = <span class="string">`</span></span><br><span class="line"><span class="string">        self.onmessage = (&#123; data: &#123; params &#125; &#125;) =&gt; &#123;</span></span><br><span class="line"><span class="string">            try &#123;</span></span><br><span class="line"><span class="string">                let data = func(params);</span></span><br><span class="line"><span class="string">                self.postMessage(&#123;code: 0, data&#125;);</span></span><br><span class="line"><span class="string">            &#125; catch(e) &#123;</span></span><br><span class="line"><span class="string">                self.postMessage(&#123;code: -1, err: e&#125;);</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    `</span>;</span><br><span class="line">  <span class="keyword">let</span> worker = <span class="title function_">createWorker</span>(<span class="string">`<span class="subst">$&#123;environments&#125;</span><span class="subst">$&#123;handler&#125;</span><span class="subst">$&#123;message&#125;</span>`</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    worker.<span class="title function_">postMessage</span>(&#123; params &#125;);</span><br><span class="line">    worker.<span class="property">onmessage</span> = <span class="function">(<span class="params">&#123; data: &#123; code, data, err &#125; &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">console</span>.<span class="title function_">timeEnd</span>(<span class="string">`Web Worker <span class="subst">$&#123;fn.name&#125;</span>`</span>);</span><br><span class="line">      <span class="keyword">if</span> (code == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(data);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">reject</span>(err);</span><br><span class="line">      &#125;</span><br><span class="line">      worker.<span class="title function_">terminate</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    worker.<span class="property">onerror</span> = <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">window</span>.<span class="property">console</span>.<span class="title function_">timeEnd</span>(<span class="string">`Web Worker <span class="subst">$&#123;fn.name&#125;</span>`</span>);</span><br><span class="line">      <span class="title function_">reject</span>(err);</span><br><span class="line">      worker.<span class="title function_">terminate</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>​</p>
<h5 id="分段批量请求"><a href="#分段批量请求" class="headerlink" title="分段批量请求"></a>分段批量请求</h5><p>待发送请求塞进一个队列里面，在微任务里切割队列，Promise.allSettled 来分批发送。在队列的时候添加 id 标识符，等 allSettled 执行完毕后，分成成功请求和失败请求两部分。通过 id 来将返回结果匹配到原函数里面去。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">batch</span> = <span class="keyword">async</span> (<span class="params">&#123;</span></span><br><span class="line"><span class="params">  fn,</span></span><br><span class="line"><span class="params">  params,</span></span><br><span class="line"><span class="params">  size = <span class="number">5</span>,</span></span><br><span class="line"><span class="params">  before = () =&gt; &#123;&#125;,</span></span><br><span class="line"><span class="params">  steps = () =&gt; &#123;&#125;,</span></span><br><span class="line"><span class="params">  success = () =&gt; &#123;&#125;,</span></span><br><span class="line"><span class="params">  fail = () =&gt; &#123;&#125;,</span></span><br><span class="line"><span class="params">  last = () =&gt; &#123;&#125;,</span></span><br><span class="line"><span class="params">&#125;</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">let</span> successArr = [],</span><br><span class="line">    failArr = [],</span><br><span class="line">    index = <span class="number">0</span>;</span><br><span class="line">  <span class="title function_">before</span>(params, size);</span><br><span class="line">  <span class="comment">// 同一批请求设置微小时间差</span></span><br><span class="line">  <span class="keyword">const</span> <span class="title function_">request</span> = (<span class="params">fn, param, index, gap</span>) =&gt;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 每条请求间隔10 ms</span></span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fn</span>(param, index)</span><br><span class="line">          .<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> <span class="title function_">resolve</span>(res))</span><br><span class="line">          .<span class="title function_">catch</span>(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="title function_">reject</span>(err));</span><br><span class="line">      &#125;, gap * <span class="number">10</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, times = <span class="title class_">Math</span>.<span class="title function_">ceil</span>(params.<span class="property">length</span> / size); i &lt; times; i++) &#123;</span><br><span class="line">    <span class="keyword">await</span> <span class="title class_">Promise</span>.<span class="title function_">allSettled</span>(</span><br><span class="line">      params</span><br><span class="line">        .<span class="title function_">slice</span>(i * size, (i + <span class="number">1</span>) * size)</span><br><span class="line">        .<span class="title function_">map</span>(<span class="function">(<span class="params">param, gap</span>) =&gt;</span> <span class="title function_">request</span>(fn, param, index++, gap))</span><br><span class="line">    ).<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 分成成功和失败两个队列</span></span><br><span class="line">      <span class="comment">// 成功改变row，并从队列中移除</span></span><br><span class="line">      <span class="comment">// 失败报错，并保留</span></span><br><span class="line">      res.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (item.<span class="property">status</span> === <span class="string">&quot;fulfilled&quot;</span>) &#123;</span><br><span class="line">          successArr.<span class="title function_">push</span>(item.<span class="property">value</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          failArr.<span class="title function_">push</span>(item.<span class="property">reason</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="title function_">steps</span>((i + <span class="number">1</span>) * size);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">success</span>(successArr);</span><br><span class="line">  <span class="title function_">fail</span>(failArr);</span><br><span class="line">  <span class="title function_">last</span>(successArr, failArr);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="伪类元素-data-属性"><a href="#伪类元素-data-属性" class="headerlink" title="伪类元素+data 属性"></a>伪类元素+data 属性</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">setTitle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  targetDOM.<span class="title function_">attr</span>(<span class="string">&quot;class&quot;</span>, target);</span><br><span class="line">  targetDOM.<span class="title function_">attr</span>(<span class="string">&quot;data-content&quot;</span>, content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.target</span><span class="selector-pseudo">:hover</span><span class="selector-pseudo">:after</span> &#123;</span><br><span class="line">  <span class="attribute">content</span>: <span class="built_in">attr</span>(data-content);</span><br><span class="line">  <span class="attribute">background</span>: <span class="number">#fff</span>;</span><br><span class="line">  <span class="attribute">display</span>: inline-block;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span> <span class="number">14px</span>;</span><br><span class="line">  <span class="attribute">border</span>: <span class="number">1px</span> solid <span class="number">#ddd</span>;</span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">5px</span>;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">z-index</span>: <span class="number">2</span>;</span><br><span class="line">  <span class="attribute">white-space</span>: nowrap;</span><br><span class="line">  <span class="attribute">top</span>: <span class="number">0px</span>;</span><br><span class="line">  <span class="attribute">left</span>: -<span class="number">30px</span>;</span><br><span class="line">  <span class="attribute">box-shadow</span>: <span class="number">2px</span> <span class="number">2px</span> <span class="number">2px</span> <span class="number">#eee</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="bug"><a href="#bug" class="headerlink" title="bug"></a>bug</h4><h5 id="滚动错位"><a href="#滚动错位" class="headerlink" title="滚动错位"></a>滚动错位</h5><p>有固定列存在时，两个通过 onscroll 事件进行滚动的同步，在 Chrome 中默认开启 smooth scrolling，导致了 onscroll 时间有延迟。固定列和主列滚动有时间差，造成滚动错位。<br><strong>解决方法</strong>：监听滚动 wheel 事件，阻止默认行为后，手动来设置 scrollTop 和 scrollLeft 滚动</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">wheel</span> = (<span class="params">e</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 关闭默认事件</span></span><br><span class="line">  e.<span class="title function_">preventDefault</span>();</span><br><span class="line">  <span class="keyword">const</span> &#123; deltaY, deltaX &#125; = e;</span><br><span class="line">  <span class="comment">// 限制只能进行竖或横滚动之一</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">abs</span>(deltaX) &gt; <span class="title class_">Math</span>.<span class="title function_">abs</span>(deltaY)) &#123;</span><br><span class="line">    <span class="title function_">setX</span>(deltaX);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">setY</span>(deltaY);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="滚动卡顿"><a href="#滚动卡顿" class="headerlink" title="滚动卡顿"></a>滚动卡顿</h5><p>计划显示后加载额外数据，请求成功后会修改表格数据，更新 DOM。频繁更新会不断进行渲染过程、对滚动等操作造成卡顿<br>​</p>
<p>请求分片<br>通过监听滚动事件，结合 DOM 元素信息，计算出需要获取的数据，使用 Promise.allSettled，等请求全部完成之后，再一次性进行数据的修改。</p>
<h3 id="移动端"><a href="#移动端" class="headerlink" title="移动端"></a>移动端</h3><p>对照巨量引擎 APP，还有不需要的模块 巨量大学等、数据源只有渠道数据、维度按组-计划-创意、最重要的卡片形式展示数据，同屏数据密度过少，没有批量操作，不能跨账户对比<br>计划管理的移动端版本，方便投手随时随地进行操作，减轻投手假期工作负担。<br>为后续其他功能迁移打基础</p>
<h4 id="vue3-vant-vue-cli"><a href="#vue3-vant-vue-cli" class="headerlink" title="vue3+vant+vue-cli"></a>vue3+vant+vue-cli</h4><p>vue-cli 4.5<br>​</p>
<p>vue3 刚出 20/09 的时候，进行过技术分享，当时在考虑进行前端的重构计划，所以我用新技术进行试水 20/12。</p>
<ol>
<li>移动端 vue3 参考 PC 端的 vue2，许多方法和工具都有参考，移植难度低</li>
<li>vue3 性能更好 <strong>compositionAPI 更符合开发风格</strong> 体积更小， 对 TS 支持更高，方便以后转型</li>
<li>当时 vant element-plus 等都跟进支持了 vue3</li>
<li>试水也带有踩坑的性质</li>
</ol>
<p>​</p>
<h4 id="webpack-优化"><a href="#webpack-优化" class="headerlink" title="webpack 优化"></a>webpack 优化</h4><p>版本 4.44.2<br><a target="_blank" rel="noopener" href="https://www.yuque.com/catcherinsky/notes/wgruiy">https://www.yuque.com/catcherinsky/notes/wgruiy</a></p>
<h4 id="适配"><a href="#适配" class="headerlink" title="适配"></a>适配</h4><p><a target="_blank" rel="noopener" href="https://www.yuque.com/catcherinsky/notes/qw2a1x">https://www.yuque.com/catcherinsky/notes/qw2a1x</a></p>
<h5 id="异形屏"><a href="#异形屏" class="headerlink" title="异形屏"></a>异形屏</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ios</span></span><br><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;viewport-fit=cover&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">body.<span class="property">safe</span>-area &#123;</span><br><span class="line">  padding-<span class="attr">top</span>: <span class="title function_">env</span>(safe-area-inset-top);</span><br><span class="line">  padding-<span class="attr">left</span>: <span class="title function_">env</span>(safe-area-inset-left);</span><br><span class="line">  padding-<span class="attr">right</span>: <span class="title function_">env</span>(safe-area-inset-right);</span><br><span class="line">  padding-<span class="attr">bottom</span>: <span class="title function_">env</span>(safe-area-inset-bottom);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// android</span></span><br><span class="line"><span class="comment">// 监听WebView JS bridge，初始化就绪的时候获取statusbar height</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="property">WebViewJavascriptBridge</span>;</span><br><span class="line"><span class="comment">//JS注册事件监听</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">connectWebViewJavascriptBridge</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="variable language_">window</span>.<span class="property">WebViewJavascriptBridge</span>) &#123;</span><br><span class="line">    <span class="title function_">callback</span>(<span class="title class_">WebViewJavascriptBridge</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">      <span class="string">&quot;WebViewJavascriptBridgeReady&quot;</span>,</span><br><span class="line">      <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title function_">callback</span>(<span class="title class_">WebViewJavascriptBridge</span>);</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="literal">false</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">connectWebViewJavascriptBridge</span>(<span class="function">(<span class="params">bridge</span>) =&gt;</span> &#123;</span><br><span class="line">  bridge.<span class="title function_">getStatusBarHeight</span>(<span class="function">(<span class="params">&#123; height &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> h = height / <span class="variable language_">window</span>.<span class="property">devicePixelRatio</span>; <span class="comment">// 根据需要转换成 CSS 中的 px 高度</span></span><br><span class="line">    <span class="keyword">const</span> root = <span class="variable language_">document</span>.<span class="property">documentElement</span>;</span><br><span class="line">    root.<span class="property">style</span>.<span class="title function_">setProperty</span>(<span class="string">&quot;--safe-top&quot;</span>, <span class="string">`<span class="subst">$&#123;h&#125;</span>px`</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// windowscreen.availHeight</span></span><br></pre></td></tr></table></figure>

<h5 id="手势"><a href="#手势" class="headerlink" title="手势"></a>手势</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多指</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;touchstart&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.<span class="property">touches</span>.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手势</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;gesturestart&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  event.<span class="title function_">preventDefault</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连点</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lastTouchEnd = <span class="number">0</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;touchend&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">    <span class="keyword">if</span> (now - lastTouchEnd &lt;= <span class="number">300</span>) &#123;</span><br><span class="line">      event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    lastTouchEnd = now;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 长按</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;contextmenu&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`禁用长按菜单`</span>);</span><br><span class="line">  e.<span class="title function_">preventDefault</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="拖拽"><a href="#拖拽" class="headerlink" title="拖拽"></a>拖拽</h5><h5 id="横屏"><a href="#横屏" class="headerlink" title="横屏"></a>横屏</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// window.orientation</span></span><br><span class="line"><span class="comment">// 180 || 0 竖屏</span></span><br><span class="line"><span class="comment">// 90 || -90 横屏</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;onorientationchange&quot;</span> <span class="keyword">in</span> <span class="variable language_">window</span> ? <span class="string">&quot;orientationchange&quot;</span> : <span class="string">&quot;resize&quot;</span>,</span><br><span class="line">  screenChange,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="虚拟表格"><a href="#虚拟表格" class="headerlink" title="虚拟表格"></a>虚拟表格</h4><p><a target="_blank" rel="noopener" href="https://www.yuque.com/catcherinsky/notes/yti9rs#A5WBB">https://www.yuque.com/catcherinsky/notes/yti9rs#A5WBB</a><br>​</p>
<h4 id="hybrid"><a href="#hybrid" class="headerlink" title="hybrid"></a>hybrid</h4><p>对比 hybrid 原生 web 方案优劣，当前方案原因?<br>安卓+IOS 套壳浏览器<br>一次开发，双端通用<br>缓存问题： Nginx 配置不缓存 index.html<br>​</p>
<p>hybrid app 允许开发者仅使用一套网页语言代码（HTML5+CSS+JavaScript），即可开发能够在不同平台上部署的类原生应用 。由于 hybrid app 结合了 native app 良好用户交互体验和 web app 跨平台开发的优势，能够显著节省移动应用开发的时间和成本。<strong>应用主体是 web view</strong>，穿插 native 功能，主要以网页语言编写。整体开发难度低，基本可以实现跨平台<br>​</p>
<p>初始化时获取 jsbridge 数据，有就是 app 访问，没有就是网页访问。<br>​</p>
<h4 id="为什么不-Web-APP？"><a href="#为什么不-Web-APP？" class="headerlink" title="为什么不 Web APP？"></a>为什么不 Web APP？</h4><p>手机浏览器兼容太繁琐，指定内核的 Hybrid 更容易<br>​</p>
<h5 id="为什么不用-PWA？"><a href="#为什么不用-PWA？" class="headerlink" title="为什么不用 PWA？"></a>为什么不用 PWA？</h5><p>需要快速上线，存在开发门槛<br>ios11.3 才支持，只能在 safari 分享到主屏幕。<br>安全问题和保密问题，水印等等</p>
<h5 id="为什么不小程序？"><a href="#为什么不小程序？" class="headerlink" title="为什么不小程序？"></a>为什么不小程序？</h5><p>安全考虑，发版需要找腾讯<br>​</p>
<h5 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h5><p>快速方便开发<br>一次开发，双端通用<br>​</p>
<h4 id="bug-1"><a href="#bug-1" class="headerlink" title="bug"></a><del>bug</del></h4><h5 id="跳转后在浏览器看的高度问题"><a href="#跳转后在浏览器看的高度问题" class="headerlink" title="跳转后在浏览器看的高度问题"></a>跳转后在浏览器看的高度问题</h5><p>跳转后设置 scrollTop 为 0 后，在实机不复现，不管。</p>
<h5 id="sticky"><a href="#sticky" class="headerlink" title="sticky"></a>sticky</h5><p>一般的 ui 表格用多个表格叠加，隐去若干部分来实现固定列和固定表头效果，假如固定列 sticky； left 0 表头 sticky；top 0。在表格所有元素都在同一个 scrolling box 的前提下，会导致固定列的表头定位出现问题<br><img src="https://cdn.nlark.com/yuque/0/2022/png/106384/1641114933319-ed74f3e5-c310-4721-a40b-7acb340e0ed6.png#clientId=u2e4903fd-0f95-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=403&id=u2e31ca11&margin=%5Bobject%20Object%5D&name=image.png&originHeight=805&originWidth=402&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=23075&status=done&style=none&taskId=ua0c87945-4e75-4261-9673-2e1532334a3&title=&width=201" alt="image.png"></p>
<h5 id="固定表头方案"><a href="#固定表头方案" class="headerlink" title="固定表头方案"></a>固定表头方案</h5><p>position: absolute + 动态 top<br>​</p>
<p>不用 sticky？<br>一般而言只要往父级查找，遇到的第一个 overflow 不是 visible 的元素就是最近滚动祖先(scrollport)<br>表格设置了 overflow，所以最近滚动祖先是表格而不是视口。而表格是超长的，不会发生滚动，滚动的是 HTML，无法触发 sticky 的效果。<br>​</p>
<p>A: sticky top: 0<br>B: A 的父元素<br>C: HTML<br>视口 viewport: 最近滚动祖先<br>​</p>
<p>待优化<br>把虚拟表格的 page 模式改成窗口模式</p>
<h5 id="固定列方案"><a href="#固定列方案" class="headerlink" title="固定列方案"></a>固定列方案</h5><p>position: sticky + 指定 left<br>​</p>
<p>position: sticky<br>表格父元素，宽度为可视视口宽度， overflow-x: scroll。<br>之前是父元素的父元素可滚动，父元素 overflow: visible, 当横向滚动使父元素超出浏览器可视区域，sticky 元素也会跟着滚出窗口</p>
<h5 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h5><p>​</p>
<p>​</p>
<p>​</p>
<p>​</p>
<h3 id="通用报表系统"><a href="#通用报表系统" class="headerlink" title="通用报表系统"></a>通用报表系统</h3><p>后端即配即用，提高效率，使用 render 和插槽增强报表功能。<br>​</p>
<p>和配置化表单联用，后端输出筛选项，根据筛选项请求表格数据，渲染表格。<br>​</p>
<p>插槽中包含下拉功能<br>​</p>
<p>render 函数开发，可配置性更强<br>​</p>
<p>某些需要自定义的列，写一个匹配函数，遍历 column 的时候匹配成功就替换 render 函数。</p>
<p>通用报表数据存在后端的，数量稳定，用分页方案。</p>
<p>​</p>
<h3 id="配置化表单组件库"><a href="#配置化表单组件库" class="headerlink" title="配置化表单组件库"></a>配置化表单组件库</h3><p>项目涉及到大量的表单开发，而且表单不易复用，基于 element 进行二次封装。<br>配置项书写方式类 schema<br>​</p>
<p>需要同时协调后端和产品配合，流程文档化、规范化。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">&quot;&quot;</span> <span class="attr">v-bind</span>=<span class="string">&quot;&quot;</span> <span class="attr">v-on</span>=<span class="string">&quot;&quot;</span> $<span class="attr">attrs</span>=<span class="string">&quot;&quot;</span> $<span class="attr">listeners</span>=<span class="string">&quot;&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>​</p>
<p>​</p>
<h3 id="可视化广告策略分析"><a href="#可视化广告策略分析" class="headerlink" title="可视化广告策略分析"></a>可视化广告策略分析</h3><h4 id="可视化思想"><a href="#可视化思想" class="headerlink" title="可视化思想"></a>可视化思想</h4><p>借助图形化的数段，清晰有效的传递和沟通信息，以视觉的方式展现数据，便于用户的认知，偏于图表的样式，相对于文字说明更加直观</p>
<h5 id="优点-1"><a href="#优点-1" class="headerlink" title="优点"></a>优点</h5><p>分析出数据的趋势<br>进行精准的广告投放</p>
<h4 id="echart"><a href="#echart" class="headerlink" title="echart"></a>echart</h4><p>生态比较好，应用比较广泛，基于配置化。拓展容易。<br>没啥必要再封装组件，除了某些重复使用的。chart 本来就是配置化的，基于配置化再次配置化有些冗余。大部分都是独特的组件<br>​</p>
<h5 id="卡顿"><a href="#卡顿" class="headerlink" title="卡顿"></a>卡顿</h5><p>每一个图例在没有数据的时候它会创建一个定时器去渲染气泡，页面切换后，echarts 图例是销毁了，但是这个 echarts 的实例还在内存当中，同时它的气泡渲染定时器还在运行。这就导致 Echarts 占用 CPU 高，导致浏览器卡顿，当数据量比较大时甚至浏览器崩溃<br>​</p>
<p>在 mounted()方法和 destroy()方法之间加一个 beforeDestroy()方法释放该页面的 chart 资源，clear()方法则是清空图例数据，不影响图例的 resize，而且能够释放内存，切换的时候就很顺畅了</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">clear</span>() <span class="title function_">destroy</span>()</span><br><span class="line"><span class="title function_">dispose</span>()</span><br></pre></td></tr></table></figure>

<h5 id="nextTick"><a href="#nextTick" class="headerlink" title="nextTick"></a>nextTick</h5><p>vue 更新 dom 之后需要 nextTick 才能获取更新后 dom 元素，用来重新绘制 echart</p>
<h5 id="resize-响应式"><a href="#resize-响应式" class="headerlink" title="resize 响应式"></a>resize 响应式</h5><p>用于当 div 发生 resize 事件的时候，让其触发 echart 的 resize 事件，重绘 canvas。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">&quot;.chart&quot;</span>).<span class="title function_">resize</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  myChartx.<span class="title function_">resize</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="数据清洗"><a href="#数据清洗" class="headerlink" title="数据清洗"></a>数据清洗</h4><p>​</p>
<p>​</p>
<h4 id="webworker"><a href="#webworker" class="headerlink" title="webworker"></a>webworker</h4><p>同上<br>​</p>
<p>​</p>
<p>​</p>
<h4 id="vue3-需要-unwrap"><a href="#vue3-需要-unwrap" class="headerlink" title="vue3 需要 unwrap"></a>vue3 需要 unwrap</h4><p>vue3 中使用了 Proxy 对象代理，但 echarts 中使用大量的 === 造成对比失败</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">unwarp</span> = (<span class="params">obj</span>) =&gt; obj &amp;&amp; (obj.<span class="property">__v_raw</span> || obj.<span class="title function_">valueOf</span>() || obj);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">this</span>.<span class="property">chart</span> = <span class="title function_">unwrap</span>(echarts.<span class="title function_">init</span>(dom));</span><br></pre></td></tr></table></figure>

<h4 id="按需加载-echart"><a href="#按需加载-echart" class="headerlink" title="按需加载 echart"></a>按需加载 echart</h4><p>使用 babel-plugin-equire 插件实现按需加载</p>
<h3 id="超级投放"><a href="#超级投放" class="headerlink" title="超级投放"></a>超级投放</h3><p>配置化表单的方向发展。一些字段之间的相互影响比较复杂。而且许多影响都是异步的，涉及请求。<br>trigger 之后清空相关字段并禁选，等请求完成再接着处理</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  watch: &#123;</span><br><span class="line">    `$&#123;key&#125;`: fn</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
<p>​</p>
<p>​</p>
<p>​</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/12/31/%E6%9D%82%E8%B0%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/31/%E6%9D%82%E8%B0%88/" class="post-title-link" itemprop="url">杂谈</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-31 11:16:53" itemprop="dateCreated datePublished" datetime="2021-12-31T11:16:53+08:00">2021-12-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:01" itemprop="dateModified" datetime="2022-02-14T19:41:01+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="自我介绍"><a href="#自我介绍" class="headerlink" title="自我介绍"></a>自我介绍</h2><p>你好，我是来自 4399 的___，毕业于中山大学化学学院。目前在市场数据部担任前端工程师，主要工作是内部数据系统的前端开发，为游戏广告投放全流程提供操作的平台。<br>主要的工作技术栈是 vue 全家桶，我负责开发的广告投放管理系统使用虚拟列表的技术，可以同时跨渠道跨账户对上万条广告进行展示和操作，为我们公司最近几次大推的成功提供了技术支持。同时也很早的使用 vue3 和 Hybrid 技术来开发这一系统的移动端，为投手的闲时操作带来方便。<br>我个人比较乐观开朗，愿意和人沟通分享，工作之余也会通过书籍、博客等途径来接触前沿前端知识，不断完善个人的技术架构。<br>以上是我的自我介绍<br>（260+字）<br>​</p>
<blockquote>
<p>目前拥有的技术背景和项目经验匹配</p>
</blockquote>
<h2 id="工作介绍"><a href="#工作介绍" class="headerlink" title="工作介绍"></a>工作介绍</h2><p>见简历</p>
<h2 id="离职原因"><a href="#离职原因" class="headerlink" title="离职原因"></a>离职原因</h2><ol>
<li>女朋友毕业，考虑双方规划</li>
<li>发展瓶颈，目前业务模型比较稳定，希望寻求个人突破</li>
</ol>
<h2 id="职业规划"><a href="#职业规划" class="headerlink" title="职业规划"></a>职业规划</h2><p>目前还是往技术方向走，在一个基建完善技术氛围好的团队挖掘自己的潜力，在贴合业务的过程中完善技术架构</p>
<h2 id="期望薪资"><a href="#期望薪资" class="headerlink" title="期望薪资"></a>期望薪资</h2><p>3 字头</p>
<h2 id="自我评价"><a href="#自我评价" class="headerlink" title="自我评价"></a>自我评价</h2><h3 id="擅长技术"><a href="#擅长技术" class="headerlink" title="擅长技术"></a>擅长技术</h3><p><del>擅长梳理组件之间的逻辑，抽象出基本的业务模型</del><br>表格表单类组件的实现和性能优化</p>
<h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>能够综合业务去思考技术的切入点，善于发现问题。在发现我们的前端报表业务是可以抽象之后，沟通产品和后端形成了一套报表规范，并根据规范开发通用报表系统。减少了前端的重复性工作。</p>
<h3 id="技术不足"><a href="#技术不足" class="headerlink" title="技术不足"></a>技术不足</h3><p>技术不够全面，以前端来说，node 和工程化部分学得不够深入，也比较缺乏实践的机会<br>​</p>
<h3 id="性格不足"><a href="#性格不足" class="headerlink" title="性格不足"></a>性格不足</h3><p>不懂的技术会花很多时间去研究，企图对这块技术有一个全面的认知，这给自己加了不少工作量。要学会抓重点，最快速度把握对业务最重要的内容并学透才更有必要<br>​</p>
<h2 id="学习途径"><a href="#学习途径" class="headerlink" title="学习途径"></a>学习途径</h2><p>以业务为导向，深入技术细节<br>记下一些点之后通过看书，查漏补缺<br>闲时开发些小游戏：贪吃蛇五子棋</p>
<h3 id="书"><a href="#书" class="headerlink" title="书"></a>书</h3><p>红宝书<br>设计模式<br>移动端<br>三本小黄书<br>​</p>
<h3 id="网站"><a href="#网站" class="headerlink" title="网站"></a>网站</h3><p>MDN<br>W3C<br>can i use<br>掘金<br>语雀<br>知乎<br>​</p>
<h3 id="博客"><a href="#博客" class="headerlink" title="博客"></a>博客</h3><p>奇舞 凹凸 alloyTeam<br>阮一峰 大漠 张鑫旭 贺师俊<br>​</p>
<p>​</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CatcherInSky"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">CatcherInSky</p>
  <div class="site-description" itemprop="description">CatcherInSky的前端知识库</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CatcherInSky" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CatcherInSky" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhangchunxiang98@outlook.com" title="E-Mail → mailto:zhangchunxiang98@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CatcherInSky</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
