<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"catcherinsky.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="功能  资源构建  浏览器无法识别部分前端资源（ts&#x2F;sass），需要经过编译处理，webpack 集成编译工具  静态模块打包  对图片等静态资源，webpack 根据引用关系，构建依赖关系图，然后将静态模块打包成 bundle 输出。打包各环节还可以进行图片压缩、js 混淆等额外处理  调用后端接口跨域  通过 devServer  热更新  通过内置热更新模块  ES+语法兼容性  通过引入">
<meta property="og:type" content="article">
<meta property="og:title" content="Webpack">
<meta property="og:url" content="http://catcherinsky.github.io/2021/08/31/Webpack/index.html">
<meta property="og:site_name" content="Knowlegde Bases of CatcherInSky">
<meta property="og:description" content="功能  资源构建  浏览器无法识别部分前端资源（ts&#x2F;sass），需要经过编译处理，webpack 集成编译工具  静态模块打包  对图片等静态资源，webpack 根据引用关系，构建依赖关系图，然后将静态模块打包成 bundle 输出。打包各环节还可以进行图片压缩、js 混淆等额外处理  调用后端接口跨域  通过 devServer  热更新  通过内置热更新模块  ES+语法兼容性  通过引入">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630381728676-994c1dec-1347-4b7a-b0a7-d6c9afff47f6.png#clientId=uca7be9d5-6f50-4&from=paste&height=502&id=u976bc229&margin=%5Bobject%20Object%5D&name=image.png&originHeight=502&originWidth=1133&originalType=binary%E2%88%B6=1&size=50453&status=done&style=none&taskId=ub33fa864-ab09-4550-b351-3d960369383&width=1133">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/jpeg/106384/1630401267510-b93845f7-0058-4ef9-a19f-199b7079f47b.jpeg#clientId=uca7be9d5-6f50-4&from=paste&height=1774&id=u8be6334b&margin=%5Bobject%20Object%5D&name=%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%87.jpg&originHeight=1774&originWidth=1726&originalType=binary%E2%88%B6=1&size=405815&status=done&style=none&taskId=ubc5a41ae-3753-4da0-8d04-60cbe3942d0&width=1726">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630465762270-b013cb5d-7b81-4dd7-902f-ea98c995cb4e.png#clientId=uca7be9d5-6f50-4&from=paste&id=u18c66a64&margin=%5Bobject%20Object%5D&name=image.png&originHeight=814&originWidth=1254&originalType=url%E2%88%B6=1&size=162045&status=done&style=none&taskId=u0aea49ab-5e96-4e59-b799-6de478119ce">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630574715011-d187e39b-b82b-4a1b-b255-ba351badc5a4.png#clientId=uad1c3d9d-4039-4&from=paste&height=792&id=ua78b00e6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=792&originWidth=1494&originalType=binary%E2%88%B6=1&size=659082&status=done&style=none&taskId=uf350a206-9047-4547-bfce-259ba45c211&width=1494">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/jpeg/106384/1630402291001-d48cf483-0fad-477f-bca5-f73f7cae4c8f.jpeg#clientId=uca7be9d5-6f50-4&from=paste&height=1874&id=uef2f8fb7&margin=%5Bobject%20Object%5D&name=%E5%88%9D%E5%A7%8B%E5%8C%96.jpg&originHeight=1874&originWidth=2954&originalType=binary%E2%88%B6=1&size=537373&status=done&style=none&taskId=u4756ea0e-0ac0-42d9-b52d-7c3f877cdd9&width=2954">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/jpeg/106384/1630575345002-7faa3cc8-289c-4c88-8acd-1114661930bd.jpeg#clientId=uad1c3d9d-4039-4&from=paste&height=1854&id=u814bb222&margin=%5Bobject%20Object%5D&name=%E6%9E%84%E5%BB%BA%20%281%29.jpg&originHeight=1854&originWidth=2574&originalType=binary%E2%88%B6=1&size=519841&status=done&style=none&taskId=uf5e31a9a-494a-40c9-89d2-d5504d3fb50&width=2574">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/jpeg/106384/1630466193516-2fbd5ac0-2857-4274-8ef8-51d28b8eda34.jpeg#clientId=uca7be9d5-6f50-4&from=paste&height=2260&id=u1e930c54&margin=%5Bobject%20Object%5D&name=%E7%94%9F%E6%88%90.jpg&originHeight=2260&originWidth=1814&originalType=binary%E2%88%B6=1&size=636342&status=done&style=none&taskId=ueeaf714c-6dc1-4dfe-8d64-da30b8e6e25&width=1814">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/jpeg/106384/1630468659028-d7803d2a-de68-4ab1-8645-f565971f8a3f.jpeg#clientId=uca7be9d5-6f50-4&from=paste&height=713&id=Ve7qO&margin=%5Bobject%20Object%5D&name=image.jpg&originHeight=713&originWidth=678&originalType=binary%E2%88%B6=1&size=99660&status=done&style=none&taskId=uee06ee96-6a2d-4ec1-b61f-1584ebad6e6&width=678">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630466659503-fb29acd3-e2ff-40ed-afda-8fcf4b77ac12.png#clientId=uca7be9d5-6f50-4&from=paste&id=ue921f064&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2243&originWidth=760&originalType=url%E2%88%B6=1&size=163196&status=done&style=none&taskId=uebc60d66-9e3c-44c4-9b98-ca13f164eb3">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630575987411-da2b1ccb-b0a8-405d-8f18-f25effe72bae.png#clientId=uad1c3d9d-4039-4&from=paste&id=ud41b6a23&margin=%5Bobject%20Object%5D&name=image.png&originHeight=714&originWidth=1794&originalType=url%E2%88%B6=1&size=179279&status=done&style=none&taskId=u976e4c64-812c-481b-a1b6-776edaeaec2">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630576060183-e67b59a8-3c82-46b7-90f0-fcf6306c4622.png#clientId=uad1c3d9d-4039-4&from=paste&id=u6067eeb4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=714&originWidth=1794&originalType=url%E2%88%B6=1&size=208176&status=done&style=none&taskId=uff277e87-006c-417e-ada3-71996dc4740">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630482233053-660dbc9c-635c-4b15-a226-3809d74b542e.png#clientId=uca7be9d5-6f50-4&from=paste&id=u6a13f753&margin=%5Bobject%20Object%5D&name=image.png&originHeight=749&originWidth=720&originalType=url%E2%88%B6=1&size=270235&status=done&style=none&taskId=u7ef2e4f6-4876-40df-b58f-9e4b30aa803">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630576738307-a4b62e1c-8125-4e1a-9fdf-618ac7f89bef.png#clientId=uad1c3d9d-4039-4&from=paste&height=351&id=uf5fbd1a8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=351&originWidth=653&originalType=binary%E2%88%B6=1&size=41513&status=done&style=none&taskId=u6900cdf9-6c8b-4d1f-87fd-b283fcd6c47&width=653">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/webp/106384/1630637392658-d8640311-fa66-40e6-84c5-16c3090476b4.webp#clientId=uad1c3d9d-4039-4&from=paste&id=uca8be444&margin=%5Bobject%20Object%5D&originHeight=238&originWidth=802&originalType=url%E2%88%B6=1&status=done&style=none&taskId=ue9f52fac-826e-43ff-b61f-50d9ee9922f">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/webp/106384/1630637396944-d9c2ac89-c04f-4f17-8b2e-fb848bb4ff0f.webp#clientId=uad1c3d9d-4039-4&from=paste&id=u2bd26130&margin=%5Bobject%20Object%5D&originHeight=497&originWidth=886&originalType=url%E2%88%B6=1&status=done&style=none&taskId=u8cca1d4d-1602-480f-8fa4-d91557713b5">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630575130712-25f83667-f43a-47e6-9aa4-dd496d59308e.png#clientId=uad1c3d9d-4039-4&from=paste&id=udcb9134f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=876&originWidth=1654&originalType=url%E2%88%B6=1&size=235530&status=done&style=none&taskId=u3fc78e68-27b4-4aad-b71e-a3c17a30823">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630575380574-ce88e7e5-fe8f-4a22-b716-ed1b6e03b62b.png#clientId=uad1c3d9d-4039-4&from=paste&id=ud3a646e5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1854&originWidth=2574&originalType=url%E2%88%B6=1&size=518148&status=done&style=none&taskId=u86c51e84-9bab-474a-946a-80f6bfd737c">
<meta property="article:published_time" content="2021-08-31T03:19:07.000Z">
<meta property="article:modified_time" content="2022-02-14T11:41:04.921Z">
<meta property="article:author" content="CatcherInSky">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2021/png/106384/1630381728676-994c1dec-1347-4b7a-b0a7-d6c9afff47f6.png#clientId=uca7be9d5-6f50-4&from=paste&height=502&id=u976bc229&margin=%5Bobject%20Object%5D&name=image.png&originHeight=502&originWidth=1133&originalType=binary%E2%88%B6=1&size=50453&status=done&style=none&taskId=ub33fa864-ab09-4550-b351-3d960369383&width=1133">

<link rel="canonical" href="http://catcherinsky.github.io/2021/08/31/Webpack/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Webpack | Knowlegde Bases of CatcherInSky</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
  <meta name="referrer" content="same-origin">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Knowlegde Bases of CatcherInSky</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">CatcherInSky的前端知识库</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/08/31/Webpack/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Webpack
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-08-31 11:19:07" itemprop="dateCreated datePublished" datetime="2021-08-31T11:19:07+08:00">2021-08-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:04" itemprop="dateModified" datetime="2022-02-14T19:41:04+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1630381728676-994c1dec-1347-4b7a-b0a7-d6c9afff47f6.png#clientId=uca7be9d5-6f50-4&from=paste&height=502&id=u976bc229&margin=%5Bobject%20Object%5D&name=image.png&originHeight=502&originWidth=1133&originalType=binary%E2%88%B6=1&size=50453&status=done&style=none&taskId=ub33fa864-ab09-4550-b351-3d960369383&width=1133" alt="image.png"></p>
<ul>
<li>资源构建</li>
</ul>
<p>浏览器无法识别部分前端资源（ts/sass），需要经过编译处理，webpack 集成编译工具</p>
<ul>
<li>静态模块打包</li>
</ul>
<p>对图片等静态资源，webpack 根据引用关系，构建依赖关系图，然后将静态模块打包成 bundle 输出。打包各环节还可以进行图片压缩、js 混淆等额外处理</p>
<ul>
<li>调用后端接口跨域</li>
</ul>
<p>通过 devServer</p>
<ul>
<li>热更新</li>
</ul>
<p>通过内置热更新模块</p>
<ul>
<li>ES+语法兼容性</li>
</ul>
<p>通过引入 babel 等根据</p>
<h2 id="核心流程"><a href="#核心流程" class="headerlink" title="核心流程"></a>核心流程</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/106384/1630401267510-b93845f7-0058-4ef9-a19f-199b7079f47b.jpeg#clientId=uca7be9d5-6f50-4&from=paste&height=1774&id=u8be6334b&margin=%5Bobject%20Object%5D&name=%E6%9C%AA%E5%91%BD%E5%90%8D%E5%9B%BE%E7%89%87.jpg&originHeight=1774&originWidth=1726&originalType=binary%E2%88%B6=1&size=405815&status=done&style=none&taskId=ubc5a41ae-3753-4da0-8d04-60cbe3942d0&width=1726" alt="未命名图片.jpg"></p>
<ol>
<li>初始化阶段：<ol>
<li>初始化参数：从配置文件、 配置对象、Shell 参数中读取，与默认配置结合得出最终的参数</li>
<li>创建编译器对象：用上一步得到的参数创建 **Compiler **对象（包含了 Webpack <strong>环境所有的的配置信息</strong>，包含 options，loaders，plugins 信息，它是全局唯一的）</li>
<li>初始化编译环境：包括<strong>注入内置插件</strong>、注册各种模块工厂、初始化 RuleSet 集合、<strong>加载配置的 Plugin</strong>等</li>
<li>开始编译：执行 compiler 对象的 <strong>run</strong> 方法</li>
<li>确定入口：根据配置中的 entry 找出所有的入口文件，调用 compilation.addEntry 将入口文件转换为 <strong>dependence</strong> 对象</li>
</ol>
</li>
<li>构建阶段：<ol>
<li>编译模块(make)：根据 entry 对应的 dependence 创建 <strong>module</strong> 对象，调用** loader **将模块转译为标准 JS 内容，调用 JS 解释器将内容转换为 <strong>AST</strong> 对象，从中找出该模块依赖的模块，再 **递归 **本步骤直到所有入口依赖的文件都经过了本步骤的处理</li>
<li>完成模块编译：上一步递归处理所有能触达到的模块后，得到了每个模块被翻译后的内容以及它们之间的 <strong>依赖关系图</strong></li>
</ol>
</li>
<li>生成阶段：<ol>
<li>输出资源(seal)：根据入口和模块之间的依赖关系，组装成一个个包含多个模块的** Chunk**，再把每个 Chunk 转换成一个单独的文件加入到输出列表，这步是可以修改输出内容的最后机会</li>
<li>写入文件系统(emitAssets)：在确定好输出内容后，根据配置确定输出的路径和文件名，把文件内容写入到文件系统</li>
</ol>
</li>
</ol>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1630465762270-b013cb5d-7b81-4dd7-902f-ea98c995cb4e.png#clientId=uca7be9d5-6f50-4&from=paste&id=u18c66a64&margin=%5Bobject%20Object%5D&name=image.png&originHeight=814&originWidth=1254&originalType=url%E2%88%B6=1&size=162045&status=done&style=none&taskId=u0aea49ab-5e96-4e59-b799-6de478119ce" alt="image.png"></p>
<ul>
<li>compiler.make 阶段：<ul>
<li>entry 文件以 dependence 对象形式加入 compilation 的依赖列表，dependence 对象记录有 entry 的类型、路径等信息</li>
<li>根据 dependence 调用对应的工厂函数创建 module 对象，之后读入 module 对应的文件内容，调用 loader-runner 对内容做转化，转化结果若有其它依赖则继续读入依赖资源，重复此过程直到所有依赖均被转化为 module</li>
</ul>
</li>
<li>compilation.seal 阶段：<ul>
<li>遍历 module 集合，根据 entry 配置及引入资源的方式，将 module 分配到不同的 chunk</li>
<li>遍历 chunk 集合，调用 compilation.emitAsset 方法标记 chunk 的输出规则，即转化为 assets 集合</li>
</ul>
</li>
<li>compiler.emitAssets 阶段：<ul>
<li>将 assets 写入文件系统.</li>
</ul>
</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1630574715011-d187e39b-b82b-4a1b-b255-ba351badc5a4.png#clientId=uad1c3d9d-4039-4&from=paste&height=792&id=ua78b00e6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=792&originWidth=1494&originalType=binary%E2%88%B6=1&size=659082&status=done&style=none&taskId=uf350a206-9047-4547-bfce-259ba45c211&width=1494" alt="image.png"><br>​</p>
<h2 id="初始化阶段"><a href="#初始化阶段" class="headerlink" title="初始化阶段"></a>初始化阶段</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/106384/1630402291001-d48cf483-0fad-477f-bca5-f73f7cae4c8f.jpeg#clientId=uca7be9d5-6f50-4&from=paste&height=1874&id=uef2f8fb7&margin=%5Bobject%20Object%5D&name=%E5%88%9D%E5%A7%8B%E5%8C%96.jpg&originHeight=1874&originWidth=2954&originalType=binary%E2%88%B6=1&size=537373&status=done&style=none&taskId=u4756ea0e-0ac0-42d9-b52d-7c3f877cdd9&width=2954" alt="初始化.jpg"><br>WebpackOptionsApply 会在初始化阶段根据配置内容动态注入对应的插件，包括：</p>
<ul>
<li>注入 EntryOptionPlugin 插件，处理 entry 配置</li>
<li>根据 devtool 值判断后续用那个插件处理 sourcemap，可选值：EvalSourceMapDevToolPlugin、SourceMapDevToolPlugin、EvalDevToolModulePlugin</li>
<li>注入 RuntimePlugin ，用于根据代码内容动态注入 webpack 运行时</li>
</ul>
<p>​</p>
<p>​</p>
<h2 id="构建阶段"><a href="#构建阶段" class="headerlink" title="构建阶段"></a>构建阶段</h2><p>构建阶段从 entry 开始递归解析资源与资源的依赖，在 compilation 对象内逐步<strong>构建出 module 集合以及 module 之间的依赖关系</strong>，核心流程：<br><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/106384/1630575345002-7faa3cc8-289c-4c88-8acd-1114661930bd.jpeg#clientId=uad1c3d9d-4039-4&from=paste&height=1854&id=u814bb222&margin=%5Bobject%20Object%5D&name=%E6%9E%84%E5%BB%BA%20%281%29.jpg&originHeight=1854&originWidth=2574&originalType=binary%E2%88%B6=1&size=519841&status=done&style=none&taskId=uf5e31a9a-494a-40c9-89d2-d5504d3fb50&width=2574" alt="构建 (1).jpg"><br>这个过程中数据流 <strong>module =&gt; ast =&gt; dependences =&gt; module <strong>，先转 AST 再识别 require/ import 之类的导入语句，确定模块对其他资源的依赖关系。<br>比如说对于图片，需要从图像二进制转换成类似于 export default “data:image/png;base64,xxx” 这类 base64 格式或者 export default “<a target="_blank" rel="noopener" href="http://xxx"/">http://xxx”</a> 这类 url 格式。<br>compilation 按这个流程递归处理，逐步解析出每个模块的内容以及 module 依赖关系，后续就可以根据这些内容打包输出。<br>Compilation 对象包含了</strong>当前的模块资源、编译生成资源、变化的文件</strong>等。当 Webpack 以开发模式运行时，每当检测到一个文件变化，一次新的 Compilation 将被创建。Compilation 对象也提供了很多事件回调供插件做扩展。通过 Compilation 也能读取到 Compiler 对象<br>Compiler 和 Compilation 的区别在于：<strong>Compiler 代表了整个 Webpack 从启动到关闭的生命周期，而 Compilation 只是代表了一次新的编译</strong><br>​</p>
<p>​</p>
<h2 id="生成阶段"><a href="#生成阶段" class="headerlink" title="生成阶段"></a>生成阶段</h2><p>生成阶段<strong>围绕 chunks 展开</strong>。经过构建阶段之后，webpack 得到足够的模块内容与模块关系信息，接下来开始生成最终资源了。<br>seal 函数主要完成从 module 到 chunks 的转化，核心流程：<br><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/106384/1630466193516-2fbd5ac0-2857-4274-8ef8-51d28b8eda34.jpeg#clientId=uca7be9d5-6f50-4&from=paste&height=2260&id=u1e930c54&margin=%5Bobject%20Object%5D&name=%E7%94%9F%E6%88%90.jpg&originHeight=2260&originWidth=1814&originalType=binary%E2%88%B6=1&size=636342&status=done&style=none&taskId=ueeaf714c-6dc1-4dfe-8d64-da30b8e6e25&width=1814" alt="生成.jpg"></p>
<p>webpack 内置的 chunk 封装规则比较简单：</p>
<ul>
<li>entry 及 entry 触达到的模块，组合成一个 chunk</li>
<li>使用动态引入语句引入的模块，各自组合成一个 chunk</li>
<li>chunk 公共代码的提取和异步加载需要代码分割来实现</li>
</ul>
<p>chunk 是输出的基本单位，默认情况下这些 chunks 与最终输出的资源一一对应，那按上面的规则大致上可以推导出一个 entry 会对应打包出一个资源，而通过动态引入语句引入的模块，也对应会打包出相应的资源<br>​</p>
<p>​</p>
<h2 id="Plugin"><a href="#Plugin" class="headerlink" title="Plugin"></a>Plugin</h2><p>Webpack 通过 Plugin 机制让其更加灵活，以适应各种应用场景。 在 Webpack 运行的生命周期中会广播出许多事件，Plugin 可以监听这些事件，在合适的时机通过 Webpack 提供的 API 改变输出结果。<br>webpack 的插件体系基于<strong>tapable</strong>实现的发布订阅模式构建<strong>，</strong>是一种非常强耦合的设计，hooks 回调由 webpack 决定何时，以何种方式执行；而在 hooks 回调内部可以通过修改状态、调用上下文 api 等方式对 webpack 产生 side effect。</p>
<ul>
<li><em>发布订阅模式与观察者模式的不同，“第三者” （事件中心）出现。目标对象并不直接通知观察者，而是通过事件中心来派发通知。</em></li>
</ul>
<p>一个最基础的 Plugin 的代码是这样的：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BasicPlugin</span> &#123;</span><br><span class="line">  <span class="comment">// 在构造函数中获取用户给该插件传入的配置</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options</span>) &#123;&#125;</span><br><span class="line">  <span class="comment">// Webpack 会调用 BasicPlugin 实例的 apply 方法给插件实例传入 compiler / Compilation 对象， 并且可以通过 compiler 对象去操作 Webpack。</span></span><br><span class="line">  <span class="title function_">apply</span>(<span class="params">compiler</span>) &#123;</span><br><span class="line">    <span class="comment">// 监听事件</span></span><br><span class="line">    <span class="comment">// 异步的事件需要在插件处理完任务时调用回调函数通知 Webpack 进入下一个流程，不然会卡住;</span></span><br><span class="line">    compiler.<span class="title function_">plugin</span>(<span class="string">&quot;compilation&quot;</span>, <span class="keyword">function</span> (<span class="params">compilation</span>) &#123;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 导出 Plugin</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="title class_">BasicPlugin</span>;</span><br></pre></td></tr></table></figure>

<h3 id="Tapable"><a href="#Tapable" class="headerlink" title="Tapable"></a><a target="_blank" rel="noopener" href="https://github.com/webpack/tapable">Tapable</a></h3><p>Tapable 是 Webpack 插件架构的核心支架，本质上就是围绕着 订阅/发布 模式叠加各种特化逻辑，适配 webpack 体系下复杂的事件源-处理器之间交互需求，比如说有些场景需要支持将前一个处理器的结果传入下一个回调处理器；有些场景需要支持异步并行调用这些回调处理器。<br>Tapable 使用时通常需要经历如下步骤：<br>创建钩子实例（成对出现）：</p>
<ul>
<li>调用订阅接口注册回调，包括：tap、tapAsync、tapPromise</li>
<li>调用发布接口触发回调，包括：call、callAsync、promise</li>
</ul>
<h4 id="动态编译"><a href="#动态编译" class="headerlink" title="动态编译"></a>动态编译</h4><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6955421936373465118">https://juejin.cn/post/6955421936373465118</a></p>
<h3 id="钩子触发"><a href="#钩子触发" class="headerlink" title="钩子触发"></a>钩子触发</h3><h4 id="总流程"><a href="#总流程" class="headerlink" title="总流程"></a>总流程</h4><h4 id="compiler-对象"><a href="#compiler-对象" class="headerlink" title="compiler 对象"></a>compiler 对象</h4><p><img src="https://cdn.nlark.com/yuque/0/2021/jpeg/106384/1630468659028-d7803d2a-de68-4ab1-8645-f565971f8a3f.jpeg#clientId=uca7be9d5-6f50-4&from=paste&height=713&id=Ve7qO&margin=%5Bobject%20Object%5D&name=image.jpg&originHeight=713&originWidth=678&originalType=binary%E2%88%B6=1&size=99660&status=done&style=none&taskId=uee06ee96-6a2d-4ec1-b61f-1584ebad6e6&width=678" alt="image.jpg"></p>
<h4 id="compilation-对象"><a href="#compilation-对象" class="headerlink" title="compilation 对象"></a>compilation 对象</h4><p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1630466659503-fb29acd3-e2ff-40ed-afda-8fcf4b77ac12.png#clientId=uca7be9d5-6f50-4&from=paste&id=ue921f064&margin=%5Bobject%20Object%5D&name=image.png&originHeight=2243&originWidth=760&originalType=url%E2%88%B6=1&size=163196&status=done&style=none&taskId=uebc60d66-9e3c-44c4-9b98-ca13f164eb3" alt="image.png"></p>
<h3 id="常用-plugin"><a href="#常用-plugin" class="headerlink" title="常用 plugin"></a>常用 plugin</h3><ul>
<li>define-plugin：定义环境变量 (Webpack4 之后指定 mode 会自动配置)</li>
<li>ignore-plugin：忽略部分文件</li>
<li>html-webpack-plugin：简化 HTML 文件创建 (依赖于 html-loader)</li>
<li>web-webpack-plugin：可方便地为单页应用输出 HTML，比 html-webpack-plugin 好用</li>
<li>uglifyjs-webpack-plugin：不支持 ES6 压缩 (Webpack4 以前)</li>
<li>terser-webpack-plugin: 支持压缩 ES6 (Webpack4)</li>
<li>webpack-parallel-uglify-plugin: 多进程执行代码压缩，提升构建速度</li>
<li>mini-css-extract-plugin: 分离样式文件，CSS 提取为独立文件，支持按需加载 (替代 extract-text-webpack-plugin)</li>
<li>serviceworker-webpack-plugin：为网页应用增加离线缓存功能</li>
<li>clean-webpack-plugin: 目录清理</li>
<li>ModuleConcatenationPlugin: 开启 Scope Hoisting</li>
<li>speed-measure-webpack-plugin: 可以看到每个 Loader 和 Plugin 执行耗时 (整个打包耗时、每个 Plugin 和 Loader 耗时)</li>
<li>webpack-bundle-analyzer: 可视化 Webpack 输出文件的体积 (业务组件、依赖第三方模块)</li>
</ul>
<p>​</p>
<h2 id="Loader"><a href="#Loader" class="headerlink" title="Loader"></a>Loader</h2><p>在构建阶段的 loader-runner 阶段生效。runLoaders 会调用用户配置的 loader 集合读取、转义资源，然后 webpack 才能进行后续模块依赖的处理。一个 Loader 本质就是一个<strong>函数</strong>，它的职责是<strong>单一</strong>的，只需要完成一种转换。 如果一个源文件需要经历多步转换才能正常使用，就通过多个 Loader 去转换。<br>Loader 函数接收三个参数，分别为：</p>
<ul>
<li>source：资源输入，对于第一个执行的 loader 为资源文件的内容；后续执行的 loader 则为前一个 loader 的执行结果</li>
<li>sourceMap: 可选参数，代码的 <a href="https://link.juejin.cn/?target=https://sourcemap.com/">sourcemap</a> 结构</li>
<li>data: 可选参数，其它需要在 Loader 链中传递的信息，比如 <a href="https://link.juejin.cn/?target=https://github.com/posthtml/posthtml-loader">posthtml/posthtml-loader</a> 就会通过这个参数传递参数的 AST 对象</li>
</ul>
<p>其中 source 是最重要的参数，大多数 Loader 要做的事情就是将 source 转译为另一种形式的 output<br>在调用多个 Loader 去转换一个文件时，每个 Loader 会<strong>链式</strong>的顺序执行， 第一个 Loader 将会拿到需处理的原内容，上一个 Loader 处理后的结果会传给下一个接着处理，最后的 Loader 将处理后的最终结果返回给 Webpack。<br>Webpack 会默认<strong>缓存</strong>所有 Loader 的处理结果直到资源或资源依赖发生变化，也就是说在需要被处理的文件或者其依赖的文件没有发生变化时， 是不会重新调用对应的 Loader 去执行转换操作的。</p>
<h3 id="pitch"><a href="#pitch" class="headerlink" title="pitch"></a>pitch</h3><p>Loader 链条执行过程分三个阶段：pitch、解析资源、执行<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1630575987411-da2b1ccb-b0a8-405d-8f18-f25effe72bae.png#clientId=uad1c3d9d-4039-4&from=paste&id=ud41b6a23&margin=%5Bobject%20Object%5D&name=image.png&originHeight=714&originWidth=1794&originalType=url%E2%88%B6=1&size=179279&status=done&style=none&taskId=u976e4c64-812c-481b-a1b6-776edaeaec2" alt="image.png"><br>pitch 阶段按配置顺序从左到右逐个执行 loader.pitch 函数(如果有的话)，开发者可以在 pitch 返回任意值中断后续的链路的执行<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1630576060183-e67b59a8-3c82-46b7-90f0-fcf6306c4622.png#clientId=uad1c3d9d-4039-4&from=paste&id=u6067eeb4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=714&originWidth=1794&originalType=url%E2%88%B6=1&size=208176&status=done&style=none&taskId=uff277e87-006c-417e-ada3-71996dc4740" alt="image.png"><br>​</p>
<h3 id="与-webpack-通信"><a href="#与-webpack-通信" class="headerlink" title="与 webpack 通信"></a>与 webpack 通信</h3><ol>
<li>直接 return</li>
<li>通过 this.callback， 这 是 Webpack 给 Loader 注入的 API，以方便 Loader 和 Webpack 之间通信</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">source</span>) &#123;</span><br><span class="line">  <span class="comment">// 通过 this.callback 告诉 Webpack 返回的结果</span></span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">callback</span>(<span class="literal">null</span>, source, sourceMaps);</span><br><span class="line">  <span class="comment">// 当你使用 this.callback 返回内容时，该 Loader 必须返回 undefined，</span></span><br><span class="line">  <span class="comment">// 以让 Webpack 知道该 Loader 返回的结果在 this.callback 中，而不是 return 中</span></span><br><span class="line">  <span class="keyword">return</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>异步</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = <span class="keyword">function</span> (<span class="params">source</span>) &#123;</span><br><span class="line">  <span class="comment">// 告诉 Webpack 本次转换是异步的，Loader 会在 callback 中回调结果</span></span><br><span class="line">  <span class="keyword">var</span> callback = <span class="variable language_">this</span>.<span class="title function_">async</span>();</span><br><span class="line">  <span class="title function_">someAsyncOperation</span>(source, <span class="keyword">function</span> (<span class="params">err, result, sourceMaps, ast</span>) &#123;</span><br><span class="line">    <span class="comment">// 通过 callback 返回异步执行后的结果</span></span><br><span class="line">    <span class="title function_">callback</span>(err, result, sourceMaps, ast);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="常用-loader"><a href="#常用-loader" class="headerlink" title="常用 loader"></a>常用 loader</h3><ul>
<li>raw-loader：加载文件原始内容（utf-8）</li>
<li>file-loader：把文件输出到一个文件夹中，在代码中通过相对 URL 去引用输出的文件 (处理图片和字体)</li>
<li>url-loader：与 file-loader 类似，区别是用户可以设置一个阈值，大于阈值会交给 file-loader 处理，小于阈值时返回文件 base64 形式编码 (处理图片和字体)</li>
<li>source-map-loader：加载额外的 Source Map 文件，以方便断点调试</li>
<li>svg-inline-loader：将压缩后的 SVG 内容注入代码中</li>
<li>image-loader：加载并且压缩图片文件</li>
<li>json-loader 加载 JSON 文件（默认包含）</li>
<li>handlebars-loader: 将 Handlebars 模版编译成函数并返回</li>
<li>babel-loader：把 ES6 转换成 ES5</li>
<li>ts-loader: 将 TypeScript 转换成 JavaScript</li>
<li>awesome-typescript-loader：将 TypeScript 转换成 JavaScript，性能优于 ts-loader</li>
<li>sass-loader：将 SCSS/SASS 代码转换成 CSS</li>
<li>css-loader：加载 CSS，支持模块化、压缩、文件导入等特性</li>
<li>style-loader：把 CSS 代码注入到 JavaScript 中，通过 DOM 操作去加载 CSS</li>
<li>postcss-loader：扩展 CSS 语法，使用下一代 CSS，可以配合 autoprefixer 插件自动补齐 CSS3 前缀</li>
<li>eslint-loader：通过 ESLint 检查 JavaScript 代码</li>
<li>tslint-loader：通过 TSLint 检查 TypeScript 代码</li>
<li>mocha-loader：加载 Mocha 测试用例的代码</li>
<li>coverjs-loader：计算测试的覆盖率</li>
<li>vue-loader：加载 Vue.js 单文件组件</li>
<li>i18n-loader: 国际化</li>
<li>cache-loader: 可以在一些性能开销较大的 Loader 之前添加，目的是将结果缓存到磁盘里</li>
</ul>
<h2 id="HMR（Hot-Module-Replacement）"><a href="#HMR（Hot-Module-Replacement）" class="headerlink" title="HMR（Hot Module Replacement）"></a>HMR（Hot Module Replacement）</h2><p>不用刷新浏览器而将新变更的模块替换掉旧的模块，还可以保留应用的状态，提高开发效率</p>
<h3 id="开启方法"><a href="#开启方法" class="headerlink" title="开启方法"></a>开启方法</h3><ul>
<li>启动 webpack 命令时，带上 –watch 参数</li>
<li>在配置 webpack.config.js 中设置 watch:true</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// 必须设置 devServer.hot = true，启动 HMR 功能</span></span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>HMR 的核心就是客户端从服务端拉去更新后的文件，准确的说是 chunk diff (chunk 需要更新的部分)，实际上 WDS 与浏览器之间维护了一个** Websocket<strong>，当本地资源发生变化时</strong>增量构建**发生变更的模块，WDS 会向浏览器推送更新，并带上构建时的 hash，让客户端与上一次资源进行对比。客户端对比出差异后会向 WDS 发起 Ajax 请求来获取更改内容(文件列表、hash)，这样客户端就可以再借助这些信息继续向 WDS 发起 jsonp 请求获取该 chunk 的增量更新。<br>​</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1630482233053-660dbc9c-635c-4b15-a226-3809d74b542e.png#clientId=uca7be9d5-6f50-4&from=paste&id=u6a13f753&margin=%5Bobject%20Object%5D&name=image.png&originHeight=749&originWidth=720&originalType=url%E2%88%B6=1&size=270235&status=done&style=none&taskId=u7ef2e4f6-4876-40df-b58f-9e4b30aa803" alt="image.png"></p>
<ol>
<li>在 webpack 的 watch 模式下，文件系统中某一个文件发生修改，webpack 监听到文件变化，根据配置文件<strong>对模块</strong>重新编译打包，并将打包后的代码通过简单的 JavaScript 对象保存在内存中。</li>
<li>webpack-dev-middleware 调用 webpack 暴露的 API 对代码变化进行监控，并且告诉 webpack，将代码打包到内存中</li>
<li>webpack-dev-server 对文件变化的一个监控，这一步不同于第一步，并不是监控代码变化重新打包。当我们在配置文件中配置了<a href="https://link.zhihu.com/?target=https://webpack.js.org/configuration/dev-server/%23devserver-watchcontentbase">devServer.watchContentBase</a> 为 true 的时候，Server 会监听这些配置文件夹中静态文件的变化，变化后会通知浏览器端对应用进行刷新。</li>
<li>通过 <a href="https://link.zhihu.com/?target=https://github.com/sockjs/sockjs-client">sockjs</a>（webpack-dev-server 的依赖）在浏览器端和服务端之间建立一个 websocket 长连接，将 webpack 编译打包的各个阶段的状态信息告知浏览器端，同时也包括第三步中 Server 监听静态文件变化的信息。浏览器端根据这些 socket 消息进行不同的操作。当然服务端传递的最主要信息还是新模块的 hash 值，后面的步骤根据这一 hash 值来进行模块热替换。</li>
<li>webpack/hot/dev-server 的工作就是根据 webpack-dev-server/client 传给它的信息以及 dev-server 的配置决定是刷新浏览器（11）还是进行模块热更新（6）</li>
<li>HotModuleReplacement.runtime 是客户端 HMR 的中枢，它接收到上一步传递给他的新模块的 hash 值，它通过 JsonpMainTemplate.runtime 向 server 端发送 Ajax 请求，服务端返回一个 json，该 json 包含了所有要更新的模块的 hash 值，获取到更新列表后，该模块再次通过 jsonp 请求，获取到最新的模块代码（7，8，9）。</li>
</ol>
<p>​</p>
<ol start="10">
<li>​HotModulePlugin 将会对新旧模块进行对比，决定是否更新模块，在决定更新模块后，检查模块之间的依赖关系，更新模块的同时更新模块间的依赖引用。</li>
<li>HMR 失败或者 5 判断刷新，进行浏览器刷新来获取最新打包代码</li>
</ol>
<h2 id="代码分割"><a href="#代码分割" class="headerlink" title="代码分割"></a>代码分割</h2><h3 id="默认规则"><a href="#默认规则" class="headerlink" title="默认规则"></a>默认规则</h3><p>默认的分包规则有：</p>
<ul>
<li>同一个 entry 下触达到的模块组织成一个 chunk（initial chunk）</li>
<li>异步模块单独组织为一个 chunk（async chunk）</li>
<li>entry.runtime 单独组织成一个 chunk（runtime chunk）</li>
</ul>
<p>默认规则集中在 compilation.seal 函数实现，seal 核心逻辑运行结束后会生成一系列的 Chunk、ChunkGroup、ChunkGraph 对象，后续如 SplitChunksPlugin 插件会在 Chunk 系列对象上做进一步的拆解、优化，最终反映到输出上才会表现出复杂的分包结果。</p>
<h3 id="Runtime-分包"><a href="#Runtime-分包" class="headerlink" title="Runtime 分包"></a>Runtime 分包</h3><p>除了 entry、异步模块外，webpack 5 之后还支持基于 runtime 的分包规则。除业务代码外，Webpack 编译产物中还需要包含一些用于支持 webpack 模块化、异步加载等特性的支撑性代码，这类代码在 webpack 中被统称为 runtime。虽然每段运行时代码可能都很小，但随着特性的增加，最终结果会越来越大，特别对于多 entry 应用， 可以通过配置使 webpack 运行时代码最终就会集中写入到同一个 chunk，多 entry 间可共享<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1630576738307-a4b62e1c-8125-4e1a-9fdf-618ac7f89bef.png#clientId=uad1c3d9d-4039-4&from=paste&height=351&id=uf5fbd1a8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=351&originWidth=653&originalType=binary%E2%88%B6=1&size=41513&status=done&style=none&taskId=u6900cdf9-6c8b-4d1f-87fd-b283fcd6c47&width=653" alt="image.png"></p>
<h3 id="CommonChunkPlugin"><a href="#CommonChunkPlugin" class="headerlink" title="CommonChunkPlugin"></a>CommonChunkPlugin</h3><p>抽出不同 chunk 重复引用的代码，组成父级 chunk<br><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1630637392658-d8640311-fa66-40e6-84c5-16c3090476b4.webp#clientId=uad1c3d9d-4039-4&from=paste&id=uca8be444&margin=%5Bobject%20Object%5D&originHeight=238&originWidth=802&originalType=url%E2%88%B6=1&status=done&style=none&taskId=ue9f52fac-826e-43ff-b61f-50d9ee9922f"><br><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1630637396944-d9c2ac89-c04f-4f17-8b2e-fb848bb4ff0f.webp#clientId=uad1c3d9d-4039-4&from=paste&id=u2bd26130&margin=%5Bobject%20Object%5D&originHeight=497&originWidth=886&originalType=url%E2%88%B6=1&status=done&style=none&taskId=u8cca1d4d-1602-480f-8fa4-d91557713b5"></p>
<h3 id="SplitChunksPlugin"><a href="#SplitChunksPlugin" class="headerlink" title="SplitChunksPlugin"></a>SplitChunksPlugin</h3><p>CommonsChunkPlugin 于 4.0 及以后被移除，使用 SplitChunksPlugin 替代。可以当配置项使用。在默认情况下，SplitChunksPlugin 仅仅影响按需加载的代码块，因为更改初始块会影响 HTML 文件应包含的脚本标记以运行项目。webpack 将根据以下条件自动拆分代码块：</p>
<ul>
<li>会被共享的代码块或者 node_mudules 文件夹中的代码块</li>
<li>体积大于 30KB 的代码块（在 gz 压缩前）</li>
<li>按需加载代码块时的并行请求数量不超过 5 个</li>
<li>加载初始页面时的并行请求数量不超过 3 个</li>
</ul>
<p>​</p>
<p>​</p>
<p>​</p>
<h2 id="依赖收集"><a href="#依赖收集" class="headerlink" title="依赖收集"></a>依赖收集</h2><h3 id="Dependency-Graph"><a href="#Dependency-Graph" class="headerlink" title="Dependency Graph"></a>Dependency Graph</h3><p>Webpack 4.x 的 Dependency Graph 实现较简单，主要由 Dependence/Module 内置的系列属性记录引用、被引用关系。<br>而 Webpack 5.0 之后则实现了一套相对复杂的类结构记录模块间依赖关系，将模块依赖相关的逻辑从 Dependence/Module 解耦为一套独立的类型结构，主要类型有：</p>
<ul>
<li>ModuleGraph ：记录 Dependency Graph 信息的<strong>容器</strong>，一方面保存了构建过程中涉及到的所有** module 、dependency <strong>对象，以及这些</strong>对象互相之间的引用**；另一方面提供了各种工具方法，方便使用者迅速读取出 module 或 dependency 附加的信息</li>
<li>ModuleGraphConnection ：记录<strong>模块间引用关系的数据结构</strong>，内部通过 originModule 属性记录引用关系中的父模块，通过 module 属性记录子模块。此外还提供了一系列函数工具用于判断对应的引用关系的有效性</li>
<li>ModuleGraphModule ：Module 对象在 Dependency Graph 体系下的补充信息，包含模块对象的 incomingConnections —— 指向模块本身的 ModuleGraphConnection 集合，即谁引用了模块自己；outgoingConnections —— 该模块对外的依赖，即该模块引用了其他那些模块。</li>
</ul>
<p>​</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1630575130712-25f83667-f43a-47e6-9aa4-dd496d59308e.png#clientId=uad1c3d9d-4039-4&from=paste&id=udcb9134f&margin=%5Bobject%20Object%5D&name=image.png&originHeight=876&originWidth=1654&originalType=url%E2%88%B6=1&size=235530&status=done&style=none&taskId=u3fc78e68-27b4-4aad-b71e-a3c17a30823" alt="image.png"></p>
<h3 id="依赖收集过程"><a href="#依赖收集过程" class="headerlink" title="依赖收集过程"></a>依赖收集过程</h3><p>依赖关系收集过程主要发生在两个节点：<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1630575380574-ce88e7e5-fe8f-4a22-b716-ed1b6e03b62b.png#clientId=uad1c3d9d-4039-4&from=paste&id=ud3a646e5&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1854&originWidth=2574&originalType=url%E2%88%B6=1&size=518148&status=done&style=none&taskId=u86c51e84-9bab-474a-946a-80f6bfd737c" alt="image.png"></p>
<ul>
<li>addDependency ：webpack 从模块内容中解析出引用关系后，创建适当的 Dependency 子类并调用该方法记录到 module 实例</li>
<li>handleModuleCreation ：模块解析完毕后，webpack 遍历父模块的依赖集合，调用该方法创建 Dependency 对应的子模块对象，之后调用 compilation.moduleGraph.setResolvedModule 方法将父子引用信息记录到 moduleGraph 对象上</li>
</ul>
<h4 id="运行时依赖收集"><a href="#运行时依赖收集" class="headerlink" title="运行时依赖收集"></a>运行时依赖收集</h4><ul>
<li>第一次循环遍历所有 module，收集所有 module 的 runtime 依赖</li>
<li>第二次循环遍历所有 chunk，将 chunk 下所有 module 的 runtime 统一收录到 chunk 中</li>
<li>第三次循环遍历所有 runtime chunk，收集其对应的子 chunk 下所有 runtime 依赖，之后遍历所有依赖并发布 runtimeRequirementInTree 钩子，(主要是) RuntimePlugin 插件订阅该钩子并根据依赖类型创建对应的 RuntimeModule 子类实例</li>
</ul>
<p>​</p>
<h3 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h3><h4 id="信息索引"><a href="#信息索引" class="headerlink" title="信息索引"></a>信息索引</h4><p>ModuleGraph 类型提供了很多实现 module / dependency 信息查询的工具函数</p>
<h4 id="构建-ChunkGraph"><a href="#构建-ChunkGraph" class="headerlink" title="构建 ChunkGraph"></a>构建 ChunkGraph</h4><p>Webpack 主体流程中，make 构建阶段结束之后会进入 seal 阶段，开始梳理以何种方式组织输出内容。每个 entry 对应组织为一个 chunk ，之后调用 webpack/lib/buildChunkGraph.js 文件定义的 buildChunkGraph 方法，<strong>遍历 make 阶段生成的 moduleGraph 对象</strong>从而将 module 依赖关系转化为 chunkGraph 对象。<br>​</p>
<h2 id="模块化"><a href="#模块化" class="headerlink" title="模块化"></a>模块化</h2><h3 id="按需加载"><a href="#按需加载" class="headerlink" title="按需加载"></a>按需加载</h3><p>插入异步 import，调用时再加载</p>
<h3 id="Tree-shaking"><a href="#Tree-shaking" class="headerlink" title="Tree shaking"></a>Tree shaking</h3><ol>
<li>Make 阶段，收集模块导出变量并记录到模块依赖关系图 ModuleGraph 变量中<ol>
<li>将模块的所有 ESM 导出语句转换为 Dependency 对象，并记录到 module 对象的 dependencies 集合</li>
<li>所有模块都编译完毕后，触发 compilation.hooks.finishModules 钩子，开始执行 FlagDependencyExportsPlugin 插件回调</li>
<li>FlagDependencyExportsPlugin 插件从 entry 开始读取 ModuleGraph 中存储的模块信息，遍历所有 module 对象</li>
<li>遍历 module 对象的 dependencies 数组，找到所有 HarmonyExportXXXDependency 类型的依赖对象，将其转换为 ExportInfo 对象并记录到 ModuleGraph 体系中</li>
</ol>
</li>
<li>Seal 阶段，遍历 ModuleGraph 标记模块导出变量有没有被使用<ol>
<li>触发 compilation.hooks.optimizeDependencies 钩子，开始执行 FlagDependencyUsagePlugin 插件逻辑</li>
<li>在 FlagDependencyUsagePlugin 插件中，从 entry 开始逐步遍历 ModuleGraph 存储的所有 module 对象</li>
<li>遍历 module 对象对应的 exportInfo 数组</li>
<li>为每一个 exportInfo 对象执行 compilation.getDependencyReferencedExports 方法，确定其对应的 dependency 对象有否被其它模块使用</li>
<li>被任意模块使用到的导出值，调用 exportInfo.setUsedConditionally 方法将其标记为已被使用。</li>
<li>exportInfo.setUsedConditionally 内部修改 exportInfo._usedInRuntime 属性，记录该导出被如何使用</li>
<li>结束</li>
</ol>
</li>
<li>生成产物时，若变量没有被其它模块使用则删除对应的导出语句<ol>
<li>打包阶段，调用 HarmonyExportXXXDependency.Template.apply 方法生成代码</li>
<li>在 apply 方法内，读取 ModuleGraph 中存储的 exportsInfo 信息，判断哪些导出值被使用，哪些未被使用</li>
<li>对已经被使用及未被使用的导出值，分别创建对应的 HarmonyExportInitFragment 对象，保存到 initFragments 数组</li>
<li>遍历 initFragments 数组，生成最终结果</li>
</ol>
</li>
</ol>
<h2 id="文件监听"><a href="#文件监听" class="headerlink" title="文件监听"></a>文件监听</h2><p>在发现源码发生变化时，自动重新构建出新的输出文件<br>轮询判断文件的最后编辑时间是否变化，如果某个文件发生了变化，并不会立刻告诉监听者，而是先缓存起来，等 aggregateTimeout 后再执行<br>​</p>
<h2 id="文件指纹"><a href="#文件指纹" class="headerlink" title="文件指纹"></a>文件指纹</h2><p>文件指纹是打包后输出的文件名的后缀。</p>
<ul>
<li>Hash：和整个项目的构建相关，只要项目文件有修改，整个项目构建的 hash 值就会更改</li>
<li>Chunkhash：和 Webpack 打包的 chunk 有关，不同的 entry 会生出不同的 chunkhash</li>
<li>Contenthash：根据文件内容来定义 hash，文件内容不变，则 contenthash 不变</li>
</ul>
<p>​</p>
<h3 id="JS-的文件指纹设置"><a href="#JS-的文件指纹设置" class="headerlink" title="JS 的文件指纹设置"></a>JS 的文件指纹设置</h3><p>设置 output 的 filename，用 chunkhash</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">app</span>: <span class="string">&quot;./scr/app.js&quot;</span>,</span><br><span class="line">    <span class="attr">search</span>: <span class="string">&quot;./src/search.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name][chunkhash:8].js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: __dirname + <span class="string">&quot;/dist&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="CSS-的文件指纹设置"><a href="#CSS-的文件指纹设置" class="headerlink" title="CSS 的文件指纹设置"></a>CSS 的文件指纹设置</h3><p>设置 MiniCssExtractPlugin 的 filename，使用 contenthash</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: &#123;</span><br><span class="line">    <span class="attr">app</span>: <span class="string">&quot;./scr/app.js&quot;</span>,</span><br><span class="line">    <span class="attr">search</span>: <span class="string">&quot;./src/search.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;[name][chunkhash:8].js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: __dirname + <span class="string">&quot;/dist&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MiniCssExtractPlugin</span>(&#123;</span><br><span class="line">      <span class="attr">filename</span>: <span class="string">`[name][contenthash:8].css`</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="图片的文件指纹设置"><a href="#图片的文件指纹设置" class="headerlink" title="图片的文件指纹设置"></a>图片的文件指纹设置</h3><p>设置 file-loader 的 name，使用 hash。<br>占位符名称及含义</p>
<ul>
<li>ext 资源后缀名</li>
<li>name 文件名称</li>
<li>path 文件的相对路径</li>
<li>folder 文件所在的文件夹</li>
<li>contenthash 文件的内容 hash，默认是 md5 生成</li>
<li>hash 文件内容的 hash，默认是 md5 生成</li>
<li>emoji 一个随机的指代文件内容的 emoj</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;bundle.js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: path.<span class="title function_">resolve</span>(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(png|svg|jpg|gif)$/</span>,</span><br><span class="line">        <span class="attr">use</span>: [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;file-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="attr">name</span>: <span class="string">&quot;img/[name][hash:8].[ext]&quot;</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id=""><a href="#" class="headerlink" title=""></a></h2><h2 id="source-map"><a href="#source-map" class="headerlink" title="source map"></a>source map</h2><p>source map 是将编译、打包、压缩后的代码映射回源代码的过程。打包压缩后的代码不具备良好的可读性，想要调试源码就需要 soucre map。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;version&quot;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: <span class="string">&quot;Yoda_output.txt&quot;</span>,</span><br><span class="line">    <span class="string">&quot;sources&quot;</span>: [<span class="string">&quot;Yoda_input.txt&quot;</span>],</span><br><span class="line">    <span class="comment">// 包含所有符号的数组</span></span><br><span class="line">    <span class="string">&quot;names&quot;</span>: [<span class="string">&quot;the&quot;</span>, <span class="string">&quot;force&quot;</span>, <span class="string">&quot;feel&quot;</span>],</span><br><span class="line">    <span class="comment">// 每一个分号 ; 表示一行，多个空行就是多个 ;，mapping 通过 , 分割。</span></span><br><span class="line">    <span class="comment">// mapping有五位：</span></span><br><span class="line">    <span class="comment">// 第一位是目标代码中的列数  第二位是源码所在的文件名  第三位是源码对应的行数  第四位是源码对应的列数  第五位是源码对应的 names，不一定有</span></span><br><span class="line">    <span class="comment">// 每一位是通过 VLQ 编码的，一个字符就能表示行列数</span></span><br><span class="line">    <span class="string">&quot;mappings&quot;</span>: <span class="string">&quot;AACKA,IACIC,MACTC;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="优化构建速度"><a href="#优化构建速度" class="headerlink" title="优化构建速度"></a>优化构建速度</h2><ul>
<li>使用高版本的 Webpack 和 Node.js</li>
<li>多进程/多实例构建：<ul>
<li>HappyPack(不维护了)、thread-loader</li>
</ul>
</li>
<li>压缩代码<ul>
<li>多进程并行压缩<ul>
<li>webpack-paralle-uglify-plugin</li>
<li>uglifyjs-webpack-plugin 开启 parallel 参数 (不支持 ES6)</li>
<li>terser-webpack-plugin 开启 parallel 参数</li>
</ul>
</li>
<li>通过 mini-css-extract-plugin 提取 Chunk 中的 CSS 代码到单独文件，通过 css-loader 的 minimize 选项开启 cssnano 压缩 CSS。</li>
</ul>
</li>
<li>图片压缩<ul>
<li>使用基于 Node 库的 imagemin (很多定制选项、可以处理多种图片格式)</li>
<li>配置 image-webpack-loader</li>
</ul>
</li>
<li>缩小打包作用域：<ul>
<li>exclude/include (确定 loader 规则范围)</li>
<li>resolve.modules 指明第三方模块的绝对路径 (减少不必要的查找)</li>
<li>resolve.mainFields 只采用 main 字段作为入口文件描述字段 (减少搜索步骤，需要考虑到所有运行时依赖的第三方模块的入口文件描述字段)</li>
<li>resolve.extensions 尽可能减少后缀尝试的可能性</li>
<li>noParse 对完全不需要解析的库进行忽略 (不去解析但仍会打包到 bundle 中，注意被忽略掉的文件里不应该包含 import、require、define 等模块化语句)</li>
<li>IgnorePlugin (完全排除模块)</li>
<li>合理使用 alias</li>
</ul>
</li>
<li>提取页面公共资源：<ul>
<li>基础包分离：<ul>
<li>使用 html-webpack-externals-plugin，将基础包通过 CDN 引入，不打入 bundle 中</li>
<li>使用 SplitChunksPlugin 进行(公共脚本、基础包、页面公共文件)分离(Webpack4 内置) ，替代了 CommonsChunkPlugin 插件</li>
</ul>
</li>
</ul>
</li>
<li>DLL：<ul>
<li>使用 DllPlugin 进行分包，使用 DllReferencePlugin(索引链接) 对 manifest.json 引用，让一些基本不会改动的代码先打包成静态资源，避免反复编译浪费时间。</li>
<li>HashedModuleIdsPlugin 可以解决模块数字 id 问题</li>
</ul>
</li>
<li>充分利用缓存提升二次构建速度：<ul>
<li>babel-loader 开启缓存</li>
<li>terser-webpack-plugin 开启缓存</li>
<li>使用 cache-loader 或者 hard-source-webpack-plugin</li>
</ul>
</li>
<li>Tree shaking<ul>
<li>打包过程中检测工程中没有引用过的模块并进行标记，在资源压缩时将它们从最终的 bundle 中去掉(只能对 ES6 Modlue 生效) 开发中尽可能使用 ES6 Module 的模块，提高 tree shaking 效率</li>
<li>禁用 babel-loader 的模块依赖解析，否则 Webpack 接收到的就都是转换过的 CommonJS 形式的模块，无法进行 tree-shaking</li>
<li>使用 PurifyCSS(不在维护) 或者 uncss 去除无用 CSS 代码<ul>
<li>purgecss-webpack-plugin 和 mini-css-extract-plugin 配合使用(建议)</li>
</ul>
</li>
</ul>
</li>
<li>Scope hoisting<ul>
<li>构建后的代码会存在大量闭包，造成体积增大，运行代码时创建的函数作用域变多，内存开销变大。Scope hoisting 将所有模块的代码按照引用顺序放在一个函数作用域里，然后适当的重命名一些变量以防止变量名冲突</li>
<li>必须是 ES6 的语法，因为有很多第三方库仍采用 CommonJS 语法，为了充分发挥 Scope hoisting 的作用，需要配置 mainFields 对第三方模块优先采用 jsnext:main 中指向的 ES6 模块化语法</li>
</ul>
</li>
<li>动态 Polyfill<ul>
<li>建议采用 polyfill-service 只给用户返回需要的 polyfill，社区维护。 (部分国内奇葩浏览器 UA 可能无法识别，但可以降级返回所需全部 polyfill)</li>
</ul>
</li>
</ul>
<p>​</p>
<h2 id="手写-webpack"><a href="#手写-webpack" class="headerlink" title="手写 webpack"></a>手写 webpack</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> babylon = <span class="built_in">require</span>(<span class="string">&quot;@babel/parser&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">&quot;@babel/traverse&quot;</span>).<span class="property">default</span>;</span><br><span class="line"><span class="keyword">const</span> babel = <span class="built_in">require</span>(<span class="string">&quot;@babel/core&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ENTRY</span> = <span class="string">&quot;./src/entry.js&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">OUTPUT</span> = <span class="string">&quot;./build/output.js&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="variable constant_">ID</span> = <span class="number">0</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 分析文件信息，通过babel将代码转译为AMD格式</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; filename 文件相对路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Asset</span>&#125; 文件信息</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@typedef</span> &#123;<span class="type">Object</span>&#125; <span class="variable">Asset</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">number</span>&#125; id 唯一标识符</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">number</span>&#125; filename 文件相对路径</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">string</span>&#125; code 转译后代码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">Array&lt;string&gt;</span>&#125; dependenncies 该文件依赖列表</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@property</span> &#123;<span class="type">object</span>&#125; mapping 子依赖的哈希表，结构为 &#123; $&#123;filename&#125; : $&#123;id&#125; &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createAsset</span>(<span class="params">filename</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> content = fs.<span class="title function_">readFileSync</span>(filename, <span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">  <span class="keyword">const</span> dependencies = [];</span><br><span class="line">  <span class="comment">// 文件标识符，可改hash</span></span><br><span class="line">  <span class="keyword">const</span> id = <span class="variable constant_">ID</span>++;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通过AST找到import语法对应语句，将依赖输入依赖列表</span></span><br><span class="line">  <span class="comment">// module =&gt; ast =&gt; dependences =&gt; module</span></span><br><span class="line">  <span class="keyword">const</span> ast = babylon.<span class="title function_">parse</span>(content, &#123;</span><br><span class="line">    <span class="attr">sourceType</span>: <span class="string">&quot;module&quot;</span>,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="title function_">traverse</span>(ast, &#123;</span><br><span class="line">    <span class="title class_">ImportDeclaration</span>: <span class="function">(<span class="params">&#123; node &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      dependencies.<span class="title function_">push</span>(node.<span class="property">source</span>.<span class="property">value</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ES6 转为 ES5， import改require</span></span><br><span class="line">  <span class="keyword">const</span> &#123; code &#125; = babel.<span class="title function_">transformFromAstSync</span>(ast, <span class="literal">null</span>, &#123;</span><br><span class="line">    <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    id,</span><br><span class="line">    filename,</span><br><span class="line">    dependencies,</span><br><span class="line">    code,</span><br><span class="line">    <span class="attr">mapping</span>: &#123;&#125;,</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从入口文件开始，遍历所有文件的依赖列表，生成文件信息集合（依赖关系图）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">string</span>&#125; <span class="variable">entry</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">Array&lt;Asset&gt;</span>&#125; 文件信息集合</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createGraph</span>(<span class="params">entry</span>) &#123;</span><br><span class="line">  <span class="comment">// 从入口文件开始遍历</span></span><br><span class="line">  <span class="keyword">const</span> queue = [<span class="title function_">createAsset</span>(entry)];</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> asset <span class="keyword">of</span> queue) &#123;</span><br><span class="line">    <span class="keyword">const</span> dirname = path.<span class="title function_">dirname</span>(asset.<span class="property">filename</span>);</span><br><span class="line">    asset.<span class="property">dependencies</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">relativePath</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> absolutePath = path.<span class="title function_">join</span>(dirname, relativePath);</span><br><span class="line">      <span class="comment">// 遍历子依赖</span></span><br><span class="line">      <span class="keyword">const</span> child = <span class="title function_">createAsset</span>(absolutePath);</span><br><span class="line">      <span class="comment">// 子依赖filename和id的哈希表</span></span><br><span class="line">      asset.<span class="property">mapping</span>[relativePath] = child.<span class="property">id</span>;</span><br><span class="line">      <span class="comment">// 不断将子依赖加入队列</span></span><br><span class="line">      queue.<span class="title function_">push</span>(child);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> queue;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 根据文件信息集合，生成modules，最终拼接成chunk</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">Graph</span>&#125; <span class="variable">graph</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@returns</span> &#123;<span class="type">string</span>&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">bundle</span>(<span class="params">graph</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> modules = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  graph.<span class="title function_">forEach</span>(<span class="function">(<span class="params">asset</span>) =&gt;</span> &#123;</span><br><span class="line">    modules += <span class="string">`<span class="subst">$&#123;asset.id&#125;</span>: [</span></span><br><span class="line"><span class="string">      function (require, module, exports) &#123;</span></span><br><span class="line"><span class="string">        <span class="subst">$&#123;asset.code&#125;</span></span></span><br><span class="line"><span class="string">      &#125;,</span></span><br><span class="line"><span class="string">      <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(asset.mapping)&#125;</span>,</span></span><br><span class="line"><span class="string">    ],`</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> chunk = <span class="string">`</span></span><br><span class="line"><span class="string">    (function(modules) &#123;</span></span><br><span class="line"><span class="string">      function require(id) &#123;</span></span><br><span class="line"><span class="string">        const [fn, mapping] = modules[id];</span></span><br><span class="line"><span class="string">        function localRequire(relativePath) &#123;</span></span><br><span class="line"><span class="string">          return require(mapping[relativePath]);</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        const module = &#123;exports: &#123;&#125;&#125;</span></span><br><span class="line"><span class="string">        fn(localRequire, module, module.exports);</span></span><br><span class="line"><span class="string">        return module.exports;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">      require(0);</span></span><br><span class="line"><span class="string">    &#125;)(&#123;<span class="subst">$&#123;modules&#125;</span>&#125;)</span></span><br><span class="line"><span class="string">  `</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> chunk;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据chunk生成bundle文件</span></span><br><span class="line">fs.<span class="title function_">writeFileSync</span>(<span class="variable constant_">OUTPUT</span>, <span class="title function_">bundle</span>(<span class="title function_">createGraph</span>(<span class="variable constant_">ENTRY</span>)));</span><br></pre></td></tr></table></figure>

<p>生成文件结构</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">function</span> (<span class="params">modules</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">require</span>(<span class="params">id</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> [fn, mapping] = modules[id];</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">localRequire</span>(<span class="params">relativePath</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">require</span>(mapping[relativePath]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> <span class="variable language_">module</span> = &#123; <span class="attr">exports</span>: &#123;&#125; &#125;;</span><br><span class="line">    <span class="title function_">fn</span>(localRequire, <span class="variable language_">module</span>, <span class="variable language_">module</span>.<span class="property">exports</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">module</span>.<span class="property">exports</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">require</span>(entry_id);</span><br><span class="line">&#125;)(&#123;</span><br><span class="line">  <span class="attr">id</span>: [</span><br><span class="line">    <span class="keyword">function</span> (<span class="params"><span class="built_in">require</span>, <span class="variable language_">module</span>, <span class="built_in">exports</span></span>) &#123;</span><br><span class="line">      <span class="string">&quot;use strict&quot;</span>;</span><br><span class="line">      <span class="comment">// code</span></span><br><span class="line">      <span class="built_in">require</span>(filename);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// mapping</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">filename</span>: id,</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// inside require</span></span><br><span class="line"><span class="keyword">const</span> modules = &#123;</span><br><span class="line">  <span class="attr">id</span>: [</span><br><span class="line">    <span class="keyword">function</span>(<span class="params"><span class="built_in">require</span>, <span class="variable language_">module</span>, <span class="built_in">exports</span></span>) &#123;</span><br><span class="line">      <span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">      <span class="comment">// code</span></span><br><span class="line">      <span class="built_in">require</span>(filename)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// mapping</span></span><br><span class="line">    &#123;</span><br><span class="line">      filename : id</span><br><span class="line">    &#125;,</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> [fn, mapping] = modules[id];</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable language_">module</span> = &#123; <span class="attr">exports</span>: &#123;&#125; &#125;;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fn</span>(</span><br><span class="line">  localRequire = <span class="function">(<span class="params">relativePath</span>) =&gt;</span> <span class="built_in">require</span>(mapping[relativePath]),</span><br><span class="line">  <span class="variable language_">module</span>,</span><br><span class="line">  <span class="variable language_">module</span>.<span class="property">exports</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// inside fn</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fn</span>(<span class="params">localRequire, <span class="variable language_">module</span>, <span class="built_in">exports</span></span>) &#123;</span><br><span class="line">  <span class="comment">// 根据filename和id的对应关系，在modules中找到对应子模块，因为子模块的代码写在了fn函数中，调用子模块fn函数相当于执行子模块</span></span><br><span class="line">  <span class="comment">// 然后根据子模块的mapping哈希表，深度遍历modules，找齐依赖列表</span></span><br><span class="line">  <span class="title function_">localRequire</span>(filename)  <span class="comment">// 相当于 require(mapping[relativePath])</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/30669007">https://zhuanlan.zhihu.com/p/30669007</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/363928061">https://zhuanlan.zhihu.com/p/363928061</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903614469636103">https://juejin.cn/post/6844903614469636103</a><br><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/61047">https://developer.aliyun.com/article/61047</a><br><a target="_blank" rel="noopener" href="https://www.webpackjs.com/guides">https://www.webpackjs.com/guides</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/dFrRY_ntUwmIOXzs8TYcFQ">https://mp.weixin.qq.com/s/dFrRY_ntUwmIOXzs8TYcFQ</a><br><a target="_blank" rel="noopener" href="https://developer.51cto.com/art/202109/681949.htm">https://developer.51cto.com/art/202109/681949.htm</a><br><a target="_blank" rel="noopener" href="https://github.com/dykily/simple_webpack/blob/master/bundler.js">https://github.com/dykily/simple_webpack/blob/master/bundler.js</a><br><a target="_blank" rel="noopener" href="https://github.com/ronami/minipack/blob/master/src/minipack.js">https://github.com/ronami/minipack/blob/master/src/minipack.js</a></p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/08/30/%E6%B5%8F%E8%A7%88%E5%99%A8/" rel="prev" title="浏览器">
      <i class="fa fa-chevron-left"></i> 浏览器
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/09/07/%E7%99%BB%E5%BD%95%E9%89%B4%E6%9D%83/" rel="next" title="登录鉴权">
      登录鉴权 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%9F%E8%83%BD"><span class="nav-number">1.</span> <span class="nav-text">功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E6%B5%81%E7%A8%8B"><span class="nav-number">2.</span> <span class="nav-text">核心流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%98%B6%E6%AE%B5"><span class="nav-number">3.</span> <span class="nav-text">初始化阶段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E9%98%B6%E6%AE%B5"><span class="nav-number">4.</span> <span class="nav-text">构建阶段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E9%98%B6%E6%AE%B5"><span class="nav-number">5.</span> <span class="nav-text">生成阶段</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Plugin"><span class="nav-number">6.</span> <span class="nav-text">Plugin</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Tapable"><span class="nav-number">6.1.</span> <span class="nav-text">Tapable</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E7%BC%96%E8%AF%91"><span class="nav-number">6.1.1.</span> <span class="nav-text">动态编译</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%92%A9%E5%AD%90%E8%A7%A6%E5%8F%91"><span class="nav-number">6.2.</span> <span class="nav-text">钩子触发</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E6%B5%81%E7%A8%8B"><span class="nav-number">6.2.1.</span> <span class="nav-text">总流程</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#compiler-%E5%AF%B9%E8%B1%A1"><span class="nav-number">6.2.2.</span> <span class="nav-text">compiler 对象</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#compilation-%E5%AF%B9%E8%B1%A1"><span class="nav-number">6.2.3.</span> <span class="nav-text">compilation 对象</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8-plugin"><span class="nav-number">6.3.</span> <span class="nav-text">常用 plugin</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Loader"><span class="nav-number">7.</span> <span class="nav-text">Loader</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pitch"><span class="nav-number">7.1.</span> <span class="nav-text">pitch</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8E-webpack-%E9%80%9A%E4%BF%A1"><span class="nav-number">7.2.</span> <span class="nav-text">与 webpack 通信</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E7%94%A8-loader"><span class="nav-number">7.3.</span> <span class="nav-text">常用 loader</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#HMR%EF%BC%88Hot-Module-Replacement%EF%BC%89"><span class="nav-number">8.</span> <span class="nav-text">HMR（Hot Module Replacement）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E6%96%B9%E6%B3%95"><span class="nav-number">8.1.</span> <span class="nav-text">开启方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E7%90%86"><span class="nav-number">8.2.</span> <span class="nav-text">原理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%88%86%E5%89%B2"><span class="nav-number">9.</span> <span class="nav-text">代码分割</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E8%A7%84%E5%88%99"><span class="nav-number">9.1.</span> <span class="nav-text">默认规则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Runtime-%E5%88%86%E5%8C%85"><span class="nav-number">9.2.</span> <span class="nav-text">Runtime 分包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CommonChunkPlugin"><span class="nav-number">9.3.</span> <span class="nav-text">CommonChunkPlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SplitChunksPlugin"><span class="nav-number">9.4.</span> <span class="nav-text">SplitChunksPlugin</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86"><span class="nav-number">10.</span> <span class="nav-text">依赖收集</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dependency-Graph"><span class="nav-number">10.1.</span> <span class="nav-text">Dependency Graph</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86%E8%BF%87%E7%A8%8B"><span class="nav-number">10.2.</span> <span class="nav-text">依赖收集过程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E4%BE%9D%E8%B5%96%E6%94%B6%E9%9B%86"><span class="nav-number">10.2.1.</span> <span class="nav-text">运行时依赖收集</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%9C%E7%94%A8"><span class="nav-number">10.3.</span> <span class="nav-text">作用</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%A1%E6%81%AF%E7%B4%A2%E5%BC%95"><span class="nav-number">10.3.1.</span> <span class="nav-text">信息索引</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA-ChunkGraph"><span class="nav-number">10.3.2.</span> <span class="nav-text">构建 ChunkGraph</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="nav-number">11.</span> <span class="nav-text">模块化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD"><span class="nav-number">11.1.</span> <span class="nav-text">按需加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Tree-shaking"><span class="nav-number">11.2.</span> <span class="nav-text">Tree shaking</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E7%9B%91%E5%90%AC"><span class="nav-number">12.</span> <span class="nav-text">文件监听</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E6%8C%87%E7%BA%B9"><span class="nav-number">13.</span> <span class="nav-text">文件指纹</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JS-%E7%9A%84%E6%96%87%E4%BB%B6%E6%8C%87%E7%BA%B9%E8%AE%BE%E7%BD%AE"><span class="nav-number">13.1.</span> <span class="nav-text">JS 的文件指纹设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSS-%E7%9A%84%E6%96%87%E4%BB%B6%E6%8C%87%E7%BA%B9%E8%AE%BE%E7%BD%AE"><span class="nav-number">13.2.</span> <span class="nav-text">CSS 的文件指纹设置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E7%89%87%E7%9A%84%E6%96%87%E4%BB%B6%E6%8C%87%E7%BA%B9%E8%AE%BE%E7%BD%AE"><span class="nav-number">13.3.</span> <span class="nav-text">图片的文件指纹设置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link"><span class="nav-number">14.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#source-map"><span class="nav-number">15.</span> <span class="nav-text">source map</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BC%98%E5%8C%96%E6%9E%84%E5%BB%BA%E9%80%9F%E5%BA%A6"><span class="nav-number">16.</span> <span class="nav-text">优化构建速度</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%8B%E5%86%99-webpack"><span class="nav-number">17.</span> <span class="nav-text">手写 webpack</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="nav-number">18.</span> <span class="nav-text">参考资料</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CatcherInSky"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">CatcherInSky</p>
  <div class="site-description" itemprop="description">CatcherInSky的前端知识库</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CatcherInSky" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CatcherInSky" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhangchunxiang98@outlook.com" title="E-Mail → mailto:zhangchunxiang98@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CatcherInSky</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
