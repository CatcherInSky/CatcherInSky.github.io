<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"catcherinsky.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="CatcherInSky的前端知识库">
<meta property="og:type" content="website">
<meta property="og:title" content="Knowlegde Bases of CatcherInSky">
<meta property="og:url" content="http://catcherinsky.github.io/page/3/index.html">
<meta property="og:site_name" content="Knowlegde Bases of CatcherInSky">
<meta property="og:description" content="CatcherInSky的前端知识库">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="CatcherInSky">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://catcherinsky.github.io/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Knowlegde Bases of CatcherInSky</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
  <meta name="referrer" content="same-origin">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Knowlegde Bases of CatcherInSky</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">CatcherInSky的前端知识库</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/12/21/JavaScript%20BOM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/21/JavaScript%20BOM/" class="post-title-link" itemprop="url">JavaScript BOM</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-21 17:17:49" itemprop="dateCreated datePublished" datetime="2021-12-21T17:17:49+08:00">2021-12-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:02" itemprop="dateModified" datetime="2022-02-14T19:41:02+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>window 是浏览器内置中的全局对象，我们所学习的所有 Web APIs 的知识内容都是基于 window 对象实现的<br><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1639121848270-45cb5d0c-cbd3-49f6-9657-5ba99a221cc7.webp#clientId=u2ad08625-7070-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u9c366f40&margin=%5Bobject%20Object%5D&originHeight=318&originWidth=1188&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=uba76d70a-ede9-497f-92fe-c9ecfa40ea5&title="></p>
<h2 id="screen"><a href="#screen" class="headerlink" title="screen"></a>screen</h2><p>​</p>
<h2 id="document"><a href="#document" class="headerlink" title="document"></a>document</h2><p>​</p>
<h2 id="location"><a href="#location" class="headerlink" title="location"></a>location</h2><p>​</p>
<h2 id="history"><a href="#history" class="headerlink" title="history"></a>history</h2><p>​</p>
<h2 id="navigator"><a href="#navigator" class="headerlink" title="navigator"></a>navigator</h2><h2 id="尺寸"><a href="#尺寸" class="headerlink" title="尺寸"></a>尺寸</h2><h3 id="screen-1"><a href="#screen-1" class="headerlink" title="screen"></a>screen</h3><h4 id="width-height"><a href="#width-height" class="headerlink" title="width/height"></a>width/height</h4><p>用户的屏幕的完整大小，不会因为缩放而改变<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1634636437580-6d4aa2bb-da92-4000-8a2c-3ac13da7be6f.png#clientId=uba9ebd18-1e21-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u345c7c3e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=313&originWidth=603&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=215019&status=done&style=none&taskId=u047cc083-5832-4f06-b840-8b21af0f9fa&title=" alt="image.png"></p>
<h3 id="window"><a href="#window" class="headerlink" title="window"></a>window</h3><h4 id="innerWidth-Height"><a href="#innerWidth-Height" class="headerlink" title="innerWidth/Height"></a>innerWidth/Height</h4><p>包含滚动条尺寸的浏览器完整尺寸，它定义了当前用户有多大区域，可供你的 CSS 布局占用。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1634636442376-8af98547-1c6a-4836-9009-f5e3bdaf68d5.png#clientId=uba9ebd18-1e21-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u9d8d4d72&margin=%5Bobject%20Object%5D&name=image.png&originHeight=312&originWidth=602&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=213469&status=done&style=none&taskId=udac5fb8a-ac4e-416b-a729-208a88e04cd&title=" alt="image.png"></p>
<h4 id="pageXOffset-pageYOffset"><a href="#pageXOffset-pageYOffset" class="headerlink" title="pageXOffset/pageYOffset"></a>pageXOffset/pageYOffset</h4><p>定义了页面(document)的相对于窗口原点的水平、垂直位移。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">pageXOffset</span> === <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">scrollLeft</span>;</span><br><span class="line"><span class="variable language_">window</span>.<span class="property">pageYOffset</span> === <span class="variable language_">document</span>.<span class="property">body</span>.<span class="property">scrollTop</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1634636681711-9a255e6b-7fa9-4e06-b88b-f7a7ce8f29f8.png#clientId=uba9ebd18-1e21-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ued24cfbf&margin=%5Bobject%20Object%5D&name=image.png&originHeight=429&originWidth=607&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=282148&status=done&style=none&taskId=u12c2db48-1797-4429-b42c-4529cbcd05b&title=" alt="image.png"><br>​</p>
<h4 id="scrollX-Y"><a href="#scrollX-Y" class="headerlink" title="scrollX/Y"></a>scrollX/Y</h4><p>文档水平/竖直方向滚动的像素值，等价于 pageXOffset/pageYOffset<br>​</p>
<h4 id="getComputedStyle"><a href="#getComputedStyle" class="headerlink" title="getComputedStyle()"></a>getComputedStyle()</h4><p>返回一个对象，该对象在应用活动样式表并解析这些值可能包含的任何基本计算后报告元素的所有 CSS 属性的值。 私有的 CSS 属性值可以通过对象提供的 API 或通过简单地使用 CSS 属性名称进行索引来访问。<br>​</p>
<h3 id="Element"><a href="#Element" class="headerlink" title="Element"></a>Element</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1635852073231-dba1ef6b-0667-409e-b8e2-71893a744ae8.png#clientId=ud91eb7d9-d015-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ua9b8baf7&margin=%5Bobject%20Object%5D&originHeight=577&originWidth=756&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=ub809c965-a3dc-4e5d-b40a-0642dc9cd9a&title="></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">document.documentElement实际上就是</span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">  元素：HTML文档的根元素著作权归作者所有</span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="clientWidth-Height"><a href="#clientWidth-Height" class="headerlink" title="clientWidth/Height"></a>clientWidth/Height</h4><p>对于没有定义 CSS 或者内联布局盒子的元素为 0，否则，它是元素内部的宽/高度，包含内边距，但不包括滚动条、边框和外边距。</p>
<p>​</p>
<h4 id="clientLeft-Top"><a href="#clientLeft-Top" class="headerlink" title="clientLeft/Top"></a>clientLeft/Top</h4><p>表示一个元素的左边框（border）+滚动条（文本方向从右到左）的宽度，不包括左外边距和左内边距<br>一个元素顶部边框的宽度。不包括顶部外边距或内边距<br>​</p>
<h4 id="offsetWidth-Height"><a href="#offsetWidth-Height" class="headerlink" title="offsetWidth/Height"></a>offsetWidth/Height</h4><p>元素的像素宽/高度，高度包含该元素的边框、内边距和元素的水平滚动条（如果存在且渲染的话），不包含:before 或:after 等伪类元素的高度。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element.<span class="property">offsetWidth</span> === element.<span class="property">clientWidth</span> + border * <span class="number">2</span>;</span><br><span class="line">element.<span class="property">offsetHeight</span> === element.<span class="property">clientHeight</span> + border * <span class="number">2</span>;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1635845922684-5001b8f2-3b12-4d5a-9a52-782cf77a445c.png#clientId=ud91eb7d9-d015-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u381cae73&margin=%5Bobject%20Object%5D&originHeight=247&originWidth=411&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u8f0d9d85-ca16-4df9-ae31-01b3daed57f&title="></p>
<h4 id="offsetLeft-Top"><a href="#offsetLeft-Top" class="headerlink" title="offsetLeft/Top"></a>offsetLeft/Top</h4><p>元素左上角相对于 <strong>HTMLElement.offsetParent</strong> (position 为非 static 且距离自己最近的祖先元素)节点的左/上边界偏移的像素值，不随滚动条滚动变化。<br><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1635910851820-5dd7a611-7318-4154-9f53-d8256d4e6857.webp#clientId=ud91eb7d9-d015-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=uf1250d68&margin=%5Bobject%20Object%5D&originHeight=984&originWidth=1672&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u4c0a3892-b100-4355-9582-6d2b6d8db8b&title="><br>​</p>
<h4 id="scrollWidth-Height"><a href="#scrollWidth-Height" class="headerlink" title="scrollWidth/Height"></a>scrollWidth/Height</h4><p>元素内容宽/高度的度量，包括由于溢出导致的视图中不可见内容。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">element.<span class="property">scrollHeight</span> === element.<span class="property">clientHeight</span> + element.<span class="property">scrollTop</span>;</span><br><span class="line">element.<span class="property">scrollWidth</span> === element.<span class="property">clientWidth</span> + element.<span class="property">scrollLeft</span>;</span><br></pre></td></tr></table></figure>

<h4 id="scrollLeft-Top"><a href="#scrollLeft-Top" class="headerlink" title="scrollLeft/Top"></a>scrollLeft/Top</h4><p>元素的内容滚动的距离，是这个元素的内容顶部（卷起来的）到它的<strong>视口</strong>可见内容（的顶部）的距离的度量。<br>​</p>
<h4 id="getBoundingClientRect"><a href="#getBoundingClientRect" class="headerlink" title="getBoundingClientRect()"></a>getBoundingClientRect()</h4><p>返回元素的大小及其相对于<strong>视口</strong>的位置，与其他属性不同，这些值可以是浮点数<br><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1639985568191-c8d9fe57-ca0e-4c9c-ac0f-81dbcf7c6856.webp#clientId=u2b0d4a1d-4a40-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ub34573c7&margin=%5Bobject%20Object%5D&originHeight=434&originWidth=762&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=uf2777551-21bf-4ff3-b267-a38a7f4ed9c&title="></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; x, y, width, height, top, left, right, bottom &#125; =</span><br><span class="line">  element.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">x === left + element.<span class="property">scrollLeft</span>;</span><br><span class="line">y === top + element.<span class="property">scrollTop</span>;</span><br><span class="line">width === element.<span class="property">offsetWidth</span>;</span><br><span class="line">height === element.<span class="property">offsetHeight</span>;</span><br><span class="line">top === element.<span class="property">clientTop</span>;</span><br><span class="line">left === element.<span class="property">clientLeft</span>;</span><br><span class="line">right === left + width;</span><br><span class="line">bottom === top + height;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判断元素是否在可视区域</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkInView</span>(<span class="params">dom</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; top, left, bottom, right &#125; = dom.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(top, left, bottom, right);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">window</span>.<span class="property">innerHeight</span>, <span class="variable language_">window</span>.<span class="property">innerWidth</span>);</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    top &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">    left &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">    bottom &lt;= (<span class="variable language_">window</span>.<span class="property">innerHeight</span> || <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientHeight</span>) &amp;&amp;</span><br><span class="line">    right &lt;= (<span class="variable language_">window</span>.<span class="property">innerWidth</span> || <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">clientWidth</span>)</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Event"><a href="#Event" class="headerlink" title="Event"></a>Event</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1635910695386-ca7006bd-1c50-4cf8-9adc-7442d2a002be.webp#clientId=ud91eb7d9-d015-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u2b7b4500&margin=%5Bobject%20Object%5D&originHeight=2100&originWidth=3360&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=uff931cf8-203b-4d3b-95a6-df0bce4130d&title="></p>
<h4 id="pageX-Y"><a href="#pageX-Y" class="headerlink" title="pageX/Y"></a>pageX/Y</h4><p>以 doument 对象左上角为原点的偏移量</p>
<h4 id="clientX-Y"><a href="#clientX-Y" class="headerlink" title="clientX/Y"></a>clientX/Y</h4><p>以浏览器可视窗口左上角为原点的偏移量</p>
<h4 id="screenX-Y"><a href="#screenX-Y" class="headerlink" title="screenX/Y"></a>screenX/Y</h4><p>以计算机屏幕左上顶角为原点的偏移量</p>
<h4 id="offsetX-Y"><a href="#offsetX-Y" class="headerlink" title="offsetX/Y"></a>offsetX/Y</h4><p>事件对象与目标节点的内填充边（padding edge）在 X/Y 轴方向上的偏移量，是相对于父元素的左边/上方的偏移量。</p>
<h4 id="layerX-Y"><a href="#layerX-Y" class="headerlink" title="layerX/Y"></a>layerX/Y</h4><p>最近的绝对定位的父元素（如果没有，则为 document 对象）左上顶角的偏移量<br>​</p>
<p>​</p>
<p>​</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/webp/106384/1643277010078-c5544b46-2f54-4cb8-b4d8-2af36a78cc52.webp#clientId=ufe664e9f-f360-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u2725d18d&margin=%5Bobject%20Object%5D&originHeight=876&originWidth=1440&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=ub3e54b98-f51d-437c-bfd5-3823cd79224&title=">可利用 performance.timing 看各个步骤的耗时： 白屏时间：performance.timing.responseStart - performance.timing.navigationStart</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/12/15/vue-config%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/15/vue-config%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">vue-config优化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-15 16:56:08" itemprop="dateCreated datePublished" datetime="2021-12-15T16:56:08+08:00">2021-12-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:03" itemprop="dateModified" datetime="2022-02-14T19:41:03+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Vue3.0 不在有 webpack.config.js 的配置，需要在根目录创建 vue.config.js 去完成 webpack 的一些特殊配置,默认它会被 @vue/cli-service 自动加载</p>
<h2 id="默认优化"><a href="#默认优化" class="headerlink" title="默认优化"></a>默认优化</h2><table>
<thead>
<tr>
<th>插件名</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>VueLoaderPlugin</td>
<td>vue 的加载器，官方文档</td>
</tr>
<tr>
<td>DefinePlugin</td>
<td>在编译时可以配置全局常量，配置 process.env 的</td>
</tr>
<tr>
<td>CaseSensitivePathsPlugin</td>
<td>匹配精准路径防止导包错误的</td>
</tr>
<tr>
<td>FriendlyErrorsWebpackPlugin</td>
<td>友好的错误提示</td>
</tr>
<tr>
<td>**MiniCssExtractPlugin **</td>
<td>抽取 css ，可以自动配合 splitChunks 自定义分块</td>
</tr>
<tr>
<td>OptimizeCssnanoPlugin</td>
<td>将打包好的 css 进行压缩</td>
</tr>
<tr>
<td>HashedModuleIdsPlugin</td>
<td>根据模块的相对路径生成 hash ，避免顺序改变打包后 hash 改变</td>
</tr>
<tr>
<td>NamedChunksPlugin</td>
<td>和 HashedModuleIdsPlugin 效果类似</td>
</tr>
<tr>
<td>HtmlWebpackPlugin</td>
<td>简化 HTML 文件的创建，生成主页 index.html 的</td>
</tr>
<tr>
<td>PreloadPlugin</td>
<td>预加载资源，提高用户切换路由体验</td>
</tr>
<tr>
<td>PreloadPlugin</td>
<td>空闲加载资源，有时会影响阅读，不推荐使用</td>
</tr>
<tr>
<td>CopyPlugin</td>
<td>将打包生成的文件拷贝到对应位置的</td>
</tr>
</tbody></table>
<p>路由的懒加载<br>​</p>
<p>() =&gt;import(‘url’) 优点：每个组件的代码都被打包成对应的 js 文件，加载组件时会对应加载 js 文件<br>​</p>
<h2 id="主要改进"><a href="#主要改进" class="headerlink" title="主要改进"></a>主要改进</h2><h3 id="大小优化"><a href="#大小优化" class="headerlink" title="大小优化"></a>大小优化</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1639658812048-eed6e282-6652-491e-afe3-68ade9bb600b.png#clientId=u65a5b0d3-ccaa-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u1c457f5d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=4784&originWidth=6912&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=4390291&status=done&style=none&taskId=u07a8e18a-aad3-418d-a9c1-00222f7b5d6&title=" alt="image.png"></p>
<h4 id="gzip-compression-webpack-plugin"><a href="#gzip-compression-webpack-plugin" class="headerlink" title="gzip || compression-webpack-plugin"></a>gzip || compression-webpack-plugin</h4><p>打包的时候开启 gzip 可以很大程度减少包的大小，非常适合于上线部署。更小的体积对于用户体验来说<br>就意味着更快的加载速度以及更好的用户体验。<br><strong>服务端 Nginx 需开启 gzip_static 功能</strong><br><strong>​</strong></p>
<h4 id="去注释-压缩-TerserWebpackPlugin-ParallelUglifyPlugin"><a href="#去注释-压缩-TerserWebpackPlugin-ParallelUglifyPlugin" class="headerlink" title="去注释+压缩 || TerserWebpackPlugin ParallelUglifyPlugin"></a>去注释+压缩 || TerserWebpackPlugin <del>ParallelUglifyPlugin</del></h4><p>压缩去注释</p>
<h4 id="purgecss-webpack-plugin"><a href="#purgecss-webpack-plugin" class="headerlink" title="~~purgecss-webpack-plugin ~~"></a>~~purgecss-webpack-plugin ~~</h4><p>删除多余 CSS，使用上要注意的比较多<br>​</p>
<h4 id="分包-splitChunk"><a href="#分包-splitChunk" class="headerlink" title="分包 || splitChunk"></a>分包 || splitChunk</h4><h4 id="摇树-sideEffects"><a href="#摇树-sideEffects" class="headerlink" title="摇树 || sideEffects"></a>摇树 || sideEffects</h4><p>package.json 里配置<br>​</p>
<h3 id="时间优化"><a href="#时间优化" class="headerlink" title="时间优化"></a>时间优化</h3><h4 id="多线程-thread-loader"><a href="#多线程-thread-loader" class="headerlink" title="多线程 || thread-loader"></a>多线程 || thread-loader</h4><p>thread-loader 是官方维护的<strong>多进程</strong>loader，功能类似于 happypack，也是通过开启子任务来并行解析文件，从而提高构建速度。<br>把这个 loader 放在其他 loader 前面。不过该 loader 是有限制的。示例：</p>
<ol>
<li>loader 无法发出文件。</li>
<li>loader 不能使用自定义加载器 API。</li>
<li>loader 无法访问网页包选项。</li>
</ol>
<p>​</p>
<p>每个 worker 都是一个单独的 node.js 进程，其开销约为 600 毫秒。还有进程间通信的开销。在<strong>小型项目中使用 thread-loader 可能并不能优化项目的构建速度</strong>，反而会拖慢构建速度，所以使用该 loader 时需要明确项目构建构成中真正耗时的过程。<br>​</p>
<h4 id="缓存-hard-source-webpack-plugin-amp-amp-cache-loader"><a href="#缓存-hard-source-webpack-plugin-amp-amp-cache-loader" class="headerlink" title="缓存 || hard-source-webpack-plugin &amp;&amp; cache-loader"></a>缓存 || hard-source-webpack-plugin &amp;&amp; cache-loader</h4><p>HardSourceWebpackPlugin 是一个 webpack 插件，为模块提供中间<strong>缓存</strong>步骤。为了查看结果，您需要使用此插件运行 webpack 两次：第一次构建将花费正常的时间。第二次建设将大大加快。<br>​</p>
<h2 id="过程记录"><a href="#过程记录" class="headerlink" title="过程记录"></a>过程记录</h2><p>最终优化<br>大小 12.2MB -&gt; 2.82MB<br>时间 59.34s -&gt; 27.18s</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="comment">// 不生成sourcemap</span></span><br><span class="line">  <span class="comment">// 12.2MB -&gt; 2.87MB 59.34s -&gt; 46.33s</span></span><br><span class="line">  <span class="attr">productionSourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="comment">// parallel: require(&quot;os&quot;).cpus().length &gt; 1,</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">chainWebpack</span>: <span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 开启计时和可视化</span></span><br><span class="line">    <span class="keyword">const</span> <span class="title class_">SpeedMeasurePlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;speed-measure-webpack-plugin&quot;</span>);</span><br><span class="line">    config.<span class="title function_">plugin</span>(<span class="string">&quot;SpeedMeasurePlugin&quot;</span>).<span class="title function_">use</span>(<span class="title class_">SpeedMeasurePlugin</span>);</span><br><span class="line">    <span class="comment">// const BundleAnalyzerPlugin = require(&#x27;webpack-bundle-analyzer&#x27;).BundleAnalyzerPlugin;</span></span><br><span class="line">    <span class="comment">// config.plugin(&#x27;BundleAnalyzerPlugin&#x27;).use(BundleAnalyzerPlugin);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (process.<span class="property">env</span>.<span class="property">NODE_ENV</span> == <span class="string">&quot;production&quot;</span>) &#123;</span><br><span class="line">      <span class="comment">// 代码压缩，删除console和debugger</span></span><br><span class="line">      <span class="comment">// 大小不变 46.33s -&gt; 44.28s</span></span><br><span class="line">      <span class="comment">// dev无效</span></span><br><span class="line">      config.<span class="property">optimization</span></span><br><span class="line">        .<span class="title function_">minimize</span>(<span class="literal">true</span>)</span><br><span class="line">        .<span class="title function_">minimizer</span>(<span class="string">&quot;terser&quot;</span>)</span><br><span class="line">        .<span class="title function_">tap</span>(<span class="function">(<span class="params">args</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// args[0].cache = false;</span></span><br><span class="line">          <span class="comment">// args[0].parallel = require(&#x27;os&#x27;).cpus().length - 1;</span></span><br><span class="line">          args[<span class="number">0</span>].<span class="property">extractComments</span> = <span class="literal">false</span>;</span><br><span class="line">          <span class="keyword">let</span> &#123; terserOptions &#125; = args[<span class="number">0</span>];</span><br><span class="line">          terserOptions.<span class="property">format</span> = &#123;</span><br><span class="line">            <span class="attr">comments</span>: <span class="literal">false</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">          terserOptions.<span class="property">compress</span>.<span class="property">drop_console</span> = <span class="literal">true</span>;</span><br><span class="line">          terserOptions.<span class="property">compress</span>.<span class="property">drop_debugger</span> = <span class="literal">true</span>;</span><br><span class="line">          terserOptions.<span class="property">compress</span>.<span class="property">warnings</span> = <span class="literal">false</span>;</span><br><span class="line">          terserOptions.<span class="property">compress</span>.<span class="property">pure_funcs</span> = [</span><br><span class="line">            <span class="string">&quot;console.log&quot;</span>,</span><br><span class="line">            <span class="string">&quot;window.console.log&quot;</span>,</span><br><span class="line">          ];</span><br><span class="line">          <span class="keyword">return</span> args;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// OptimizeCssnanoPlugin 合并css 属性，去掉css 注释</span></span><br><span class="line">      <span class="comment">// css 240KB -&gt; 239KB 44.28s -&gt; 46.13s</span></span><br><span class="line">      config.<span class="title function_">plugin</span>(<span class="string">&quot;optimize-css&quot;</span>).<span class="title function_">tap</span>(<span class="function">(<span class="params">options</span>) =&gt;</span> &#123;</span><br><span class="line">        options[<span class="number">0</span>] = &#123;</span><br><span class="line">          <span class="attr">sourceMap</span>: <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">cssnanoOptions</span>: &#123;</span><br><span class="line">            <span class="attr">preset</span>: [</span><br><span class="line">              <span class="string">&quot;default&quot;</span>,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">discardComments</span>: &#123;</span><br><span class="line">                  <span class="attr">removeAll</span>: <span class="literal">true</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">mergeLonghand</span>: <span class="literal">true</span>, <span class="comment">//合并属性</span></span><br><span class="line">                <span class="attr">cssDeclarationSorter</span>: <span class="literal">false</span>, <span class="comment">//根据css的属性名称进行排序</span></span><br><span class="line">              &#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> options;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// vue-cli3.X 会自动进行模块分割抽离 将重要模块抽离</span></span><br><span class="line">      <span class="comment">// 2.87MB -&gt; 2.82MB 46.13s -&gt; 48.91s</span></span><br><span class="line">      config.<span class="property">optimization</span>.<span class="title function_">splitChunks</span>(&#123;</span><br><span class="line">        <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">        <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">          <span class="attr">common</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;chunk~common&quot;</span>,</span><br><span class="line">            <span class="attr">minChunks</span>: <span class="number">2</span>,</span><br><span class="line">            <span class="attr">priority</span>: -<span class="number">30</span>,</span><br><span class="line">            <span class="attr">chunks</span>: <span class="string">&quot;initial&quot;</span>,</span><br><span class="line">            <span class="attr">reuseExistingChunk</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">vendors</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;chunk~vendor&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: -<span class="number">20</span>,</span><br><span class="line">            <span class="attr">chunks</span>: <span class="string">&quot;initial&quot;</span>, <span class="comment">// only package third parties that are initially dependent</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">vant</span>: &#123;</span><br><span class="line">            <span class="comment">// split echarts libs</span></span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;chunk~vant&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]_?@?vant(.*)/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">20</span>,</span><br><span class="line">            <span class="attr">chunks</span>: <span class="string">&quot;async&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">echarts</span>: &#123;</span><br><span class="line">            <span class="comment">// split echarts libs</span></span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;chunk~echarts&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]_?echarts(.*)/</span>,</span><br><span class="line">            <span class="attr">priority</span>: <span class="number">50</span>,</span><br><span class="line">            <span class="attr">chunks</span>: <span class="string">&quot;async&quot;</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">vue</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;chunk~vue&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]vue[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: -<span class="number">11</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">vuex</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;chunk~vuex&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]vuex[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: -<span class="number">12</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;vue-router&quot;</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;chunk~vue-router&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]vue-router[\\/]/</span>,</span><br><span class="line">            <span class="attr">priority</span>: -<span class="number">13</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">styles</span>: &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;styles&quot;</span>,</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(c|le)ss$/</span>,</span><br><span class="line">            <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">            <span class="attr">enforce</span>: <span class="literal">true</span>,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 开启gzip压缩 CompressionWebpackPlugin</span></span><br><span class="line">      <span class="comment">// 2.84MB -&gt; 769KB 55.12s -&gt; 34.95s</span></span><br><span class="line">      <span class="comment">// const CompressionWebpackPlugin = require(&#x27;compression-webpack-plugin&#x27;);</span></span><br><span class="line">      <span class="comment">// config.plugin(&#x27;compressionPlugin&#x27;)</span></span><br><span class="line">      <span class="comment">// .use(new CompressionWebpackPlugin(&#123;</span></span><br><span class="line">      <span class="comment">//   filename: &#x27;[path].gz[query]&#x27;,</span></span><br><span class="line">      <span class="comment">//   algorithm: &#x27;gzip&#x27;,</span></span><br><span class="line">      <span class="comment">//   test: /\.(js|css|json|txt|html|ico|svg)(\?.*)?$/i,</span></span><br><span class="line">      <span class="comment">//   threshold: 10240,</span></span><br><span class="line">      <span class="comment">//   minRatio: 0.8,</span></span><br><span class="line">      <span class="comment">//   deleteOriginalAssets: true</span></span><br><span class="line">      <span class="comment">// &#125;))</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 开启多进程</span></span><br><span class="line">      <span class="comment">// 48.91s -&gt; 48.16s</span></span><br><span class="line">      config.<span class="property">module</span></span><br><span class="line">        .<span class="title function_">rule</span>(<span class="string">&quot;vue&quot;</span>)</span><br><span class="line">        .<span class="title function_">test</span>(<span class="regexp">/\.vue$/</span>)</span><br><span class="line">        .<span class="title function_">use</span>()</span><br><span class="line">        .<span class="title function_">loader</span>(<span class="string">&quot;thread-loader&quot;</span>)</span><br><span class="line">        .<span class="title function_">tap</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">          <span class="keyword">const</span> <span class="variable constant_">OS</span> = <span class="built_in">require</span>(<span class="string">&quot;os&quot;</span>);</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">workers</span>: <span class="variable constant_">OS</span>.<span class="title function_">cpus</span>().<span class="property">length</span> - <span class="number">1</span>,</span><br><span class="line">            <span class="attr">workerParallelJobs</span>: <span class="number">50</span>,</span><br><span class="line">          &#125;;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 开启缓存</span></span><br><span class="line">      <span class="comment">// 大小不变 二次编译时间 27.18s</span></span><br><span class="line">      <span class="comment">// 默认使用cache-loader</span></span><br><span class="line">      <span class="comment">// 为模块提供中间缓存步骤</span></span><br><span class="line">      <span class="keyword">const</span> <span class="title class_">HardSourceWebpackPlugin</span> = <span class="built_in">require</span>(<span class="string">&quot;hard-source-webpack-plugin&quot;</span>);</span><br><span class="line">      config.<span class="title function_">plugin</span>(<span class="string">&quot;HardSourceWebpackPlugin&quot;</span>).<span class="title function_">use</span>(<span class="title class_">HardSourceWebpackPlugin</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="效果对比"><a href="#效果对比" class="headerlink" title="效果对比"></a>效果对比</h2><h3 id="优化前"><a href="#优化前" class="headerlink" title="优化前"></a>优化前</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1639641097319-10faf4f4-5918-491b-933f-03b1ba1f8fd4.png#clientId=u65b575bd-e03e-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=979&id=u32155aef&margin=%5Bobject%20Object%5D&name=image.png&originHeight=979&originWidth=1680&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=361578&status=done&style=none&taskId=ufd420cee-ddfb-4470-a463-e5773e33a33&title=&width=1680" alt="image.png"></p>
<h3 id="分包后"><a href="#分包后" class="headerlink" title="分包后"></a>分包后</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1639649071251-e96b3a95-cd0a-4a4f-8b5e-d71e06c978d2.png#clientId=u65b575bd-e03e-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=979&id=uc2683e72&margin=%5Bobject%20Object%5D&name=image.png&originHeight=979&originWidth=1680&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=318707&status=done&style=none&taskId=u56ada18b-cd0f-45fa-bd75-9560dd2c17e&title=&width=1680" alt="image.png"></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6979879230297341989">https://juejin.cn/post/6979879230297341989</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_21567385/article/details/107677261">https://blog.csdn.net/qq_21567385/article/details/107677261</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6919684767575179278">https://juejin.cn/post/6919684767575179278</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/12/10/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/10/%E5%89%8D%E7%AB%AF%E6%A1%86%E6%9E%B6/" class="post-title-link" itemprop="url">前端框架</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-10 16:09:05" itemprop="dateCreated datePublished" datetime="2021-12-10T16:09:05+08:00">2021-12-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:03" itemprop="dateModified" datetime="2022-02-14T19:41:03+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Svelte"><a href="#Svelte" class="headerlink" title="Svelte"></a>Svelte</h2><h3 id="不采用-Virtual-DOM"><a href="#不采用-Virtual-DOM" class="headerlink" title="不采用 Virtual DOM"></a>不采用 Virtual DOM</h3><p>频繁操作 dom 导致浏览器主线程在 js 引擎和 dom 引擎间频繁切换，性能耗损很大<br>虚拟 dom 可以将一次操作内的更新缓存起来，一次渲染，节省了线程切换的开销<br>但虚拟 dom 的对比过程本身也存在性能损耗<br>​</p>
<h3 id="不基于运行时"><a href="#不基于运行时" class="headerlink" title="不基于运行时"></a>不基于运行时</h3><p>虚拟 dom 是在运行时进行 diff 的设计。框架依赖的代码也会被打包到最终的构建产物中，会不可避免地增加体积。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1639127609895-cb3b7a85-b263-4309-9aca-68e1b84c5894.png#clientId=u8b61987b-e76f-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ue12d6cca&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1161&originWidth=720&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=137341&status=done&style=none&taskId=u89cd58d0-e381-4eb6-a8e7-dec270eb22f&title=" alt="image.png"></p>
<h3 id="核心原理"><a href="#核心原理" class="headerlink" title="核心原理"></a>核心原理</h3><p>Svelte 采用了 Templates 语法（类似于 Vue 的写法），更加严格和具有语义性，可以在<strong>编译时</strong>的就进行优化操作</p>
<h4 id="AST"><a href="#AST" class="headerlink" title="AST"></a>AST</h4><p>Svelte 是在<strong>编译时</strong>，就通过 AST 计算并记录了数据 和 DOM 节点之间的对应关系，并且保存在 p 函数中。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1639127922092-262d5851-78a5-4aa4-9da5-eb0e96cc4663.png#clientId=u8b61987b-e76f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=183&id=ucab11569&margin=%5Bobject%20Object%5D&name=image.png&originHeight=183&originWidth=711&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=83326&status=done&style=none&taskId=u0da7346a-852b-4659-8d85-05d83743378&title=&width=711" alt="image.png"><br>左侧 template 中，其他所有内容都是静态的，只有 name 可能会发生改变。<br>​</p>
<p>右侧 p 函数是编译生成的最终的产物，是原生的 js 可以直接运行在浏览器里，会在有脏数据时被调用。p 函数唯一做的事情就是，当 name 发生变更的时候，调用原生方法把 t1 这个原生 DOM 节点更新。 这里的 set_data 可不是 React 的 setState 或者小程序的 setData ，这里的 set_data 就是封装的原生的 javascript 操作 DOM 节点的方法。<br>​</p>
<p>changed.name 表示有哪些变量被更新了，即自组件最后一次更新以来，哪些数据发生了哪些更改。这些被更新的变量被称为脏数据。</p>
<h4 id="位掩码"><a href="#位掩码" class="headerlink" title="位掩码"></a>位掩码</h4><p>Svelte <strong>记录脏数据</strong>的方式： 位掩码（bitMask）<br>位掩码是一种将多个布尔值存储在单个整数中的技术，一个比特位存放一个数据是否变化，一般 1 表示脏数据，0 表示是干净数据。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1639127965992-dc0f5667-d988-4fc3-8546-e11e61d26b3a.png#clientId=u8b61987b-e76f-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u2f5b24ed&margin=%5Bobject%20Object%5D&name=image.png&originHeight=236&originWidth=720&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=90330&status=done&style=none&taskId=u4bcac12c-3099-498a-b544-98e16f31bb4&title=" alt="image.png"></p>
<h4 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h4><p>通过放到微任务来避免频繁切换线程<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1639128269079-5452917c-3631-47f4-9711-fb9892b02b68.png#clientId=u8b61987b-e76f-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u8c94b6da&margin=%5Bobject%20Object%5D&name=image.png&originHeight=363&originWidth=720&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=165215&status=done&style=none&taskId=ue5507ca4-a429-4c3a-b8a4-4b5cb76a275&title=" alt="image.png"></p>
<h2 id="react"><a href="#react" class="headerlink" title="react"></a>react</h2><h3 id="react-和-vue-异同-to-be-extend"><a href="#react-和-vue-异同-to-be-extend" class="headerlink" title="react 和 vue 异同 to be extend"></a>react 和 vue 异同 to be extend</h3><h4 id="同"><a href="#同" class="headerlink" title="同"></a>同</h4><p>虚拟 dom<br>提供了响应式和组件化的视图组件</p>
<h4 id="异"><a href="#异" class="headerlink" title="异"></a>异</h4><p>不可变数据概念来源于函数式编程。函数式编程中，对已初始化的“变量”是不可以更改的，每次更改都要创建一个新的“变量”。<br>​</p>
<p>​</p>
<p><strong>react 推荐使用纯函数，数据不可变，单向数据流，但是可以手动编写 onChange 等事件处理函数实现双向数据流。</strong><br><strong>vue 认为数据是可变的，使用 v-model 实现双向数据流。</strong><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/357700487#:~:text=React%E8%BF%BD%E6%B1%82%E6%95%B0,%E5%AE%9A%E6%95%B0%E6%8D%AE%E6%9C%89%E6%B2%A1%E6%9C%89%E5%8F%98%E3%80%82">https://zhuanlan.zhihu.com/p/357700487#:~:text=React%E8%BF%BD%E6%B1%82%E6%95%B0,%E5%AE%9A%E6%95%B0%E6%8D%AE%E6%9C%89%E6%B2%A1%E6%9C%89%E5%8F%98%E3%80%82</a><br>在 React 应用中，调用 setState 后，它会以该组件为根，重新渲染整个组件子树。如要避免不必要的子组件的重渲染，你需要在所有可能的地方使用 PureComponent，或是手动实现 <strong>shouldComponentUpdate 为 false</strong> 方法。</p>
<blockquote>
<p>setState 调用后，组件的 render 方法也会自动调用，这就是为什么你能在页面看到新数据。但是无论你 setState 修改的是什么，哪怕是页面里没有的一个数据，render 都会被触发，并且父组件渲染中会嵌套渲染自组件<br>shouldComponentUpdate 判定该组件的 props 和 state 是否有变化，返回 false 用于拦截组件渲染<br>浅比较 props 和 state 是否有变化，至于为什么不深比较？因为那样效率可能会比直接全都运行 render 还低…</p>
</blockquote>
<p>在 Vue 应用中，组件的依赖是在渲染过程中自动收集的。vue 能够更加精确的知道数据变化，只重新渲染与变化数据绑定的 DOM</p>
<p>vue 是双向绑定 双向绑定是在同一个组件内，将数据和视图绑定起来，和父子组件之间的通信并无什么关联思想是响应式的，也就是基于是数据可变的，通过对每一个属性建立 Watcher 来监听， 当属性变化的时候，响应式的更新对应的虚拟 dom<br>react 是单向数据流；react 中通过将 state（Model 层）与 View 层数据进行双向绑定达数据的实时更新变化，具体来说就是在 View 层直接写 JS 代码 Model 层中的数据拿过来渲染，一旦像表单操作、触发事件、ajax 请求等触发数据变化，则进行双同步。<br>​</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://www.sveltejs.cn/blog/virtual-dom-is-pure-overhead">https://www.sveltejs.cn/blog/virtual-dom-is-pure-overhead</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/350507037">https://zhuanlan.zhihu.com/p/350507037</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/12/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/06/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-06 08:54:03" itemprop="dateCreated datePublished" datetime="2021-12-06T08:54:03+08:00">2021-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:03" itemprop="dateModified" datetime="2022-02-14T19:41:03+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/12/06/JavaScript%20%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/12/06/JavaScript%20%E6%A0%B8%E5%BF%83%E6%9C%BA%E5%88%B6/" class="post-title-link" itemprop="url">JavaScript 核心机制</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-06 08:48:21" itemprop="dateCreated datePublished" datetime="2021-12-06T08:48:21+08:00">2021-12-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:03" itemprop="dateModified" datetime="2022-02-14T19:41:03+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="面向对象"><a href="#面向对象" class="headerlink" title="面向对象"></a>面向对象</h2><h3 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h3><p>封装，即隐藏对象的属性和实现细节，仅对外公开接口，控制在程序中属性的读和修改的访问级别；将抽象得到的数据和行为（或功能）相结合，形成一个有机的整体，也就是将数据与操作数据的<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%BA%90%E4%BB%A3%E7%A0%81/3814213">源代码</a>进行有机的结合，形成“类”，其中数据和函数都是类的成员。</p>
<h3 id="多态"><a href="#多态" class="headerlink" title="多态"></a>多态</h3><p>同一操作作用于不同的对象，可以有不同的解释，产生不同的执行结果。在运行时，可以通过指向基类的指针，来调用实现派生类中的方法。<br>​</p>
<p>虚函数和模版（java 中的范型）是支持多态的主要方式，因为 javascript 中没有模版，所以下面我们只讨论虚函数，下面先看一个例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;I am a Person, my name is &quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Man</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="title class_">Person</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Man</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Man</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">toString</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;I am a Man, my name is&quot;</span> + <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Neo&quot;</span>, <span class="number">19</span>);</span><br><span class="line"><span class="keyword">var</span> man1 = <span class="keyword">new</span> <span class="title class_">Man</span>(<span class="string">&quot;Davin&quot;</span>, <span class="number">18</span>);</span><br><span class="line"><span class="keyword">var</span> man2 =</span><br><span class="line">  <span class="keyword">new</span> <span class="title class_">Man</span>(<span class="string">&quot;Jack&quot;</span>, <span class="number">19</span>) &gt;</span><br><span class="line">  person + <span class="string">&quot;&quot;</span> &gt;</span><br><span class="line">  <span class="string">&quot;I am a Person, my name is Neo&quot;</span> &gt;</span><br><span class="line">  man1 + <span class="string">&quot;&quot;</span> &gt;</span><br><span class="line">  <span class="string">&quot;I am a Man, my name isDavin&quot;</span> &gt;</span><br><span class="line">  man1 &lt;</span><br><span class="line">  man2 &gt; <span class="comment">//期望比较年龄大小 1</span></span><br><span class="line">  <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p>上面例子中，我们分别在子类和父类实现了 toString 方法，其实，在 js 中上述代码原理很简单，对于同名函数，子类会覆父类的，这种特性其实就是虚函数，只不过 js 中不区分参数个数，也不区分参数类型，只看函数名称，如果名称相同就会覆盖。现在我们来看注释 1，我们期望直接用比较运算符比较两个 man 的大小（按年龄），怎么实现？在 c++中有运算符重载，但 java 和 js 中都没有，所幸的是，js 可以用一种变通的方法来实现：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">valueOf</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">age</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Man</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">  <span class="title class_">Person</span>.<span class="title function_">apply</span>(<span class="variable language_">this</span>, <span class="variable language_">arguments</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Man</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="keyword">var</span> person = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Neo&quot;</span>, <span class="number">19</span>);</span><br><span class="line"><span class="keyword">var</span> man1 = <span class="keyword">new</span> <span class="title class_">Man</span>(<span class="string">&quot;Davin&quot;</span>, <span class="number">18</span>);</span><br><span class="line"><span class="keyword">var</span> man2 = <span class="keyword">new</span> <span class="title class_">Man</span>(<span class="string">&quot;Jack&quot;</span>, <span class="number">19</span>);</span><br><span class="line"><span class="keyword">var</span> man3 =</span><br><span class="line">  ((<span class="keyword">new</span> <span class="title class_">Man</span>(<span class="string">&quot;Joe&quot;</span>, <span class="number">19</span>) &gt;</span><br><span class="line">    man1 &lt;</span><br><span class="line">    <span class="number">19</span> &gt; <span class="comment">//1</span></span><br><span class="line">    <span class="literal">true</span> &gt;</span><br><span class="line">    person ==</span><br><span class="line">    <span class="number">19</span> &gt; <span class="comment">//2</span></span><br><span class="line">      <span class="literal">true</span> &gt;</span><br><span class="line">      man1 &lt;</span><br><span class="line">      man2 &gt; <span class="comment">//3</span></span><br><span class="line">      <span class="literal">true</span> &gt;</span><br><span class="line">      man2) ==</span><br><span class="line">    man3 &gt; <span class="comment">//4 注意</span></span><br><span class="line">      <span class="literal">true</span> &gt;</span><br><span class="line">      person) ==</span><br><span class="line">  man2 &gt; <span class="comment">//5</span></span><br><span class="line">    <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p>其中 1、2、3、5 在所有 js vm 下结果都是确定的。但是 4 并不一定！javascript 规定，对于比较运算符，如果一个值是对象，另一个值是数字时，会先尝试调用 valueOf，如果 valueOf 未指定，就会调用 toString；如果是字符串时，则先尝试调用 toString，如果没指定，则尝试 valueOf，如果两者都没指定，将抛出一个类型错误异常。如果比较的两个值都是对象时，则比较的时对象的引用地址，所以若是对象，只有自身＝＝＝自身，其它情况都是 false。现在我们回过头来看看示例代码，前三个都是标准的行为。而第四点取决于浏览器的实现，如果严格按照标准，这应该算是 chrome 的一个 bug ,但是，我们的代码使用时双等号，并非严格相等判断，所以浏览器的相等规则也会放宽。值得一提的是 5，虽然 person 和 man2 age 都是 19，但是结果却是 false。** 总结一下，chrome 对相同类的实例比较策略是先会尝试转化，然后再比较大小，而对非同类实例的比较，则会直接返回 false，不会做任何转化。<strong>所以我的建议是：如果数字和类实例比较，永远是安全的，可以放心玩，如果是同类实例之间，可以进行</strong>非等**比较，这个结果是可以保证的，不要进行相等比较，结果是不能保证的，一般相等比较，变通的做法是：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> equal = !(ob1 &lt; ob2 || ob1 &gt; ob2);</span><br><span class="line"><span class="comment">//不小于也不大于，就是等于，前提是比较操作符两边的对象要实现valueOf或toString</span></span><br></pre></td></tr></table></figure>

<p>当然类似 toString、valueOf 的还有 toJson 方法，但它和重载没有什么关系，故不冗述。</p>
<h3 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h3><h4 id="创建原型"><a href="#创建原型" class="headerlink" title="创建原型"></a>创建原型</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="title class_">Parent</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">fn</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;fn&quot;</span>);</span><br><span class="line">&#125;; <span class="comment">// 添加方法</span></span><br></pre></td></tr></table></figure>

<h4 id="原型链继承"><a href="#原型链继承" class="headerlink" title="原型链继承"></a>原型链继承</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Parent</span>(); <span class="comment">// Child.prototype = Object.create(Parent.prototype);</span></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Child</span>; <span class="comment">// 修复constructor的指向</span></span><br></pre></td></tr></table></figure>

<p>缺点：</p>
<ol>
<li>引用类型的属性被所有实例共享</li>
<li>在创建 Child 的实例时，不能向 Parent 传参</li>
</ol>
<h4 id="借用构造函数"><a href="#借用构造函数" class="headerlink" title="借用构造函数"></a>借用构造函数</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, params);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">XX</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优点：</p>
<ol>
<li>避免了引用类型的属性被所有实例共享，因为构建并生成了新的对象</li>
<li>可以在 Child 中向 Parent 传参</li>
</ol>
<p>缺点：</p>
<ol>
<li>方法都在构造函数中定义，每次创建实例都会创建一遍方法。</li>
<li>不能继承方法(fn)</li>
</ol>
<h4 id="组合继承（原型链-借用构造函数）"><a href="#组合继承（原型链-借用构造函数）" class="headerlink" title="组合继承（原型链+借用构造函数）"></a>组合继承（原型链+借用构造函数）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">params</span>) &#123;</span><br><span class="line">  <span class="title class_">Parent</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, params);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title class_">Parent</span>();</span><br><span class="line"><span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Child</span>;</span><br></pre></td></tr></table></figure>

<p>优点：融合原型链继承和构造函数的优点，是 JavaScript 中最常用的继承模式。<br>缺点：调用两次父构造函数</p>
<h4 id="原型式继承"><a href="#原型式继承" class="headerlink" title="原型式继承"></a>原型式继承</h4><p>Object.create 的模拟实现，将传入的对象作为创建的对象的原型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个中间对象F继承Parent，F的原型指向Parent</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createObj</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">F</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  F.<span class="property"><span class="keyword">prototype</span></span> = o;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">F</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>优点：给 child 的原型添加属性，不会影响 parent 或者 parent 的原型，因为 child 的原型是 parent 的实例<br>缺点：包含引用类型的属性值始终都会共享相应的值，这点跟原型链继承一样</p>
<h4 id="寄生式继承"><a href="#寄生式继承" class="headerlink" title="寄生式继承"></a>寄生式继承</h4><p>创建一个<strong>仅用于封装继承</strong>过程的函数，该函数在内部以某种形式来做增强对象，最后返回对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createObj</span>(<span class="params">o</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> clone = <span class="title function_">createObj</span>(o); <span class="comment">// 可用其他继承方法代替</span></span><br><span class="line">  clone.<span class="property">sayName</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 增强对象</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hi&quot;</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">return</span> clone;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>缺点：跟借用构造函数模式一样，每次创建对象都会创建一遍方法。</p>
<h4 id="寄生组合式继承（寄生式-原型式继承）"><a href="#寄生组合式继承（寄生式-原型式继承）" class="headerlink" title="寄生组合式继承（寄生式+原型式继承）"></a>寄生组合式继承（寄生式+原型式继承）</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 寄生式</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">prototype</span>(<span class="params">child, parent</span>) &#123;</span><br><span class="line">  <span class="comment">// prototype和parent同级</span></span><br><span class="line">  <span class="keyword">var</span> prototype = <span class="title function_">createObj</span>(parent.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// 原型式 代替 new Parent()</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 修正中间对象和原型对象各自的指向</span></span><br><span class="line">  prototype.<span class="property">constructor</span> = child;</span><br><span class="line">  child.<span class="property"><span class="keyword">prototype</span></span> = prototype;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当我们使用的时候：</span></span><br><span class="line"><span class="title function_">prototype</span>(<span class="title class_">Child</span>, <span class="title class_">Parent</span>);</span><br></pre></td></tr></table></figure>

<p>优点：只调用了一次 Parent 构造函数，并且因此避免了在 Parent.prototype 上面创建不必要的、多余的属性。与此同时，原型链还能保持不变；因此，还能够正常使用 instanceof 和 isPrototypeOf</p>
<h4 id="new"><a href="#new" class="headerlink" title="new"></a>new</h4><p>new 运算符创建一个用户定义的对象类型的实例或具有构造函数的内置对象类型之一</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> new2 = <span class="keyword">function</span> (<span class="params">func</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> o = <span class="title class_">Object</span>.<span class="title function_">create</span>(func.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// 创建对象</span></span><br><span class="line">  <span class="keyword">var</span> k = func.<span class="title function_">call</span>(o); <span class="comment">// 改变this指向，把结果付给k</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> k === <span class="string">&quot;object&quot;</span> ? k : <span class="number">0</span>; <span class="comment">// 判断k的类型是不是对象 是，返回k 不是返回构造函数的执行结果</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">objectFactory</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> obj = <span class="keyword">new</span> <span class="title class_">Object</span>(),</span><br><span class="line">    <span class="title class_">Constructor</span> = [].<span class="property">shift</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>); <span class="comment">// 取参数第一位</span></span><br><span class="line">  obj.<span class="property">__proto__</span> = <span class="title class_">Constructor</span>.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// 以上三行相当于 var o = Object.create(func.prototype);</span></span><br><span class="line">  <span class="keyword">var</span> ret = <span class="title class_">Constructor</span>.<span class="title function_">apply</span>(obj, <span class="variable language_">arguments</span>); <span class="comment">// 相当于 var k = func.call(o);</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">typeof</span> ret === <span class="string">&quot;object&quot;</span> ? ret : obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="类"><a href="#类" class="headerlink" title="类"></a>类</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  func1 = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(); <span class="comment">//调用父类的构造函数，调用之后，子类才有this</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">filed3</span> = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>class 的底层依然是构造函数，Babel 化后代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Parent</span> = <span class="keyword">function</span> <span class="title function_">Parent</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, <span class="title class_">Parent</span>);</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">func1</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Child</span> = (<span class="keyword">function</span> (<span class="params">_Parent</span>) &#123;</span><br><span class="line">  <span class="title function_">_inherits</span>(<span class="title class_">Child</span>, _Parent);</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Child</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="title function_">_classCallCheck</span>(<span class="variable language_">this</span>, <span class="title class_">Child</span>);</span><br><span class="line">    <span class="keyword">var</span> _this = <span class="title function_">_possibleConstructorReturn</span>(</span><br><span class="line">      <span class="variable language_">this</span>,</span><br><span class="line">      (<span class="title class_">Child</span>.<span class="property">__proto__</span> || <span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(<span class="title class_">Child</span>)).<span class="title function_">call</span>(<span class="variable language_">this</span>, a)</span><br><span class="line">    );</span><br><span class="line">    <span class="comment">// _this 上绑定其他属性</span></span><br><span class="line">    _this.<span class="property">filed3</span> = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> _this;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Child</span>;</span><br><span class="line">&#125;)(<span class="title class_">Parent</span>);</span><br></pre></td></tr></table></figure>

<p>_classCallCheck 内部实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_classCallCheck</span>(<span class="params">instance, Constructor</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> <span class="title class_">Constructor</span>)) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(<span class="string">&quot;Cannot call a class as a function&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>_inherits 内部实现，典型的寄生继承</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_inherits</span>(<span class="params">subClass, superClass</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> superClass !== <span class="string">&quot;function&quot;</span> &amp;&amp; superClass !== <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">TypeError</span>(</span><br><span class="line">      <span class="string">&quot;Super expression must either be null or a function, not &quot;</span> +</span><br><span class="line">        <span class="keyword">typeof</span> superClass</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  subClass.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(superClass &amp;&amp; superClass.<span class="property"><span class="keyword">prototype</span></span>, &#123;</span><br><span class="line">    <span class="attr">constructor</span>: &#123;</span><br><span class="line">      <span class="attr">value</span>: subClass,</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">writable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">if</span> (superClass)</span><br><span class="line">    <span class="title class_">Object</span>.<span class="property">setPrototypeOf</span></span><br><span class="line">      ? <span class="title class_">Object</span>.<span class="title function_">setPrototypeOf</span>(subClass, superClass)</span><br><span class="line">      : (subClass.<span class="property">__proto__</span> = superClass);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="super"><a href="#super" class="headerlink" title="super"></a>super</h4><p>当作函数指代父类构造函数 Parent.prototype.construtor()<br>ES6 要求，子类的构造函数必须执行一次 super 函数默认的构造函数中会主动调用父类构造函数，并默认把当前 constructor 传递的参数传给了父类。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">super</span>(); <span class="comment">// Parent.prototype.constructor.call(this)</span></span><br></pre></td></tr></table></figure>

<p>所以当我们声明了 constructor 后必须主动调用 super(),否则无法调用父构造函数，无法完成继承。<br>​</p>
<p>当作对象</p>
<ul>
<li>普通方法中指向父类的原型对象，this 指向子类</li>
<li>静态方法中指向父类本身，this 指向父类</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_ inherited__">A</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">x</span> = <span class="number">2</span>;</span><br><span class="line">    <span class="variable language_">super</span>.<span class="property">x</span> = <span class="number">3</span>; <span class="comment">// 相当于 this.x = 3</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">super</span>.<span class="property">x</span>); <span class="comment">// undefined 父类没有增加x属性</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">x</span>); <span class="comment">// 3 子类的x属性被改变</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="static"><a href="#static" class="headerlink" title="static"></a>static</h4><p>static 修饰的属性和方法都是静态方法和属性,只能被类名调用,不能被实例化对象调用.同时也<strong>不能被子类继承，子类中可用 super 调用</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="keyword">static</span> info = <span class="string">&quot;&quot;</span>;</span><br><span class="line">  <span class="keyword">static</span> <span class="title function_">love</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 直接使用类名调用</span></span><br><span class="line">A.<span class="property">info</span>;</span><br><span class="line">A.<span class="title function_">love</span>();</span><br></pre></td></tr></table></figure>

<p>​</p>
<p>​</p>
<h3 id="原型链"><a href="#原型链" class="headerlink" title="原型链"></a>原型链</h3><p><strong>proto</strong>我们称为隐式原型，只是对象内置属性[[Prototype]]的非标准实现，虽然浏览器都支持但是不推荐使用。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1638890082760-7c96c7ef-91b4-4f0d-b558-c93ce297c5bc.png#clientId=u945953d6-1a7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=542&id=u4f14e49c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=542&originWidth=614&originalType=binary%E2%88%B6=1&rotation=0&showTitle=false&size=39705&status=done&style=none&taskId=u1d09ca32-e703-4d27-8aa5-628a14d8138&title=&width=614" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1638923197549-172a0c84-1946-4952-8426-c1012bec8bbf.png#clientId=u3d0f7f7a-a24b-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=udc5e086a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=709&originWidth=570&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=206541&status=done&style=none&taskId=uc4c9de66-2755-4100-acd2-817ed2dbfed&title=" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1638890884927-4459e1e9-b997-4cc4-b158-9a73411a2006.png#clientId=u945953d6-1a7f-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u25c381c6&margin=%5Bobject%20Object%5D&name=image.png&originHeight=992&originWidth=1768&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=173146&status=done&style=none&taskId=u65dc00f9-9cbb-4c78-ad74-3ba3496ce78&title=" alt="image.png"></p>
<h4 id="instanceof"><a href="#instanceof" class="headerlink" title="instanceof"></a>instanceof</h4><p>判断实例对象的<strong>proto</strong>和生成改实例的构造函数 prototype 是不是引用的同一个地址</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">new_instance_of</span>(<span class="params">leftVaule, rightVaule</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> rightProto = rightVaule.<span class="property"><span class="keyword">prototype</span></span>; <span class="comment">// 取右表达式的 prototype 值</span></span><br><span class="line">  leftVaule = leftVaule.<span class="property">__proto__</span>; <span class="comment">// 取左表达式的__proto__值</span></span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (leftVaule === <span class="literal">null</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (leftVaule === rightProto) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    leftVaule = leftVaule.<span class="property">__proto__</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
<h3 id="​"><a href="#​" class="headerlink" title="​"></a>​</h3><p>​</p>
<p>​</p>
<p>​</p>
<h2 id="作用域"><a href="#作用域" class="headerlink" title="作用域"></a>作用域</h2><h3 id="执行栈"><a href="#执行栈" class="headerlink" title="执行栈"></a>执行栈</h3><p>当一个脚本第一次执行的时候，js 引擎会解析这段代码，并将其中的同步代码按照执行顺序加入执行栈中，然后从头开始执行。如果当前执行的是一个方法，那么 js 会向执行栈中添加这个方法的执行环境，然后进入这个执行环境继续执行其中的代码。当这个执行环境中的代码 执行完毕并返回结果后，js 会退出这个执行环境并把这个执行环境销毁，回到上一个方法的执行环境。。这个过程反复进行，直到执行栈中的代码全部执行完毕。<br><img src="https://cdn.nlark.com/yuque/0/2021/gif/106384/1640145272577-94f22c82-8ac1-4b6f-ad24-b19b15a28dac.gif#clientId=ube258cab-0ad9-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u98216960&margin=%5Bobject%20Object%5D&originHeight=259&originWidth=390&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u65d2330e-1537-4cfc-bab2-ccd7284b9db&title="><br>​</p>
<p>​</p>
<p>当 JavaScript 代码执行一段可执行代码(executable code)时，会创建对应的执行上下文(execution context)。<br>对于每个执行上下文，都有三个重要属性：</p>
<ul>
<li>变量对象(Variable object，VO)</li>
<li>作用域链(Scope chain)</li>
<li>this</li>
</ul>
<p>​</p>
<p>执行过程：</p>
<ol>
<li>进入全局代码，创建全局执行上下文，全局执行上下文压入执行上下文栈</li>
<li>全局执行上下文初始化</li>
<li>执行 checkscope 函数，创建 checkscope 函数执行上下文，checkscope 执行上下文被压入执行上下文栈</li>
<li>checkscope 执行上下文初始化，创建变量对象、作用域链、this 等</li>
<li>checkscope 函数执行完毕，checkscope 执行上下文从执行上下文栈中弹出</li>
<li>执行 f 函数，创建 f 函数执行上下文，f 执行上下文被压入执行上下文栈</li>
<li>f 执行上下文初始化，创建变量对象、作用域链、this 等</li>
<li>f 函数执行完毕，f 函数上下文从执行上下文栈中弹出</li>
</ol>
<h3 id="作用域链"><a href="#作用域链" class="headerlink" title="作用域链"></a>作用域链</h3><p>当查找变量的时候，会先从当前上下文的变量对象中查找，如果没有找到，就会从父级(词法层面上的父级)执行上下文的变量对象中查找，一直找到全局上下文的变量对象，也就是全局对象。这样由多个执行上下文的变量对象构成的<strong>链表</strong><code>**[[scope]]**</code>就叫做作用域链<br>注意：[[scope]] 并不代表完整的作用域链！</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">bar</span>(<span class="params"></span>) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Scope = [AO].concat([[Scope]]);</span></span><br><span class="line">foo.[[scope]] = [</span><br><span class="line">  globalContext.<span class="property">VO</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">bar.[[scope]] = [</span><br><span class="line">    fooContext.<span class="property">AO</span>,</span><br><span class="line">    globalContext.<span class="property">VO</span></span><br><span class="line">];</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当函数激活时，进入函数上下文，创建 VO(Variable Object, 变量对象)/AO(activation object, 活动对象) 后，就会将活动对象添加到作用链的前端。<br>未进入执行阶段之前，VO 中的属性都不能访问！但是进入执行阶段之后，变量对象(VO)转变为了活动对象(AO)，里面的属性都能被访问了，然后开始进行执行阶段的操作。<br>​</p>
<h3 id="变量提升"><a href="#变量提升" class="headerlink" title="变量提升"></a>变量提升</h3><p>当进入执行上下文时，这时候还没有执行代码，<br>变量对象会包括：</p>
<ol>
<li>函数的所有形参 (如果是函数上下文)<ul>
<li>由名称和对应值组成的一个变量对象的属性被创建</li>
<li>没有实参，属性值设为 undefined</li>
</ul>
</li>
<li>函数声明<ul>
<li>由名称和对应值（函数对象(function-object)）组成一个变量对象的属性被创建</li>
<li>如果变量对象已经存在相同名称的属性，则完全替换这个属性</li>
</ul>
</li>
<li>变量声明<ul>
<li>由名称和对应值（undefined）组成一个变量对象的属性被创建；</li>
<li>如果变量名称跟已经声明的形式参数或函数相同，则变量声明不会干扰已经存在的这类属性</li>
</ul>
</li>
</ol>
<p>在进入执行上下文时，首先会处理函数声明，其次会处理变量声明，进行变量提升</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">foo</span>(<span class="params">a</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">c</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  <span class="keyword">var</span> d = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  b = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">  e = <span class="number">1</span> <span class="comment">// 没有通过 var 关键字声明，所以不会被存放在 AO 中</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">foo</span>(<span class="number">1</span>);</span><br><span class="line"><span class="comment">// 当进入执行上下文时</span></span><br><span class="line"><span class="variable constant_">AO</span> = &#123;</span><br><span class="line">  <span class="attr">arguments</span>: &#123;</span><br><span class="line">      <span class="number">0</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">length</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>, <span class="comment">// 形参</span></span><br><span class="line">  <span class="attr">b</span>: <span class="literal">undefined</span>, <span class="comment">// 变量声明</span></span><br><span class="line">  <span class="attr">c</span>: reference to <span class="keyword">function</span> <span class="title function_">c</span>(<span class="params"></span>)&#123;&#125;, <span class="comment">// 函数声明</span></span><br><span class="line">  <span class="attr">d</span>: <span class="literal">undefined</span> <span class="comment">// 变量声明</span></span><br><span class="line">  <span class="comment">// e Uncaught ReferenceError: e is not defined</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 当代码执行完后</span></span><br><span class="line"><span class="variable constant_">AO</span> = &#123;</span><br><span class="line">  <span class="attr">arguments</span>: &#123;</span><br><span class="line">      <span class="number">0</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">length</span>: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">c</span>: reference to <span class="keyword">function</span> <span class="title function_">c</span>(<span class="params"></span>)&#123;&#125;,</span><br><span class="line">  <span class="attr">d</span>: reference to <span class="title class_">FunctionExpression</span> <span class="string">&quot;d&quot;</span></span><br><span class="line">  <span class="attr">e</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><h4 id="bind"><a href="#bind" class="headerlink" title="bind"></a>bind</h4><p>bind() 方法会<strong>创建一个新函数</strong>。当这个新函数被调用时，bind() 的第一个参数将作为它运行时的 this，之后的一序列参数将会在传递的实参前传入作为它的参数。<br>​</p>
<p>一个绑定函数也能使用 new 操作符创建对象：这种行为就像把原函数当成构造器。提供的 this 值被忽略，同时调用时的参数被提供给模拟函数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">bind2</span> = <span class="keyword">function</span> (<span class="params">context</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> <span class="variable language_">this</span> !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(</span><br><span class="line">      <span class="string">&quot;Function.prototype.bind - what is trying to be bound is not callable&quot;</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> self = <span class="variable language_">this</span>;</span><br><span class="line">  <span class="keyword">var</span> args = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fNOP = <span class="keyword">function</span> (<span class="params"></span>) &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> fBound = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> bindArgs = <span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>);</span><br><span class="line">    <span class="keyword">return</span> self.<span class="title function_">apply</span>(</span><br><span class="line">      <span class="variable language_">this</span> <span class="keyword">instanceof</span> fNOP ? <span class="variable language_">this</span> : context,</span><br><span class="line">      args.<span class="title function_">concat</span>(bindArgs)</span><br><span class="line">    );</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  fNOP.<span class="property"><span class="keyword">prototype</span></span> = <span class="variable language_">this</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br><span class="line">  fBound.<span class="property"><span class="keyword">prototype</span></span> = <span class="keyword">new</span> <span class="title function_">fNOP</span>();</span><br><span class="line">  <span class="keyword">return</span> fBound;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="call"><a href="#call" class="headerlink" title="call"></a>call</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="title function_">call</span>(obj,[param1[,param2[,…[,paramN]]]])</span><br></pre></td></tr></table></figure>

<h4 id="apply"><a href="#apply" class="headerlink" title="apply"></a>apply</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Function</span>.<span class="title function_">apply</span>(obj[,argArray])</span><br></pre></td></tr></table></figure>

<p>​</p>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>MDN 对闭包的定义为：</p>
<blockquote>
<p>闭包是指那些能够访问自由变量的函数。</p>
</blockquote>
<p>那什么是自由变量呢？</p>
<blockquote>
<p>自由变量是指在函数中使用的，但既不是函数参数也不是函数的局部变量的变量。</p>
</blockquote>
<p>由此，我们可以看出闭包共有两部分组成：</p>
<blockquote>
<p><strong>闭包 = 函数 + 函数能够访问的自由变量</strong></p>
</blockquote>
<p>ECMAScript 中，闭包指的是：</p>
<ol>
<li>从理论角度：所有的函数。因为它们都在创建的时候就将上层上下文的数据保存起来了。哪怕是简单的全局变量也是如此，因为函数中访问全局变量就相当于是在访问自由变量，这个时候使用最外层的作用域。</li>
<li>从实践角度：以下函数才算是闭包：<ol>
<li>即使创建它的上下文已经销毁，它仍然存在（比如，内部函数从父函数中返回）</li>
<li>在代码中引用了自由变量</li>
</ol>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scope = <span class="string">&quot;global scope&quot;</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">checkscope</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> scope = <span class="string">&quot;local scope&quot;</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">f</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> scope;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> f;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="title function_">checkscope</span>();</span><br><span class="line"><span class="title function_">foo</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// f 执行上下文维护了一个作用域链：</span></span><br><span class="line"></span><br><span class="line">fContext = &#123;</span><br><span class="line">  <span class="title class_">Scope</span>: [<span class="variable constant_">AO</span>, checkscopeContext.<span class="property">AO</span>, globalContext.<span class="property">VO</span>],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>当 f 函数引用了 checkscopeContext.AO 中的值的时候，即使 checkscopeContext 被销毁了，但是 JavaScript 依然会让 checkscopeContext.AO 活在内存中，f 函数依然可以通过 f 函数的作用域链找到它</p>
<h4 id="柯里化"><a href="#柯里化" class="headerlink" title="柯里化"></a>柯里化</h4><p>函数柯里化是把接受多个参数的函数变换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。<br>主要作用是</p>
<ul>
<li>参数复用</li>
<li>提前返回 – 返回接受余下的参数且返回结果的新函数</li>
<li>延迟执行 – 返回新函数，等待执行</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">curry</span> = (<span class="params">fn, ...args</span>) =&gt;</span><br><span class="line">  args.<span class="property">length</span> &lt; fn.<span class="property">length</span></span><br><span class="line">    ? <span class="comment">//参数长度不足时，递归调用柯里化，等待接受新参数</span></span><br><span class="line">      <span class="function">(<span class="params">...<span class="variable language_">arguments</span></span>) =&gt;</span> <span class="title function_">curry</span>(fn, ...args, ...<span class="variable language_">arguments</span>) <span class="comment">//参数长度满足时，执行函数</span></span><br><span class="line">    : <span class="title function_">fn</span>(...args);</span><br></pre></td></tr></table></figure>

<p>​</p>
<p>​</p>
<p>​</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://github.com/mqyqingfeng/Blog/issues/16">https://github.com/mqyqingfeng/Blog/issues/16</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/11/05/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">数据结构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-05 14:37:01" itemprop="dateCreated datePublished" datetime="2021-11-05T14:37:01+08:00">2021-11-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:03" itemprop="dateModified" datetime="2022-02-14T19:41:03+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="私有属性"><a href="#私有属性" class="headerlink" title="私有属性"></a>私有属性</h2><p>以下数据结构类的核心数据存在 constructor 中，但并不是私有属性，仍然可以通过外部来进行改变，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> test = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">test.<span class="property">value</span> = [<span class="string">&quot;test&quot;</span>];</span><br></pre></td></tr></table></figure>

<p>可以用一些方法来调整，但后续为显示方便省略。</p>
<h3 id="symbol"><a href="#symbol" class="headerlink" title="symbol"></a>symbol</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> value = <span class="title class_">Symbol</span>();</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>[value] = [];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>仍然可以通过<code>test.getOwnPropertySynbols()</code>来获取</p>
<h3 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h3><p>WeakMap 的键是对象</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _value = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    _value.<span class="title function_">set</span>(<span class="variable language_">this</span>, []);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> _value.<span class="title function_">get</span>(<span class="variable language_">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上都可以通过闭包将 data 封装起来，避免外界接触</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cosnt <span class="title class_">Stack</span> = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> _value = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">      _value.<span class="title function_">set</span>(<span class="variable language_">this</span>, []);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title function_">value</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> _value.<span class="title function_">get</span>(<span class="variable language_">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Stack</span></span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>ES2019 中已经增加了对 class 私有属性的原生支持，只需要在属性/方法名前面加上 ‘#’ 就可以将其定义为私有，并且支持定义私有的 static 属性/方法</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line">  <span class="comment">// 私有属性</span></span><br><span class="line">  <span class="comment">// #value;</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.#value = value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">get</span> <span class="title function_">name</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.#value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h2><p>后进先出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Stack</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 增</span></span><br><span class="line">  <span class="title function_">push</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">push</span>(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 删</span></span><br><span class="line">  <span class="title function_">pop</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">pop</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 查</span></span><br><span class="line">  <span class="title function_">size</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">isEmpty</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">value</span>.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 以防修改</span></span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">concat</span>([]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="队列"><a href="#队列" class="headerlink" title="队列"></a>队列</h2><p>先进先出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Queue</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 增</span></span><br><span class="line">  <span class="title function_">enqueue</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">push</span>(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 删</span></span><br><span class="line">  <span class="title function_">dequeue</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">shift</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 查</span></span><br><span class="line">  <span class="title function_">size</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">isEmpty</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">value</span>.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">concat</span>([]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="优先队列"><a href="#优先队列" class="headerlink" title="优先队列"></a>优先队列</h3><p>元素的添加和移除基于优先级，以下是入队时排序好的方法，还有出队时再根据优先级排序的方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PriorityQueue</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Queue</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Element</span> = <span class="keyword">class</span> <span class="title class_">Element</span> &#123;</span><br><span class="line">      <span class="title function_">constructor</span>(<span class="params">value, priority</span>) &#123;</span><br><span class="line">        <span class="comment">// 不输入默认最低优先级</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">priority</span> = priority;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 优先级规则 返回true为高优先级</span></span><br><span class="line">  <span class="title function_">superior</span>(<span class="params">a = <span class="number">0</span>, b = <span class="number">0</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a &gt; b;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">enqueue</span>(<span class="params">value, priority</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">value</span>: queue, <span class="title class_">Element</span>, superior &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> element = <span class="keyword">new</span> <span class="title class_">Element</span>(value, priority);</span><br><span class="line">    <span class="keyword">let</span> index = queue.<span class="title function_">findIndex</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> superior(priority, item.<span class="property">priority</span>));</span><br><span class="line">    index &gt; -<span class="number">1</span> ? queue.<span class="title function_">splice</span>(index, <span class="number">0</span>, element) : queue.<span class="title function_">push</span>(element);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">dequeue</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> res = <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">shift</span>();</span><br><span class="line">    <span class="keyword">return</span> res &amp;&amp; res.<span class="property">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">it</span>) =&gt;</span> it.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="循环队列"><a href="#循环队列" class="headerlink" title="循环队列"></a>循环队列</h3><p>击鼓传花游戏</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hotPotato</span>(<span class="params">list, num</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> queue = <span class="keyword">new</span> <span class="title class_">Queue</span>();</span><br><span class="line">  list.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> queue.<span class="title function_">enqueue</span>(item));</span><br><span class="line">  <span class="keyword">while</span> (queue.<span class="title function_">size</span>() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; num; i++) &#123;</span><br><span class="line">      queue.<span class="title function_">enqueue</span>(queue.<span class="title function_">dequeue</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 完成一轮淘汰一个</span></span><br><span class="line">    queue.<span class="title function_">dequeue</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 剩下最后一个queue.data[0]</span></span><br><span class="line">  <span class="keyword">return</span> queue.<span class="title function_">dequeue</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="集合"><a href="#集合" class="headerlink" title="集合"></a>集合</h2><p>模拟 ES6 <code>Set</code>数据结构</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">_Set</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 对象不允许一个键指向两个不同的属性，保证了集合里的元素都是唯一的</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 增</span></span><br><span class="line">  <span class="title function_">add</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(value)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 同时作为键和值保存方便检索</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span>[value] = value; <span class="comment">// 也可以使用深拷贝来跟WeakSet区分</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 删</span></span><br><span class="line">  <span class="title function_">remove</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(value)) &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">value</span>[value];</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 查</span></span><br><span class="line">  <span class="title function_">has</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">hasOwnProperty</span>(value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">size</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">keys</span>(<span class="variable language_">this</span>.<span class="property">value</span>).<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">values</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 并集</span></span><br><span class="line">  <span class="title function_">union</span>(<span class="params">otherSet</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> unionSet = <span class="keyword">new</span> <span class="title function_">_Set</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">values</span>().<span class="title function_">forEach</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> unionSet.<span class="title function_">add</span>(value));</span><br><span class="line">    otherSet.<span class="title function_">values</span>().<span class="title function_">forEach</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> unionSet.<span class="title function_">add</span>(value));</span><br><span class="line">    <span class="keyword">return</span> unionSet;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 交集</span></span><br><span class="line">  <span class="title function_">intersection</span>(<span class="params">otherSet</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> intersectionSet = <span class="keyword">new</span> <span class="title function_">_Set</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">values</span>().<span class="title function_">forEach</span>(</span><br><span class="line">      <span class="function">(<span class="params">value</span>) =&gt;</span> otherSet.<span class="title function_">has</span>(value) &amp;&amp; intersectionSet.<span class="title function_">add</span>(value)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> intersectionSet;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 差集</span></span><br><span class="line">  <span class="title function_">difference</span>(<span class="params">otherSet</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> differenceSet = <span class="keyword">new</span> <span class="title function_">_Set</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">values</span>().<span class="title function_">forEach</span>(</span><br><span class="line">      <span class="function">(<span class="params">value</span>) =&gt;</span> otherSet.<span class="title function_">has</span>(value) || intersectionSet.<span class="title function_">add</span>(value)</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">return</span> differenceSet;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 子集</span></span><br><span class="line">  <span class="title function_">subset</span>(<span class="params">otherSet</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">size</span>() &gt; otherSet.<span class="title function_">size</span>()</span><br><span class="line">      ? <span class="literal">false</span></span><br><span class="line">      : <span class="variable language_">this</span>.<span class="title function_">values</span>().<span class="title function_">every</span>(<span class="function">(<span class="params">value</span>) =&gt;</span> otherSet.<span class="title function_">has</span>(value));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="弱集合和弱字典"><a href="#弱集合和弱字典" class="headerlink" title="弱集合和弱字典"></a>弱集合和弱字典</h3><p>WeakMap 和 WeakSet 有如下特点：</p>
<ol>
<li><p>只能用对象作为键，只能存放对象的引用</p>
</li>
<li><p>存放是弱引用，方便垃圾回收</p>
</li>
<li><p>因为存放的是弱引用，随时会被垃圾回收掉，运行前后遍历结果不一样，所以没有没有<code>entries/keys/values</code>等迭代器方法。</p>
</li>
<li><p>必须用键才能取出值，</p>
<p>所以 WeakSet 一般被用作用来保存 DOM 节点，不容易造成内存泄漏，WeakMap 用来保存对象不想被遍历的私有属性。<br>实现方法跟上面差不多就不赘述，只不过少掉一些遍历器方法以及需要检查键是否是对象。</p>
</li>
</ol>
<h2 id="字典"><a href="#字典" class="headerlink" title="字典"></a>字典</h2><p>模拟 ES6 <code>Map</code>数据结构</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">_Map</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 对象不允许一个键指向两个不同的属性，保证了集合里的元素都是唯一的</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 增</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span>[key] = value; <span class="comment">// 也可以使用深拷贝来跟WeakMap区分</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 删</span></span><br><span class="line">  <span class="title function_">delete</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">value</span>[key];</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">clear</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = &#123;&#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 查</span></span><br><span class="line">  <span class="title function_">has</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">hasOwnProperty</span>(key);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">has</span>(key) ? <span class="variable language_">this</span>.<span class="property">value</span>[key] : <span class="literal">undefined</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">size</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">keys</span>().<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">keys</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">values</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Object</span>.<span class="title function_">values</span>(<span class="variable language_">this</span>.<span class="property">value</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="散列表"><a href="#散列表" class="headerlink" title="散列表"></a>散列表</h3><p>散列算法的作用是采用类似按部首查字典的方法，尽可能<strong>快</strong>地在数据结构中找到一个值。散列函数的作用是给定一个健值，然后返回值在表中的地址。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HashTable</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 函数名啥意思？</span></span><br><span class="line">  <span class="title function_">loseloseHashCode</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> hash = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; key.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      hash += key.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> hash % <span class="number">37</span>; <span class="comment">//取模意味着这个数据结构最多存放 36 个元素</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 增</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">value</span>[<span class="variable language_">this</span>.<span class="title function_">loseloseHashCode</span>(key)] = value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 删</span></span><br><span class="line">  <span class="title function_">delete</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">delete</span> <span class="variable language_">this</span>.<span class="property">value</span>[<span class="variable language_">this</span>.<span class="title function_">loseloseHashCode</span>(key)];</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 查</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">has</span>(key) ? <span class="variable language_">this</span>.<span class="property">value</span>[<span class="variable language_">this</span>.<span class="title function_">loseloseHashCode</span>(key)] : <span class="literal">undefined</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">has</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">hasOwnProperty</span>(<span class="variable language_">this</span>.<span class="title function_">loseloseHashCode</span>(key));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;acc&#125;</span> <span class="subst">$&#123;index&#125;</span>: <span class="subst">$&#123;cur&#125;</span>;\n`</span>;</span><br><span class="line">    &#125;, <span class="string">``</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是你会发现散列表是有冲突的，后面加入的项会覆盖前面的项。处理冲突的几种方式：</p>
<h4 id="分离链接"><a href="#分离链接" class="headerlink" title="分离链接"></a>分离链接</h4><p>每个位置创建一个链表储存元素，但是需要额外空间<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1636392393415-c4b57310-747d-4bbe-906c-18b6925712a7.png#height=440&id=u018efc45&margin=%5Bobject%20Object%5D&name=image.png&originHeight=440&originWidth=1100&originalType=binary%E2%88%B6=1&size=35087&status=done&style=none&width=1100" alt="image.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LikedHashTable</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HashTable</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Node</span> = <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">      <span class="title function_">constructor</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">key</span> = key;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// 自定义链表的findPosition方法</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">_LinkedList</span> = <span class="keyword">class</span> <span class="title class_">_LinkedList</span> <span class="keyword">extends</span> <span class="title class_ inherited__">LinkedList</span> &#123;</span><br><span class="line">      <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">findPosition</span>(<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span>,</span><br><span class="line">          index = -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (current) &#123;</span><br><span class="line">          <span class="comment">// 只能对比基本类型和地址相同的引用类型</span></span><br><span class="line">          <span class="keyword">if</span> (current.<span class="property">value</span>.<span class="property">key</span> === key) &#123;</span><br><span class="line">            <span class="keyword">return</span> index + <span class="number">1</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          index++;</span><br><span class="line">          current = current.<span class="property">next</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">findValue</span>(<span class="params">key</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span>;</span><br><span class="line">        <span class="keyword">while</span> (current) &#123;</span><br><span class="line">          <span class="keyword">if</span> (current.<span class="property">value</span>.<span class="property">key</span> === key) &#123;</span><br><span class="line">            <span class="keyword">return</span> current.<span class="property">value</span>.<span class="property">value</span>;</span><br><span class="line">          &#125;</span><br><span class="line">          current = current.<span class="property">next</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">values</span>(<span class="params">symbol = <span class="string">&quot;-&gt;&quot;</span></span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span>,</span><br><span class="line">          values = [];</span><br><span class="line">        <span class="keyword">while</span> (current) &#123;</span><br><span class="line">          values.<span class="title function_">push</span>(<span class="string">`<span class="subst">$&#123;current.value.key&#125;</span> + <span class="subst">$&#123;current.value.value&#125;</span>`</span>);</span><br><span class="line">          current = current.<span class="property">next</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> values.<span class="title function_">join</span>(symbol);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 增</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">value</span>: table, <span class="title class_">Node</span>, _LinkedList, loseloseHashCode &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> position = <span class="title function_">loseloseHashCode</span>(key);</span><br><span class="line">      <span class="keyword">if</span> (!table[position]) &#123;</span><br><span class="line">        table[position] = <span class="keyword">new</span> <span class="title function_">_LinkedList</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      table[position].<span class="title function_">append</span>(<span class="keyword">new</span> <span class="title class_">Node</span>(key, value));</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 删</span></span><br><span class="line">  <span class="title function_">delete</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value, loseloseHashCode &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> element = value[<span class="title function_">loseloseHashCode</span>(key)];</span><br><span class="line">    <span class="keyword">return</span> element ? element.<span class="title function_">remove</span>(key) : <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 查</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value, loseloseHashCode &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> element = value[<span class="title function_">loseloseHashCode</span>(key)];</span><br><span class="line">    <span class="keyword">return</span> element ? element.<span class="title function_">findValue</span>(key) : <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">has</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value, loseloseHashCode &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> element = value[<span class="title function_">loseloseHashCode</span>(key)];</span><br><span class="line">    <span class="keyword">return</span> element ? element.<span class="title function_">findPosition</span>(key) &gt; -<span class="number">1</span> : <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 改</span></span><br><span class="line">  <span class="title function_">update</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">value</span>: table, <span class="title class_">Node</span>, loseloseHashCode &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">has</span>(key)) &#123;</span><br><span class="line">      <span class="keyword">const</span> element = table[<span class="title function_">loseloseHashCode</span>(key)];</span><br><span class="line">      element.<span class="title function_">update</span>(element.<span class="title function_">findPosition</span>(key), <span class="keyword">new</span> <span class="title class_">Node</span>(key, value));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;acc&#125;</span> <span class="subst">$&#123;index&#125;</span>: <span class="subst">$&#123;cur.values()&#125;</span>;\n`</span>;</span><br><span class="line">    &#125;, <span class="string">``</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="线性探查"><a href="#线性探查" class="headerlink" title="线性探查"></a>线性探查</h4><p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1636392401334-a06e6d29-a8ec-4423-803a-774efb4e3c32.png#height=640&id=u9b0fbdfc&margin=%5Bobject%20Object%5D&name=image.png&originHeight=640&originWidth=1064&originalType=binary%E2%88%B6=1&size=48373&status=done&style=none&width=1064" alt="image.png"><br>当想向表中某个位置加入一个新元素的时候，如果索引为 index 的位置已经被占据了，就尝试 index+1 的位置。如果 index+1 的位置也被占据了，就尝试 index+2 的位置，以此类推。<br>但这种方案存在一个问题需要修复：假如因为删除导致空挡，但要查找的值在空挡下方，怎么办？</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LinarHashTable</span> <span class="keyword">extends</span> <span class="title class_ inherited__">HashTable</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Node</span> = <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">      <span class="title function_">constructor</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">key</span> = key;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">findPosition</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; value, loseloseHashCode &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> position = <span class="title function_">loseloseHashCode</span>(key);</span><br><span class="line">    <span class="keyword">while</span> (value[position] !== <span class="literal">undefined</span> &amp;&amp; value[position].<span class="property">key</span> !== key) &#123;</span><br><span class="line">      position++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> value[position] ? position : -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 增</span></span><br><span class="line">  <span class="title function_">set</span>(<span class="params">key, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="attr">value</span>: table, <span class="title class_">Node</span>, loseloseHashCode &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">let</span> position = <span class="title function_">loseloseHashCode</span>(key);</span><br><span class="line">    <span class="keyword">while</span> (table[position] !== <span class="literal">undefined</span> &amp;&amp; table[position].<span class="property">key</span> !== key) &#123;</span><br><span class="line">      position++;</span><br><span class="line">    &#125;</span><br><span class="line">    table[position] = <span class="keyword">new</span> <span class="title class_">Node</span>(key, value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 删</span></span><br><span class="line">  <span class="title function_">delete</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> position = <span class="variable language_">this</span>.<span class="title function_">findPosition</span>(key);</span><br><span class="line">    <span class="keyword">if</span> (position !== -<span class="number">1</span>) &#123;</span><br><span class="line">      <span class="comment">// 不需要把后面的递补上来？</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">value</span>[position] = <span class="literal">undefined</span>;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 查</span></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> position = <span class="variable language_">this</span>.<span class="title function_">findPosition</span>(key);</span><br><span class="line">    <span class="keyword">return</span> position === -<span class="number">1</span> ? <span class="literal">undefined</span> : <span class="variable language_">this</span>.<span class="property">value</span>[position].<span class="property">value</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">has</span>(<span class="params">key</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">findPosition</span>(key) !== -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">value</span>.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;acc&#125;</span> <span class="subst">$&#123;index&#125;</span>: <span class="subst">$&#123;cur ? cur.key + <span class="string">&quot;+&quot;</span> + cur.value : <span class="string">&quot;&quot;</span>&#125;</span>;\n`</span>;</span><br><span class="line">    &#125;, <span class="string">``</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="双散列法"><a href="#双散列法" class="headerlink" title="双散列法"></a>双散列法</h4><p>这种方法使用两个散列函数 h1 和 h2。其中 h1 和前面的 h 一样，以关键字为自变量，产生一个 0 至 m-1 之间的数作为散列地址；h2 也以关键字为自变量，产生一个 1 至 m-1 之间的并和 m <strong>互素</strong>的数（即 m 不能被该数整除）作为探查序列的地址增量（即步长）。这样做是使探查序列能够分布在整个 Hash 表</p>
<h2 id="链表"><a href="#链表" class="headerlink" title="链表"></a>链表</h2><p>关键是两个查找函数，目前采用递归查询：</p>
<ol>
<li>根据值查找位置的<code>findPosition</code></li>
<li>根据位置查找值的<code>find</code></li>
</ol>
<p>其他方法根据这两个来衍生</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LinkedList</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 基本结构</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Node</span> = <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">      <span class="title function_">constructor</span>(<span class="params">value, next</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">next</span> = next;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">head</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 查位置</span></span><br><span class="line">  <span class="title function_">findPosition</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span>,</span><br><span class="line">      index = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (current) &#123;</span><br><span class="line">      <span class="comment">// 只能对比基本类型和地址相同的引用类型</span></span><br><span class="line">      <span class="keyword">if</span> (current.<span class="property">value</span> === value) &#123;</span><br><span class="line">        <span class="keyword">return</span> index + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      index++;</span><br><span class="line">      current = current.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 查值</span></span><br><span class="line">  <span class="title function_">find</span>(<span class="params">position</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">      <span class="keyword">typeof</span> position !== <span class="string">&quot;number&quot;</span> ||</span><br><span class="line">      <span class="built_in">isNaN</span>(position) ||</span><br><span class="line">      position &lt; <span class="number">0</span> ||</span><br><span class="line">      position &gt; <span class="variable language_">this</span>.<span class="property">length</span> - <span class="number">1</span></span><br><span class="line">    ) &#123;</span><br><span class="line">      <span class="comment">// 溢出</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span>,</span><br><span class="line">      index = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (index++ &lt; position) &#123;</span><br><span class="line">      current = current.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> current;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 增</span></span><br><span class="line">  <span class="comment">// 递归寻找末端</span></span><br><span class="line">  <span class="title function_">append</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">insert</span>(<span class="variable language_">this</span>.<span class="property">length</span>, value);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">insert</span>(<span class="params">position, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="title class_">Node</span> &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> node = <span class="keyword">new</span> <span class="title class_">Node</span>(value);</span><br><span class="line">    <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> current = <span class="variable language_">this</span>.<span class="property">head</span>;</span><br><span class="line">      node.<span class="property">next</span> = current;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">head</span> = node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 0 1 2 在1位置插入3 -&gt; 0 3 1 2?</span></span><br><span class="line">      <span class="keyword">const</span> previous = <span class="variable language_">this</span>.<span class="title function_">find</span>(position - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (!previous) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      node.<span class="property">next</span> = previous.<span class="property">next</span>;</span><br><span class="line">      previous.<span class="property">next</span> = node;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span>++;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 删</span></span><br><span class="line">  <span class="title function_">removeAt</span>(<span class="params">position</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span>;</span><br><span class="line">    <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">head</span> = current.<span class="property">next</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> previous = <span class="variable language_">this</span>.<span class="title function_">find</span>(position - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">if</span> (!previous) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      current = previous.<span class="property">next</span>;</span><br><span class="line">      previous.<span class="property">next</span> = current.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span>--;</span><br><span class="line">    <span class="keyword">return</span> current;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">remove</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">removeAt</span>(<span class="variable language_">this</span>.<span class="title function_">findPosition</span>(value));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">size</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">isEmpty</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> !<span class="variable language_">this</span>.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">values</span>(<span class="params">symbol = <span class="string">&quot;-&gt;&quot;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span>,</span><br><span class="line">      values = [];</span><br><span class="line">    <span class="keyword">while</span> (current) &#123;</span><br><span class="line">      values.<span class="title function_">push</span>(current.<span class="property">value</span>);</span><br><span class="line">      current = current.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> values.<span class="title function_">join</span>(symbol);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 改</span></span><br><span class="line">  <span class="title function_">update</span>(<span class="params">position, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> node = <span class="variable language_">this</span>.<span class="title function_">find</span>(position);</span><br><span class="line">    <span class="keyword">if</span> (node) &#123;</span><br><span class="line">      node.<span class="property">value</span> = value;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="双向链表"><a href="#双向链表" class="headerlink" title="双向链表"></a>双向链表</h3><p>拥有一个 prev 属性指向前节点，拥有更大的弹性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DoublyLinkedList</span> <span class="keyword">extends</span> <span class="title class_ inherited__">LinkedList</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Node</span> = <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">      <span class="title function_">constructor</span>(<span class="params">value, prev, next</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">next</span> = next;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">prev</span> = prev;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">head</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">tail</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">connet</span>(<span class="params">previous, next</span>) &#123;</span><br><span class="line">    previous.<span class="property">next</span> = next;</span><br><span class="line">    next.<span class="property">prev</span> = previous;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">insert</span>(<span class="params">position, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; head, tail, length, <span class="title class_">Node</span>, connet, find &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> node = <span class="keyword">new</span> <span class="title class_">Node</span>(value);</span><br><span class="line">    <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 添加在开头有两种情况</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 空链表</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tail</span> = node;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">head</span> = node;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 有值的链表</span></span><br><span class="line">        <span class="title function_">connet</span>(node, head);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">head</span> = node;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position === length) &#123;</span><br><span class="line">      <span class="comment">// 添加在末尾</span></span><br><span class="line">      <span class="title function_">connet</span>(tail, node);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tail</span> = node;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// find里面调用this, 不通过this.find调用存在this指向问题</span></span><br><span class="line">      <span class="keyword">const</span> current = find.<span class="title function_">call</span>(<span class="variable language_">this</span>, position);</span><br><span class="line">      <span class="keyword">if</span> (!current) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">connet</span>(current.<span class="property">prev</span>, node);</span><br><span class="line">      <span class="title function_">connet</span>(node, current);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span>++;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">removeAt</span>(<span class="params">position</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; head, tail, length, connet, find &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">head</span> = head.<span class="property">next</span>;</span><br><span class="line">      <span class="keyword">if</span> (length === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tail</span> = head.<span class="property">next</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">head</span>.<span class="property">prev</span> = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">length</span>--;</span><br><span class="line">      <span class="keyword">return</span> head;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position === length - <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tail</span> = tail.<span class="property">prev</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tail</span>.<span class="property">next</span> = <span class="literal">null</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">length</span>--;</span><br><span class="line">      <span class="keyword">return</span> tail;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> current = find.<span class="title function_">call</span>(<span class="variable language_">this</span>, position);</span><br><span class="line">      <span class="keyword">if</span> (!current) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">connet</span>(current.<span class="property">prev</span>, current.<span class="property">next</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">length</span>--;</span><br><span class="line">      <span class="keyword">return</span> current;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="循环链表"><a href="#循环链表" class="headerlink" title="循环链表"></a>循环链表</h3><p>在双向链表的基础上首尾衔接形成环</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CircleLinkedList</span> <span class="keyword">extends</span> <span class="title class_ inherited__">DoublyLinkedList</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">circle</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; head, tail &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    head.<span class="property">prev</span> = tail;</span><br><span class="line">    tail.<span class="property">next</span> = head;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">insert</span>(<span class="params">position, value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; head, tail, length, <span class="title class_">Node</span>, connet, find, circle &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> node = <span class="keyword">new</span> <span class="title class_">Node</span>(value);</span><br><span class="line">    <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="comment">// 添加在开头有两种情况</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 空链表</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tail</span> = node;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">head</span> = node;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 有值的链表</span></span><br><span class="line">        <span class="title function_">connet</span>(node, head);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">head</span> = node;</span><br><span class="line">      &#125;</span><br><span class="line">      circle.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position === length) &#123;</span><br><span class="line">      <span class="comment">// 添加在末尾</span></span><br><span class="line">      <span class="title function_">connet</span>(tail, node);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tail</span> = node;</span><br><span class="line">      circle.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> current = find.<span class="title function_">call</span>(<span class="variable language_">this</span>, position);</span><br><span class="line">      <span class="keyword">if</span> (!current) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">connet</span>(current.<span class="property">prev</span>, node);</span><br><span class="line">      <span class="title function_">connet</span>(node, current);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span>++;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">removeAt</span>(<span class="params">position</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; head, tail, length, connet, circle, find &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">if</span> (position === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">head</span> = head.<span class="property">next</span>;</span><br><span class="line">      <span class="keyword">if</span> (length === <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">tail</span> = head.<span class="property">next</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">head</span>.<span class="property">prev</span> = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">length</span>--;</span><br><span class="line">      circle.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">      <span class="keyword">return</span> head;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (position === length - <span class="number">1</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tail</span> = tail.<span class="property">prev</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">tail</span>.<span class="property">next</span> = <span class="literal">null</span>;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">length</span>--;</span><br><span class="line">      circle.<span class="title function_">call</span>(<span class="variable language_">this</span>);</span><br><span class="line">      <span class="keyword">return</span> tail;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> current = find.<span class="title function_">call</span>(<span class="variable language_">this</span>, position);</span><br><span class="line">      <span class="keyword">if</span> (!current) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="title function_">connet</span>(current.<span class="property">prev</span>, current.<span class="property">next</span>);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">length</span>--;</span><br><span class="line">      <span class="keyword">return</span> current;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 避免死循环重写</span></span><br><span class="line">  <span class="title function_">findPosition</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span>,</span><br><span class="line">      index = -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (current &amp;&amp; index &lt; <span class="variable language_">this</span>.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="comment">// 只能对比基本类型和地址相同的引用类型</span></span><br><span class="line">      <span class="keyword">if</span> (current.<span class="property">value</span> === value) &#123;</span><br><span class="line">        <span class="keyword">return</span> index + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      index++;</span><br><span class="line">      current = current.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> current &amp;&amp; index &lt; <span class="variable language_">this</span>.<span class="property">length</span> ? index : -<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">values</span>(<span class="params">symbol = <span class="string">&quot;-&gt;&quot;</span></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> current = <span class="variable language_">this</span>.<span class="property">head</span>,</span><br><span class="line">      values = [],</span><br><span class="line">      index = <span class="variable language_">this</span>.<span class="property">length</span>;</span><br><span class="line">    <span class="keyword">while</span> (index-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">      values.<span class="title function_">push</span>(current.<span class="property">value</span>);</span><br><span class="line">      current = current.<span class="property">next</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> values.<span class="title function_">join</span>(symbol);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="树"><a href="#树" class="headerlink" title="树"></a>树</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Tree</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">Node</span> = <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">      <span class="title function_">constructor</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">left</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">right</span> = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">root</span> = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 中序遍历</span></span><br><span class="line">  <span class="title function_">inOrderTraverse</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">inOrderTraverseNode</span> = (<span class="params">node, callback</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (node !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title function_">inOrderTraverseNode</span>(node.<span class="property">left</span>, callback);</span><br><span class="line">        <span class="title function_">callback</span>(node.<span class="property">value</span>);</span><br><span class="line">        <span class="title function_">inOrderTraverseNode</span>(node.<span class="property">right</span>, callback);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">inOrderTraverseNode</span>(<span class="variable language_">this</span>.<span class="property">root</span>, callback);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 前序遍历</span></span><br><span class="line">  <span class="title function_">preOrderTraverse</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">preOrderTraverseNode</span> = (<span class="params">node, callback</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (node !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title function_">callback</span>(node.<span class="property">value</span>);</span><br><span class="line">        <span class="title function_">preOrderTraverseNode</span>(node.<span class="property">left</span>, callback);</span><br><span class="line">        <span class="title function_">preOrderTraverseNode</span>(node.<span class="property">right</span>, callback);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">preOrderTraverseNode</span>(<span class="variable language_">this</span>.<span class="property">root</span>, callback);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 后序遍历</span></span><br><span class="line">  <span class="title function_">postOrderTraverse</span>(<span class="params">callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">postOrderTraverseNode</span> = (<span class="params">node, callback</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (node !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title function_">postOrderTraverseNode</span>(node.<span class="property">left</span>, callback);</span><br><span class="line">        <span class="title function_">postOrderTraverseNode</span>(node.<span class="property">right</span>, callback);</span><br><span class="line">        <span class="title function_">callback</span>(node.<span class="property">value</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="title function_">postOrderTraverseNode</span>(<span class="variable language_">this</span>.<span class="property">root</span>, callback);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="二叉搜索树"><a href="#二叉搜索树" class="headerlink" title="二叉搜索树"></a>二叉搜索树</h3><ul>
<li>可为空树；</li>
<li>满足左子节点（最小） &lt;= 根节点 &lt;= 右子节点（最大），不存在相等值的节点；</li>
<li>中序遍历按小到大排序</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BinarySearchTree</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Tree</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 增</span></span><br><span class="line">  <span class="title function_">insert</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; <span class="title class_">Node</span> &#125; = <span class="variable language_">this</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">insertNode</span> = (<span class="params">tree, node</span>) =&gt; &#123;</span><br><span class="line">      <span class="keyword">if</span> (!tree) &#123;</span><br><span class="line">        <span class="keyword">return</span> node;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (node.<span class="property">value</span> &gt; tree.<span class="property">value</span>) &#123;</span><br><span class="line">        tree.<span class="property">right</span> = <span class="title function_">insertNode</span>(tree.<span class="property">right</span>, node);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        tree.<span class="property">left</span> = <span class="title function_">insertNode</span>(tree.<span class="property">left</span>, node);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> tree;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">root</span> = <span class="title function_">insertNode</span>(<span class="variable language_">this</span>.<span class="property">root</span>, <span class="keyword">new</span> <span class="title class_">Node</span>(value));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 查</span></span><br><span class="line">  <span class="title function_">min</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> temp = <span class="variable language_">this</span>.<span class="property">root</span>;</span><br><span class="line">    <span class="keyword">while</span> (temp) &#123;</span><br><span class="line">      temp = temp.<span class="property">left</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">max</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> temp = <span class="variable language_">this</span>.<span class="property">root</span>;</span><br><span class="line">    <span class="keyword">while</span> (temp) &#123;</span><br><span class="line">      temp = temp.<span class="property">right</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> temp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">search</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="title function_">searchNode</span> = (<span class="params">node, value</span>) =&gt;</span><br><span class="line">      node === <span class="literal">null</span></span><br><span class="line">        ? <span class="literal">null</span></span><br><span class="line">        : node.<span class="property">value</span> === value</span><br><span class="line">        ? node</span><br><span class="line">        : <span class="title function_">searchNode</span>(node.<span class="property">value</span> &gt; key ? node.<span class="property">left</span> : node.<span class="property">right</span>, key);</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">searchNode</span>(<span class="variable language_">this</span>.<span class="property">root</span>, value);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h3><p>堆，又叫二叉堆是一种特殊的完全二叉树 ，完全二叉树意味着每个节点都有两个孩子节点。堆能够高效、快速地找出最大值和最小值，时间复杂度 O(1) 。在开发中，有时候我们可能会想要找到一个数组中的最大或者最小元素，而堆，就可以找出第 K 个最大（小）元素。<br>JS 通常用数组来表示堆。但可以用树的模型来理解。</p>
<ul>
<li>左侧节点的位置是 2*index+1 。</li>
<li>右侧节点的位置是 2*index+2 。</li>
<li>父节点位置是 (index - 1) / 2 。</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1636447012161-ea87e642-9c42-421e-93b7-b5ee6cf767c2.png#clientId=uf94f90b7-0927-4&from=paste&id=u4ddae027&margin=%5Bobject%20Object%5D&name=image.png&originHeight=270&originWidth=429&originalType=url%E2%88%B6=1&size=67156&status=done&style=none&taskId=u87af19dc-db15-4843-9cbc-a1098ec6eb6" alt="image.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Heap</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">heap</span> = [];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断函数</span></span><br><span class="line">  <span class="title function_">judge</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">swap</span>(<span class="params">i, j</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> temp = <span class="variable language_">this</span>.<span class="property">heap</span>[i];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">heap</span>[i] = <span class="variable language_">this</span>.<span class="property">heap</span>[j];</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">heap</span>[j] = temp;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getParentIndex</span>(<span class="params">i</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Math</span>.<span class="title function_">floor</span>((i - <span class="number">1</span>) / <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// (i - 1) &gt;&gt; 1</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getLeftIndex</span>(<span class="params">i</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> i * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">getRightIndex</span>(<span class="params">i</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> i * <span class="number">2</span> + <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 上移操作</span></span><br><span class="line">  <span class="title function_">shiftUp</span>(<span class="params">index</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (index === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> parentIndex = <span class="variable language_">this</span>.<span class="title function_">getParentIndex</span>(index);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">judge</span>(parentIndex, index)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">swap</span>(parentIndex, index);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">shiftUp</span>(parentIndex);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">shiftDown</span>(<span class="params">index</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> leftIndex = <span class="variable language_">this</span>.<span class="title function_">getLeftIndex</span>(index);</span><br><span class="line">    <span class="keyword">const</span> rightIndex = <span class="variable language_">this</span>.<span class="title function_">getRightIndex</span>(index);</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">judge</span>(index, leftIndex)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">swap</span>(leftIndex, index);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">shiftDown</span>(leftIndex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">judge</span>(index, rightIndex)) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">swap</span>(rightIndex, index);</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">shiftDown</span>(rightIndex);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 值插入堆的底部 然后上移</span></span><br><span class="line">  <span class="title function_">insert</span>(<span class="params">value</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">heap</span>.<span class="title function_">push</span>(value);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">shiftUp</span>(<span class="variable language_">this</span>.<span class="property">heap</span>.<span class="property">length</span> - <span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 删除堆顶 用数组尾部元素替换堆顶（因为直接删除堆顶会破坏堆结构）, 然后下移</span></span><br><span class="line">  <span class="title function_">shift</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">heap</span>[<span class="number">0</span>] = <span class="variable language_">this</span>.<span class="property">heap</span>.<span class="title function_">pop</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">shiftDown</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 变成树</span></span><br><span class="line">  <span class="title function_">tree</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">      <span class="title function_">constructor</span>(<span class="params">value</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">value</span> = value;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">left</span> = <span class="literal">null</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">right</span> = <span class="literal">null</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    <span class="keyword">let</span> head = <span class="literal">null</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">heap</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">value, index</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> node = <span class="keyword">new</span> <span class="title class_">Node</span>(value);</span><br><span class="line">      map.<span class="title function_">set</span>(index, node);</span><br><span class="line">      <span class="keyword">let</span> father = <span class="title class_">Math</span>.<span class="title function_">floor</span>((index - <span class="number">1</span>) / <span class="number">2</span>);</span><br><span class="line">      <span class="keyword">if</span> (father &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        head = node;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> position = father === (index - <span class="number">1</span>) / <span class="number">2</span> ? <span class="string">&quot;left&quot;</span> : <span class="string">&quot;right&quot;</span>;</span><br><span class="line">        map.<span class="title function_">get</span>(father)[position] = node;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="最大堆"><a href="#最大堆" class="headerlink" title="最大堆"></a>最大堆</h4><p>所有子节点小于父节点<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1636446999392-470b1eea-f559-41b0-ad07-65e94969ccc6.png#clientId=uf94f90b7-0927-4&from=paste&id=u61a6a087&margin=%5Bobject%20Object%5D&originHeight=970&originWidth=1707&originalType=url%E2%88%B6=1&status=done&style=none&taskId=uec2059e1-cdaa-4a73-9c37-dcf23af111e"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MaxHeap</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Heap</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">judge</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">heap</span>[a] &lt; <span class="variable language_">this</span>.<span class="property">heap</span>[b];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="最小堆"><a href="#最小堆" class="headerlink" title="最小堆"></a>最小堆</h4><p>所有子节点大于父节点</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MinHeap</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Heap</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">judge</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">heap</span>[a] &gt; <span class="variable language_">this</span>.<span class="property">heap</span>[b];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="图"><a href="#图" class="headerlink" title="图"></a>图</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Graph</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vertices</span> = <span class="keyword">new</span> <span class="title class_">Set</span>(); <span class="comment">// 顶点 可用Set会不方便遍历？</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">adjList</span> = <span class="keyword">new</span> <span class="title class_">Map</span>(); <span class="comment">// 边</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 添加新顶点</span></span><br><span class="line">  <span class="title function_">addVertex</span>(<span class="params">v</span>) &#123;</span><br><span class="line">    <span class="comment">// if(!this.vertices.has(v)) &#123;</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">vertices</span>.<span class="title function_">add</span>(v);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">adjList</span>.<span class="title function_">has</span>(v) || <span class="variable language_">this</span>.<span class="property">adjList</span>.<span class="title function_">set</span>(v, []);</span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 添加a,b顶点之间的边</span></span><br><span class="line">  <span class="title function_">addEdge</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="comment">// 如果图中没有顶点a，先添加顶点a</span></span><br><span class="line">    !<span class="variable language_">this</span>.<span class="property">adjList</span>.<span class="title function_">has</span>(a) &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">addVertex</span>(a);</span><br><span class="line">    <span class="comment">// 如果图中没有顶点b，先添加顶点b</span></span><br><span class="line">    !<span class="variable language_">this</span>.<span class="property">adjList</span>.<span class="title function_">has</span>(b) &amp;&amp; <span class="variable language_">this</span>.<span class="title function_">addVertex</span>(b);</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">adjList</span>.<span class="title function_">get</span>(a).<span class="title function_">push</span>(b); <span class="comment">// 在顶点a中添加指向顶点b的边</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">adjList</span>.<span class="title function_">get</span>(b).<span class="title function_">push</span>(a); <span class="comment">// 在顶点b中添加指向顶点a的边</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 可视化</span></span><br><span class="line">  <span class="title function_">values</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Array</span>.<span class="title function_">from</span>(<span class="variable language_">this</span>.<span class="property">vertices</span>).<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, v</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">`<span class="subst">$&#123;acc&#125;</span><span class="subst">$&#123;v&#125;</span> -&gt; <span class="subst">$&#123;<span class="variable language_">this</span>.adjList</span></span></span><br><span class="line"><span class="subst"><span class="string">        .get(v)</span></span></span><br><span class="line"><span class="subst"><span class="string">        .map((e) =&gt; <span class="string">`<span class="subst">$&#123;e&#125;</span>`</span>)</span></span></span><br><span class="line"><span class="subst"><span class="string">        .join(<span class="string">&quot; &quot;</span>)&#125;</span> \n`</span>;</span><br><span class="line">    &#125;, <span class="string">``</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">initHistory</span>(<span class="params">vertices</span>) &#123;</span><br><span class="line">    <span class="comment">// 0 未访问 1 已访问未探索 2 已探索</span></span><br><span class="line">    <span class="keyword">const</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">    vertices.<span class="title function_">forEach</span>(<span class="function">(<span class="params">v</span>) =&gt;</span> map.<span class="title function_">set</span>(v, <span class="number">0</span>));</span><br><span class="line">    <span class="keyword">return</span> map;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 广度优先 BFS 队列 将图的顶点存入队列中，最先入队列的顶点先被探索</span></span><br><span class="line">  <span class="title function_">breadthFirstSearch</span>(<span class="params">start, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; vertices, adjList &#125; = <span class="variable language_">this</span>,</span><br><span class="line">      history = <span class="variable language_">this</span>.<span class="title function_">initHistory</span>(vertices),</span><br><span class="line">      queue = <span class="keyword">new</span> <span class="title class_">Queue</span>();</span><br><span class="line"></span><br><span class="line">    queue.<span class="title function_">enqueue</span>(start);</span><br><span class="line">    <span class="keyword">while</span> (!queue.<span class="title function_">isEmpty</span>()) &#123;</span><br><span class="line">      <span class="keyword">let</span> v = queue.<span class="title function_">dequeue</span>();</span><br><span class="line">      adjList.<span class="title function_">get</span>(v).<span class="title function_">forEach</span>(<span class="function">(<span class="params">u</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (history.<span class="title function_">get</span>(u) === <span class="number">0</span>) &#123;</span><br><span class="line">          history.<span class="title function_">set</span>(u, <span class="number">1</span>);</span><br><span class="line">          queue.<span class="title function_">enqueue</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      history.<span class="title function_">set</span>(v, <span class="number">2</span>);</span><br><span class="line">      <span class="title function_">callback</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 深度优先 DFS 栈 将图的顶点存入栈中，顶点是沿着路径被探索的，存在新的相邻顶点就去访问</span></span><br><span class="line">  <span class="title function_">depthFirstSearch</span>(<span class="params">start, callback</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; vertices, adjList &#125; = <span class="variable language_">this</span>,</span><br><span class="line">      history = <span class="variable language_">this</span>.<span class="title function_">initHistory</span>(vertices),</span><br><span class="line">      stack = <span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line"></span><br><span class="line">    stack.<span class="title function_">push</span>(start);</span><br><span class="line">    <span class="keyword">while</span> (!stack.<span class="title function_">isEmpty</span>()) &#123;</span><br><span class="line">      <span class="keyword">let</span> v = stack.<span class="title function_">pop</span>();</span><br><span class="line">      adjList.<span class="title function_">get</span>(v).<span class="title function_">forEach</span>(<span class="function">(<span class="params">u</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (history.<span class="title function_">get</span>(u) === <span class="number">0</span>) &#123;</span><br><span class="line">          history.<span class="title function_">set</span>(u, <span class="number">1</span>);</span><br><span class="line">          stack.<span class="title function_">push</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      history.<span class="title function_">set</span>(v, <span class="number">2</span>);</span><br><span class="line">      <span class="title function_">callback</span>(v);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://book.douban.com/subject/26639401/">https://book.douban.com/subject/26639401/</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/336044542">https://zhuanlan.zhihu.com/p/336044542</a><br><a target="_blank" rel="noopener" href="https://github.com/CatcherInSky/Simple-Implementation">https://github.com/CatcherInSky/Simple-Implementation</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/367874354">https://zhuanlan.zhihu.com/p/367874354</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/jaxu/p/11338294.html">https://www.cnblogs.com/jaxu/p/11338294.html</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6991208255452086285">https://juejin.cn/post/6991208255452086285</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903880174600205">https://juejin.cn/post/6844903880174600205</a><br>​</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/11/02/%E8%A1%A8%E6%A0%BC%20&&%20%E8%A1%A8%E5%8D%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/11/02/%E8%A1%A8%E6%A0%BC%20&&%20%E8%A1%A8%E5%8D%95/" class="post-title-link" itemprop="url">表格 && 表单</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-11-02 11:13:15" itemprop="dateCreated datePublished" datetime="2021-11-02T11:13:15+08:00">2021-11-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:03" itemprop="dateModified" datetime="2022-02-14T19:41:03+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><p>后端只给某一页数据，通过分页器控制页数。但展示效果不够完美，全选操作也需要分页进行。<br>​</p>
<h3 id="虚拟滚动"><a href="#虚拟滚动" class="headerlink" title="虚拟滚动"></a>虚拟滚动</h3><h4 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h4><p>当内存缓存了上万条数据，渲染、dom 操作的时候会触发回流，造成卡顿。所以采用虚拟列表来分段展示数据，每次只加载可视区域（一页）的报表数据，滚动一定距离触发翻页再渲染下一页。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1635842366173-b9b27d70-d441-43b8-aec1-a41abbefb7ad.webp#clientId=u0af5c4d5-b0b6-4&from=paste&id=ud47b06de&margin=%5Bobject%20Object%5D&originHeight=1070&originWidth=1954&originalType=url%E2%88%B6=1&status=done&style=none&taskId=u0120e1b1-b4e6-40ed-a7d5-b9a0cee51cd"><br>固定好每行的高度，通过数据长度计算出整体列表高度。除实际渲染数据部分外，使用 margin|padding 来撑开列表。获取屏幕高度计算出可视化窗口区域的大小，进一步得出每次渲染数据数量。</p>
<p>监听视窗滚动事件，通过滚动高度计算出现在应该显示的数据区间，slice 后渲染出该区间数据，并缓存区间起始位置。（可节流控制频率）<br>​</p>
<p>也可以在监听之后使用 transform 来移动可视区域到视窗中（不会引起 Reflow 和 Repaint）</p>
<h4 id="数据管理"><a href="#数据管理" class="headerlink" title="数据管理"></a>数据管理</h4><p>如果数据流足够大，可以考虑将数据存放在 indexedDB 中<br>数据的预处理放在 webworker 中进行，避免阻塞主线程<br>如果是响应式数据且数据量不大，还是可以直接在内存中处理</p>
<h3 id="请求分片"><a href="#请求分片" class="headerlink" title="请求分片"></a>请求分片</h3><p>有些表格数据的展示依赖异步请求获取进一步信息，自然不可能在初始化的时候一口气批量获取（卡顿以及限频），最好是懒加载请求当前视窗展示的数据。<br>通过监听滚动高度的变化，计算出当前展示行，然后请求对应数据。如果请求多，为了避免修改对应数据造成的重绘或回流，可以缓存起来，等所有请求完成之后一次性修改数据。</p>
<hr>
<h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><h3 id="基于配置"><a href="#基于配置" class="headerlink" title="基于配置"></a>基于配置</h3><p>公司的业务不会停下，需求必然要跟着业务而不断演化，一个看似简单的页面表单也会变得越来越臃肿。当表单中出现联动的需求，或者跨行之间发生制约关系时，表单代码的复杂度就会上升。随着业务需求的演变，如果代码处理的不好，会变得越来越难维护。<br>理想状态下，可以用如下的 JSON 结构来定义一个表单。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1635823173430-8941e0fe-0875-48cc-bf43-bdbbb6f635a9.png#clientId=u5773eb69-ffd0-4&from=paste&id=u54a5a336&margin=%5Bobject%20Object%5D&name=image.png&originHeight=396&originWidth=659&originalType=url%E2%88%B6=1&size=155484&status=done&style=none&taskId=ud93d7c59-216e-4d5a-b093-934e234c401" alt="image.png"></p>
<h3 id="状态联动"><a href="#状态联动" class="headerlink" title="状态联动"></a>状态联动</h3><p>经常用 v-if 以及各种枚举值来处理联动，模板中又耦合其他逻辑，很难维护。使用 JSON 和 v-if，在配置型表单中也可以尝试条件渲染、动态范围（$watch 监听？）、动态赋值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 条件渲染</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;生效日期&#x27;</span>,</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;range&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;dates&#x27;</span>,</span><br><span class="line">    <span class="title function_">ifRender</span>(<span class="params">form</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> form.<span class="property">instant</span> == <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line"><span class="comment">// 动态范围</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;活动类型&#x27;</span>,</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;act_type&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;radio&#x27;</span>,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">      <span class="attr">options</span>: &#123; <span class="number">1</span>: <span class="string">&#x27;拉新&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;冲单&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;回馈&#x27;</span> &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;生效方式&#x27;</span>,</span><br><span class="line">    <span class="attr">key</span>: <span class="string">&#x27;effect_type&#x27;</span>,</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;radio&#x27;</span>,</span><br><span class="line">    <span class="title function_">props</span>(<span class="params">form</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> map = &#123; <span class="number">1</span>: <span class="string">&#x27;立即&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;按时间&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;按条件&#x27;</span> &#125;;</span><br><span class="line">      <span class="keyword">if</span> (form.<span class="property">act_type</span> === <span class="number">3</span>) &#123;</span><br><span class="line">        <span class="keyword">delete</span> map[<span class="number">3</span>];</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> &#123; <span class="attr">options</span>: map &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">     &#123;</span><br><span class="line">      <span class="attr">title</span>: <span class="string">&#x27;生效方式&#x27;</span>,</span><br><span class="line">      <span class="attr">key</span>: <span class="string">&#x27;effect_type&#x27;</span>,</span><br><span class="line">      <span class="attr">type</span>: <span class="string">&#x27;radio&#x27;</span>,</span><br><span class="line">      <span class="title function_">props</span>(<span class="params">form</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> value;</span><br><span class="line">        <span class="keyword">const</span> map = &#123; <span class="number">1</span>: <span class="string">&#x27;立即&#x27;</span>, <span class="number">2</span>: <span class="string">&#x27;按时间&#x27;</span>, <span class="number">3</span>: <span class="string">&#x27;按条件&#x27;</span> &#125;;</span><br><span class="line">        <span class="keyword">if</span> (form.<span class="property">act_type</span> === <span class="number">3</span>) &#123;</span><br><span class="line">          value = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">          <span class="attr">value</span>: value,</span><br><span class="line">          <span class="attr">options</span>: map</span><br><span class="line">        &#125;;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<h3 id="副作用联动"><a href="#副作用联动" class="headerlink" title="副作用联动"></a>副作用联动</h3><p>使用 observable 的思想进行联动的处理<br>应用状态，服务端数据状态，页面 URL，某个字段 UI 组件内部数据，当前字段自身的其他数据状态，某些特殊异步事件</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>扩展自定义组件、渲染自定义模板（render 函数）、生命周期、数据校验<br>​</p>
<h2 id="数据管理-1"><a href="#数据管理-1" class="headerlink" title="数据管理"></a>数据管理</h2><p>输入数据 表单数据 输出数据直接往往结构不一样，需要经过转换，尤其是枚举值的转换。<br>可以约定好格式，使用模板对象来转换结构<br>​</p>
<h2 id="性能问题"><a href="#性能问题" class="headerlink" title="性能问题"></a>性能问题</h2><p>vue 好像不太有这方面的问题</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6990596611189506062">https://juejin.cn/post/6990596611189506062</a><br><a target="_blank" rel="noopener" href="https://github.com/tangbc/vue-virtual-scroll-list">https://github.com/tangbc/vue-virtual-scroll-list</a><br><a target="_blank" rel="noopener" href="https://github.com/CatcherInSky/Virtual-Scroll-Table">https://github.com/CatcherInSky/Virtual-Scroll-Table</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/53455289">https://zhuanlan.zhihu.com/p/53455289</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/53455289">https://zhuanlan.zhihu.com/p/53455289</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6995334008603148295">https://juejin.cn/post/6995334008603148295</a><br><a target="_blank" rel="noopener" href="https://v2.formilyjs.org/zh-CN/guide">https://v2.formilyjs.org/zh-CN/guide</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/48241645">https://zhuanlan.zhihu.com/p/48241645</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/10/28/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/28/%E5%87%BD%E6%95%B0%E5%BC%8F%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">函数式编程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-28 09:33:55" itemprop="dateCreated datePublished" datetime="2021-10-28T09:33:55+08:00">2021-10-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:03" itemprop="dateModified" datetime="2022-02-14T19:41:03+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>函数式编程是一种范式，指仅依赖输入完成自身逻辑的函数。<br>​</p>
<p><strong>数学函数</strong><br>在数学中，函数是一种定义域和值域之间的关系，每一个参数对应一个值。函数式编程也具有类似性质<br>​</p>
<h2 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h2><ul>
<li><strong>引用透明</strong>，对相同输入返回相同值</li>
<li>管道化链式调用；</li>
<li>惰性求值、惰性加载；</li>
<li>当作操作符操作，隐藏内部细节；</li>
<li>闭包和高阶函数</li>
<li>纯函数，不会改变任何外部环境的变量<ul>
<li>可并发，不依赖外部变量，可以不考虑锁和相互影响，并发执行</li>
<li>可替代，不改变外部变量，可以直接用结果替代</li>
<li>可缓存，相同输入每次运行结果相同</li>
<li>可测试，相同输入可以测试复现</li>
</ul>
</li>
</ul>
<p>但有时需要允许可控制的副作用共存：</p>
<ul>
<li>前端可能的副作用</li>
<li>更改全局状态</li>
<li>发送一个 http 请求</li>
<li>可变数据</li>
<li>打印/log</li>
<li>获取用户输入</li>
<li>DOM 查询</li>
<li>访问系统状态</li>
<li>在无法避免副作用的情况下，使用函子和单子来控制副作用，也包括错误的处理。</li>
<li>许多异步解决方案其实是函子的具体实现，比如 Promise 是一个 Monad</li>
</ul>
<h2 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h2><p>接受另一个函数作为参数的函数，并且/或者返回函数作为输出的函数称为高阶函数</p>
<h3 id="柯里化-currying"><a href="#柯里化-currying" class="headerlink" title="柯里化(currying)"></a>柯里化(currying)</h3><p>柯里化是把一个多参数函数转换为一个嵌套的一元函数的过程</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">add</span> = (<span class="params">x, y</span>) =&gt; x + y;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">addCurried</span> = (<span class="params">x</span>) =&gt; <span class="function">(<span class="params">y</span>) =&gt;</span> x + y;</span><br><span class="line"><span class="comment">// addCurried返回一个函数，x通过闭包捕获</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">curry</span> = (<span class="params">fn</span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 排除</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> fn !== <span class="string">&quot;function&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="title class_">Error</span>(<span class="string">&quot;No function provided&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 双重闭包，curry保存fn</span></span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">curriedFn</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="comment">// fn.length 是fn声明时规定的参数长度</span></span><br><span class="line">    <span class="keyword">if</span> (args.<span class="property">length</span> &lt; fn.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="comment">// 每次调用curriedFn保存已传参数</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="comment">// arguments 是匿名函数的传参, arguments用法要注意，箭头函数没有arguments !!!</span></span><br><span class="line">        <span class="comment">// concat来拼接参数</span></span><br><span class="line">        <span class="keyword">return</span> curriedFn.<span class="title function_">apply</span>(<span class="literal">null</span>, args.<span class="title function_">concat</span>([].<span class="property">slice</span>.<span class="title function_">call</span>(<span class="variable language_">arguments</span>)));</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="comment">// 箭头函数写成这样</span></span><br><span class="line">      <span class="keyword">return</span> <span class="function">(<span class="params">...brgs</span>) =&gt;</span> curriedFn.<span class="title function_">apply</span>(<span class="literal">null</span>, [...args, ...brgs]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果长度符合，执行fn函数</span></span><br><span class="line">    <span class="comment">// apply null来修正fn中this的指向</span></span><br><span class="line">    <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="literal">null</span>, args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">curry</span>(<span class="params">fn</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> <span class="title function_">cb</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> args.<span class="property">length</span> &lt; fn.<span class="property">length</span></span><br><span class="line">      ? <span class="function">(<span class="params">...brgs</span>) =&gt;</span> cb.<span class="title function_">apply</span>(<span class="literal">null</span>, [...args, ...brgs])</span><br><span class="line">      : fn.<span class="title function_">apply</span>(<span class="literal">null</span>, args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以去除许多函数调用中的样板代码</p>
<p>一般在最后的参数接受数据</p>
<h3 id="偏函数-partial-application"><a href="#偏函数-partial-application" class="headerlink" title="偏函数(partial application)"></a>偏函数(partial application)</h3><p>固定多元函数的部分参数，并返回一个可以接受剩余部分参数的函数的转换过程。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> partial = <span class="keyword">function</span> (<span class="params">fn, ...partialArgs</span>) &#123;</span><br><span class="line">  <span class="comment">// 避免覆盖partialArgs</span></span><br><span class="line">  <span class="keyword">let</span> args = partialArgs;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">function</span> (<span class="params">...fullArguments</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> arg = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.<span class="property">length</span> &amp;&amp; arg &lt; fullArguments.<span class="property">length</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">if</span> (args[i] === <span class="literal">undefined</span>) &#123;</span><br><span class="line">        args[i] = fullArguments[arg++];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fn.<span class="title function_">apply</span>(<span class="literal">null</span>, args);</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="管道和组合"><a href="#管道和组合" class="headerlink" title="管道和组合"></a>管道和组合</h2><p>每个函数的输出可以是另一个尚未知的函数的输入,可以通过函数的管道和组合来完成复杂任务</p>
<p>可以使用 partial 函数将不同参数数量的函数组合在一起</p>
<h3 id="函数式组合（composition）"><a href="#函数式组合（composition）" class="headerlink" title="函数式组合（composition）"></a>函数式组合（composition）</h3><p>后进先出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">compose</span> =</span><br><span class="line">  (<span class="params">...fns</span>) =&gt;</span><br><span class="line">  <span class="function">(<span class="params">value</span>) =&gt;</span></span><br><span class="line">    fns.<span class="title function_">reverse</span>().<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> <span class="title function_">cur</span>(acc), value);</span><br></pre></td></tr></table></figure>

<h3 id="管道-序列（pipeline-seequenece）"><a href="#管道-序列（pipeline-seequenece）" class="headerlink" title="管道|序列（pipeline|seequenece）"></a>管道|序列（pipeline|seequenece）</h3><p>先进先出</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">pipe</span> =</span><br><span class="line">  (<span class="params">...fns</span>) =&gt;</span><br><span class="line">  <span class="function">(<span class="params">value</span>) =&gt;</span></span><br><span class="line">    fns.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, cur</span>) =&gt;</span> <span class="title function_">cur</span>(acc), value);</span><br></pre></td></tr></table></figure>

<h2 id="函子（Functor）"><a href="#函子（Functor）" class="headerlink" title="函子（Functor）"></a>函子（Functor）</h2><p>定义：函子是一个普通对象，它实现了 map 函数，在遍历每个对象值的时候生成一个新对象</p>
<p>简单来说，函子是值的容器<br>​</p>
<p>将两个范畴关联起来的数据类型成为函子。函子也是基本的运算单位和功能单位。任何具有 map 方法的数据结构，都可以当作函子的实现。函数式编程一般约定，函子有一个 of 方法，用来生成新的容器。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Functor</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">val</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">val</span> = val;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">of</span> = <span class="function">(<span class="params">val</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Functor</span>(val);</span><br><span class="line">  map = <span class="function">(<span class="params">f</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">of</span>(<span class="title function_">f</span>(<span class="variable language_">this</span>.<span class="property">val</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>​</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1635408120771-b1ed07a2-83cc-4594-b280-6f5be8f3cd4a.png#clientId=ua17c1baa-7243-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=uc4edb44e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=326&originWidth=720&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=269169&status=done&style=none&taskId=ud20e18af-94e9-4fca-8547-57794e79daf&title=" alt="image.png"></p>
<p>b = a.map(f)<br>f 是 a 和 b 之间关系的映射<br>函子来进行链式调用也很方便。<br>​</p>
<p>Functor 还要满足一些条件：</p>
<ul>
<li>单元律：a.map(x =&gt; x) === a</li>
<li>保存原有数据结构（可组合）：a.map(x =&gt; f(g(x))) === a.map(g).map(f)</li>
<li>提供接口往里面塞值：Functor.of</li>
</ul>
<p>​</p>
<h3 id="Maybe"><a href="#Maybe" class="headerlink" title="Maybe"></a>Maybe</h3><p>提前检查是否有值避免报错，也可以为鉴定值是否符合某种类型。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Maybe</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Functor</span> &#123;</span><br><span class="line">  isNothing = <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">val</span> === <span class="literal">null</span> || <span class="variable language_">this</span>.<span class="property">val</span> === <span class="literal">undefined</span>;</span><br><span class="line">  map = <span class="function">(<span class="params">f</span>) =&gt;</span> (<span class="variable language_">this</span>.<span class="title function_">isNothing</span>() ? <span class="variable language_">this</span>.<span class="title function_">of</span>(<span class="literal">null</span>) : <span class="variable language_">this</span>.<span class="title function_">of</span>(<span class="title function_">f</span>(<span class="variable language_">this</span>.<span class="property">val</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Either"><a href="#Either" class="headerlink" title="Either"></a>Either</h3><p>解决拓展分支的问题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 保存错误信息，对错误信息进行任何处理返回的都是错误信息本身</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Nothing</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Functor</span> &#123;</span><br><span class="line"> map = <span class="function">() =&gt;</span> <span class="variable language_">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Either</span> = &#123;</span><br><span class="line"> <span class="title class_">Some</span>： <span class="title class_">Functor</span>,</span><br><span class="line">  <span class="title class_">Nothing</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Pointed"><a href="#Pointed" class="headerlink" title="Pointed"></a>Pointed</h3><p>上面两种是对 map 函数的修改，也可以对 of 进行修改，使得输入按照一定的规则进行改造，比如<code>Array.of</code>。</p>
<h3 id="Monad"><a href="#Monad" class="headerlink" title="Monad"></a>Monad</h3><p>Monad 概念最初来自于范畴论，后来引入进函数式编程语言，由函数式编程发扬光大，渐渐渗透到其他主流语言中。<br>在函子的链式调用中，加入返回值经过某种程度的封装成了数据类型，如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">a</span>: <span class="title class_">Functor</span> = &#123;</span><br><span class="line"> <span class="attr">value</span>: <span class="attr">b</span>: <span class="title class_">Functor</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>普通的 map 函数只能加工值，而不能加工数据类型，而我们可以创造一种函数，他的<strong>输入和输出都是数据类型</strong>。以下讨论主要为函数。把这些数据类型连起来的运算，叫做 Monad。<br>这个图解更易懂些：<a target="_blank" rel="noopener" href="https://ruanyifeng.com/blog/2015/07/monad.html">https://ruanyifeng.com/blog/2015/07/monad.html</a><br>Monoid 可以简单定义如下：</p>
<ul>
<li>它是一个集合 S</li>
<li>S 的元素之间有一个二元运算 x，运算的结果也属于 S：S a x S b –&gt; S c</li>
<li>存在一个特殊元素 e，使得 S 中的任意元素与 e 运算，都返回此元素本身：S e x S m –&gt; S m</li>
</ul>
<p>​</p>
<h4 id="Effect"><a href="#Effect" class="headerlink" title="Effect"></a>Effect</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Effect</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">f</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">f</span> = f;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 跟Functor不同，Functor.of的传参类型跟constructor一致，这个是将值转化成函数</span></span><br><span class="line">  <span class="keyword">of</span> = <span class="function">(<span class="params">value</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Effect</span>(<span class="function">() =&gt;</span> value);</span><br><span class="line"></span><br><span class="line">  map = <span class="function">(<span class="params">g</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Effect</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="title function_">g</span>(<span class="variable language_">this</span>.<span class="title function_">f</span>(x)));</span><br><span class="line"></span><br><span class="line">  runWith = <span class="function">(<span class="params">x</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">f</span>(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样的函子在调用之前都是纯函数，可以随意组合和 map</p>
<h4 id="Applicative"><a href="#Applicative" class="headerlink" title="Applicative"></a>Applicative</h4><p>Effect 函数把非纯操作都放进了一个容器里面，这样子做了之后，如果要对两个独立非纯操作的结果进行运算，就会很麻烦。<br>比如，我们在 window 全局读取两个值 x, y, 并将读取结果求和</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> <span class="title class_">Effect</span>().<span class="title function_">of</span>(<span class="variable language_">window</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> xFromWindow = win.<span class="title function_">map</span>(<span class="function">(<span class="params">g</span>) =&gt;</span> g.<span class="property">x</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> yFromWindow = win.<span class="title function_">map</span>(<span class="function">(<span class="params">g</span>) =&gt;</span> g.<span class="property">y</span>);</span><br><span class="line"><span class="comment">// 函子由类型转化为值进行相加</span></span><br><span class="line">xFromWindow.<span class="title function_">runWith</span>() + yFromWindow.<span class="title function_">runWith</span>();</span><br></pre></td></tr></table></figure>

<p>我们添加一个方法方便两个容器内层的值进行计算</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Applicative</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">f</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">f</span> = f;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">of</span> = <span class="function">(<span class="params">value</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Applicative</span>(<span class="function">() =&gt;</span> value);</span><br><span class="line"></span><br><span class="line">  map = <span class="function">(<span class="params">g</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Applicative</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="title function_">g</span>(<span class="variable language_">this</span>.<span class="title function_">f</span>(x)));</span><br><span class="line"></span><br><span class="line">  runWith = <span class="function">(<span class="params">x</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">f</span>(x);</span><br><span class="line">  <span class="comment">// 其他函子</span></span><br><span class="line">  ap = <span class="function">(<span class="params">other</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Applicative</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> other.<span class="title function_">map</span>(<span class="variable language_">this</span>.<span class="title function_">f</span>(x)).<span class="title function_">runWith</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相加的时候</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> <span class="title class_">Applicative</span>().<span class="title function_">of</span>(<span class="variable language_">window</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> xFromWindow = win.<span class="title function_">map</span>(<span class="function">(<span class="params">g</span>) =&gt;</span> g.<span class="property">x</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> yFromWindow = win.<span class="title function_">map</span>(<span class="function">(<span class="params">g</span>) =&gt;</span> g.<span class="property">y</span>);</span><br><span class="line"></span><br><span class="line">xFromWindow <span class="comment">// () =&gt; window.x</span></span><br><span class="line">  <span class="comment">// 科里化函数</span></span><br><span class="line">  .<span class="title function_">map</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="function">(<span class="params">y</span>) =&gt;</span> x + y) <span class="comment">// y =&gt; window.x + y</span></span><br><span class="line">  .<span class="title function_">ap</span>(yFromWindow) <span class="comment">// () =&gt; yFromWindow.map(y =&gt; window.x + y).runWith()</span></span><br><span class="line">  <span class="comment">// () =&gt; (() =&gt; window.x + window.y)()</span></span><br><span class="line">  .<span class="title function_">runWith</span>(); <span class="comment">// (() =&gt; window.x + window.y)()</span></span><br><span class="line"><span class="comment">// 在runWith之前保留了类型</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 简化为</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">liftA2</span> = (<span class="params">f, m1, m2</span>) =&gt; m1.<span class="title function_">map</span>(f).<span class="title function_">ap</span>(m2);</span><br><span class="line"><span class="title function_">liftA2</span>(add, xFromWindow, yFromWindow).<span class="title function_">runWith</span>();</span><br></pre></td></tr></table></figure>

<p>新增 ap 方法之后的 Effect 函数除了是 Functor，还是 Applicative Functor<br>Applicative 是介于 Functor 和 Monad 之间的数据类型，Applicative 要满足下面这些条件：</p>
<ul>
<li>同一律（Identity）: A.of(x =&gt; x).ap(v) === v</li>
<li>同态（Homomorphism）: A.of(f).ap(A.of(x)) === A.of(f(x))</li>
<li>交换律（Interchange）: u.ap(A.of(y)) === A.of(f =&gt; f(y)).ap(u)</li>
</ul>
<p>​</p>
<h4 id="Monad-1"><a href="#Monad-1" class="headerlink" title="Monad"></a>Monad</h4><p>Monad 函子往往含有 chain 方法。拥有副作用的操作封装在一层函子里，调用时使用 chain 解开。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Monad</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">f</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">f</span> = f;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">of</span> = <span class="function">(<span class="params">value</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Monad</span>(<span class="function">() =&gt;</span> value);</span><br><span class="line">  map = <span class="function">(<span class="params">g</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Monad</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> <span class="title function_">g</span>(<span class="variable language_">this</span>.<span class="title function_">f</span>(x)));</span><br><span class="line">  runWith = <span class="function">(<span class="params">x</span>) =&gt;</span> <span class="variable language_">this</span>.<span class="title function_">f</span>(x);</span><br><span class="line">  ap = <span class="function">(<span class="params">other</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Monad</span>(<span class="function">(<span class="params">x</span>) =&gt;</span> other.<span class="title function_">map</span>(<span class="variable language_">this</span>.<span class="title function_">f</span>(x)).<span class="title function_">runWith</span>());</span><br><span class="line"></span><br><span class="line">  chain = <span class="function">(<span class="params">g</span>) =&gt;</span> <span class="keyword">new</span> <span class="title class_">Monad</span>(f).<span class="title function_">map</span>(g).<span class="title function_">runWith</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设我们要从 window 全局读取配置信息，此配置信息提供目标 DOM 节点的类名 userEl；根据这个类名，我们定位 DOM 节点，取出内容，然后打印到控制台。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// DOM 读取和控制台打印的行为放进 Effect</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">$</span> = (<span class="params">s</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Monad</span>(<span class="function">() =&gt;</span> <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(s)); <span class="comment">// 拥有副作用，封装一层，调用时抹平</span></span><br><span class="line"><span class="comment">// const $ = s =&gt; document.querySelector(s);</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">log</span> = (<span class="params">s</span>) =&gt; <span class="keyword">new</span> <span class="title class_">Monad</span>(<span class="function">() =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(s)); <span class="comment">// 拥有副作用，封装一层，调用时抹平</span></span><br><span class="line"><span class="comment">// const log = s =&gt; console.log(s);</span></span><br><span class="line"><span class="comment">// 包装成函数结构</span></span><br><span class="line"><span class="keyword">const</span> win = <span class="keyword">new</span> <span class="title class_">Monad</span>().<span class="title function_">of</span>(<span class="variable language_">window</span>);</span><br><span class="line"></span><br><span class="line">win</span><br><span class="line">  .<span class="title function_">map</span>(<span class="function">(<span class="params">win</span>) =&gt;</span> win.<span class="property">userEl</span>)</span><br><span class="line">  .<span class="title function_">map</span>($)</span><br><span class="line">  .<span class="title function_">runWith</span>() <span class="comment">//由于上一个 map 里层也返回了 Effect，这里需要抹平一层</span></span><br><span class="line">  <span class="comment">// .chain($)</span></span><br><span class="line">  .<span class="title function_">map</span>(<span class="function">(<span class="params">e</span>) =&gt;</span> e.<span class="property">innerHTML</span>)</span><br><span class="line">  .<span class="title function_">map</span>(log)</span><br><span class="line">  .<span class="title function_">runWith</span>() <span class="comment">//由于上一个 map 里层也返回了 Effect，这里需要抹平一层</span></span><br><span class="line">  <span class="comment">// .chain(log)</span></span><br><span class="line">  .<span class="title function_">runWith</span>();</span><br></pre></td></tr></table></figure>

<p>Monad 要满足的一些定律如下：<br>​</p>
<ul>
<li>左单位（Left identity）: M.of(a).chain(f) === f(a)。 return 函数不会更改值，也不应更改 Monad 中的任何内容。 它可以表示为“return”=“mf = mf”。</li>
<li>右单位元（Right identity）: m.chain(M.of) === m。 return 函数不会改变值，它不应该改变 Monad 中的任何内容。 它可以表示为“mf”=“return = mf”</li>
<li>结合律（Associativity）: m.chain(f).chain(g) === m.chain(x =&gt; f(x).chain(g))</li>
</ul>
<p>​</p>
<p>还有许多范畴论的数学知识就等以后学了再补充吧。<br>​</p>
<h3 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h3><h4 id="Generator"><a href="#Generator" class="headerlink" title="Generator"></a>Generator</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;generator&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">gen</span>();</span><br><span class="line"><span class="comment">// gen &#123;[[GeneratorState]]: &#x27;suspended&#x27;, [[GeneratorReceiver]]: Window&#125;</span></span><br><span class="line">result.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">// &#123;value: &#x27;generator&#x27;, done: true&#125;</span></span><br><span class="line">result.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">// &#123;value: undefined, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>Generator 如同序列，一旦序列中的值被消费，你就不能再次消费它。<br>​</p>
<h4 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">gen</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&quot;first&quot;</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&quot;second&quot;</span>;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">&quot;third&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> result = <span class="title function_">gen</span>();</span><br><span class="line">result.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">// &#123;value: &#x27;first&#x27;, done: true&#125;</span></span><br><span class="line">result.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">// &#123;value: &#x27;second&#x27;, done: true&#125;</span></span><br></pre></td></tr></table></figure>

<p>​</p>
<h4 id="next"><a href="#next" class="headerlink" title="next"></a>next</h4><p>可以通过 next 往 yield 里传值</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span>* <span class="title function_">sayName</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> name = <span class="keyword">yield</span>; <span class="comment">// 第一次next暂停于此， 第二次next往yield传值</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> name = <span class="title function_">sayName</span>();</span><br><span class="line">name.<span class="title function_">next</span>();</span><br><span class="line">name.<span class="title function_">next</span>(<span class="string">&quot;Amy&quot;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h4><p>用 setTimeout 代替网络请求等异步操作，除非嵌套，否则很难安排两个操作的顺序</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">getDataOne</span> = (<span class="params">cb</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&quot;one&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">cb</span>(<span class="string">&quot;one&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&quot;one&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">getDataTwo</span> = (<span class="params">cb</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&quot;two&quot;</span>);</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">cb</span>(<span class="string">&quot;two&quot;</span>);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&quot;two&quot;</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="title function_">getDataOne</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data)); <span class="comment">// one: 1007.5419921875 ms</span></span><br><span class="line"><span class="title function_">getDataTwo</span>(<span class="function">(<span class="params">data</span>) =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data)); <span class="comment">// two: 1007.59814453125 ms</span></span><br></pre></td></tr></table></figure>

<p>回调函数 cb 改为 next 函数，使用异步来让两函数按顺序执行</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> generator;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">getDataOne</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> generator.<span class="title function_">next</span>(<span class="string">&quot;one&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">getDataTwo</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> generator.<span class="title function_">next</span>(<span class="string">&quot;two&quot;</span>), <span class="number">1000</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">function</span>* <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">time</span>(<span class="string">&quot;main&quot;</span>);</span><br><span class="line">  <span class="keyword">let</span> dataOne = <span class="keyword">yield</span> <span class="title function_">getDataOne</span>(); <span class="comment">// 在暂停之前调用了getDataOne函数</span></span><br><span class="line">  <span class="keyword">let</span> dataTwo = <span class="keyword">yield</span> <span class="title function_">getDataTwo</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(dataOne);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(dataTwo);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">timeEnd</span>(<span class="string">&quot;main&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">generator = <span class="title function_">main</span>();</span><br><span class="line">generator.<span class="title function_">next</span>();</span><br><span class="line"><span class="comment">// main: 2012.220947265625 ms</span></span><br></pre></td></tr></table></figure>

<p>​</p>
<h2 id="尾调用优化"><a href="#尾调用优化" class="headerlink" title="尾调用优化"></a>尾调用优化</h2><p>ES6 中函数比较有趣的变化有尾调用系统的引擎优化。尾调用是指函数作为另一个函数的最后一条语句被调用，就像这样</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">doSomething</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">doSomethingElse</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ES5 中在执行 doSomethingElse 函数的时候会新增一个栈帧，doSomething 对应的栈帧会被保留在内存中，当存在循环调用时就容易出现程序问题，比如<strong>栈溢出</strong>等不可预期的错误（递归超出）。<br><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1635407307377-23d7de97-4aa9-4595-84f3-6630f9bba57a.webp#clientId=ua17c1baa-7243-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=uaa574918&margin=%5Bobject%20Object%5D&originHeight=516&originWidth=1582&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u43cc5d41-5e90-45ce-b973-8a6e3d40a17&title="><br>ES6 中满足以下条件，尾调用不再创建新的栈帧，而是清除并重用当前栈帧：</p>
<ol>
<li>严格模式下。</li>
<li>尾调用不访问当前栈帧的变量（也就是说函数不是一个闭包）</li>
<li>在函数内部，尾调用是最后一条语句。</li>
<li>尾调用的结果作为函数值返回。</li>
</ol>
<p>​</p>
<p>在编码递归代码的时候，牢记尾调用的特点；在递归函数计算了足够大的情况下，尾调用将会大幅度优化程序性能。<br><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1635407316768-901796d6-9ed9-49d1-8283-042353ddd011.webp#clientId=ua17c1baa-7243-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=uccc0a925&margin=%5Bobject%20Object%5D&originHeight=648&originWidth=1582&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u85238c51-b089-4e2d-8a6c-79775c7a503&title="><br>尾递归是一种特殊的尾调用，即在尾部直接调用自身的递归函数。<br>​</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://ramda.cn/">https://ramda.cn/</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6956219172044931109">https://juejin.cn/post/6956219172044931109</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/260966706">https://zhuanlan.zhihu.com/p/260966706</a><br><a target="_blank" rel="noopener" href="https://book.douban.com/subject/30180100/">https://book.douban.com/subject/30180100/</a><br><a target="_blank" rel="noopener" href="https://ruanyifeng.com/blog/2015/07/monad.html">https://ruanyifeng.com/blog/2015/07/monad.html</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/56810671">https://zhuanlan.zhihu.com/p/56810671</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/10/25/Vite/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/10/25/Vite/" class="post-title-link" itemprop="url">Vite</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-10-25 16:10:53" itemprop="dateCreated datePublished" datetime="2021-10-25T16:10:53+08:00">2021-10-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:03" itemprop="dateModified" datetime="2022-02-14T19:41:03+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Vite 基于 ECMAScript 标准原生模块系统 ES Module 实现，利用浏览器去解析 imports，在服务器端按需编译返回，完全跳过了打包这个概念，所以启动速度特别快。解决了 webpack 冷启动时间过长、Webpack HMR 热更新反应速度慢的问题。<br>Vite 会在<strong>本地启动服务</strong>，当浏览器读取到整个 html 文件之后，会<strong>执行到 import 的时候</strong>才去向服务端发送对应模块的请求，Vite 内部进行<strong>模板解析</strong>，<strong>代码编译</strong>等解析成浏览器可以执行的 JS 文件返回到浏览器端，这里就是真正的按需加载，并且不会因为模块增多而变慢。</p>
<p>在生产环境打包和 webpack 类似会将所有文件进行编译打包到一起。对于代码切割的需求 Vite 采用的是原生的动态导入来实现的，所以打包结果只能支持现代浏览器，如果老版本浏览器需要使用可以引入 Polyfill。使用 Webpack 打包是因为浏览器环境并不支持模块化，还有就是模块文件会产生大量的 http 请求。在现代浏览器模块化已经被支持了，<strong>http2</strong>也解决了多文件请求的问题。<br>Vite 带来的好处是提升开发者在开发过程中的体验，web 开发服务器不需要等待可以立即启动，模块热更新几乎是实时的，所需的文件按需编译，避免编译用不到的文件，开箱即用，避免 loader 及 plugins 的配置。<br>Vite 的核心功能包括开启一个静态的 web 服务器，并且能够编译单文件组件，并且提供 HMR 功能。<br>当启动 vite 的时候首先会将当前项目目录作为静态服务器的根目录，静态服务器会拦截部分请求，当请求单文件的时候会实时编译，以及处理其他浏览器不能识别的模块，通过 websocket 实现 hmr。<br>​</p>
<p>缺点：<br>Vite 只对 npm 依赖进行预构建，对于用户编写的文件不进行预处理，而是通过浏览器支持的 ES Module 来进行按需读取，所以如果用户文件过多，且没有进行一定的 Code Spliting 等操作，首屏是非常慢的。<br>​</p>
<h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><h3 id="搭建静态测试服务器"><a href="#搭建静态测试服务器" class="headerlink" title="搭建静态测试服务器"></a>搭建静态测试服务器</h3><p>vite 内部使用的是 KOA 来实现静态服务器，vite2 改为 http 模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">Koa</span> = <span class="built_in">require</span>(<span class="string">&#x27;koa&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> send = <span class="built_in">require</span>(<span class="string">&#x27;koa-send&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="keyword">new</span> <span class="title class_">Koa</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改第三方模块路径</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (ctx.<span class="property">type</span> === <span class="string">&#x27;application/javascript&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> contents = <span class="keyword">await</span> <span class="title function_">stream2string</span>(ctx.<span class="property">body</span>);</span><br><span class="line">        <span class="comment">// 将body中导入的路径修改一下，重新赋值给body返回给浏览器</span></span><br><span class="line">        <span class="comment">// import vue from &#x27;vue&#x27;, 匹配到from &#x27;修改为from &#x27;@modules/</span></span><br><span class="line">        ctx.<span class="property">body</span> = contents.<span class="title function_">replace</span>(<span class="regexp">/(from\s+[&#x27;&quot;])(?![\.\/])/g</span>, <span class="string">&#x27;$1/@modules/&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 加载第三方模块</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="keyword">if</span> (ctx.<span class="property">path</span>.<span class="title function_">startsWith</span>(<span class="string">&#x27;/@modules/&#x27;</span>)) &#123;</span><br><span class="line">        <span class="comment">// 截取模块名称</span></span><br><span class="line">        <span class="keyword">const</span> moduleName = ctx.<span class="property">path</span>.<span class="title function_">substr</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// 找到模块路径</span></span><br><span class="line">        <span class="keyword">const</span> pkgPath = path.<span class="title function_">join</span>(process.<span class="title function_">pwd</span>(), <span class="string">&#x27;node_modules&#x27;</span>, moduleName, <span class="string">&#x27;package.json&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> pkg = <span class="built_in">require</span>(pkgPath);</span><br><span class="line">        <span class="comment">// 重新给ctx.path赋值，需要重新设置一个存在的路径，因为之前的路径是不存在的</span></span><br><span class="line">        ctx.<span class="property">path</span> = path.<span class="title function_">join</span>(<span class="string">&#x27;/node_modules&#x27;</span>, moduleName, pkg.<span class="property">module</span>);</span><br><span class="line">        <span class="comment">// 执行下一个中间件</span></span><br><span class="line">        awiat <span class="title function_">next</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 开启静态文件服务器</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">    <span class="comment">// 加载静态文件</span></span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">send</span>(ctx, ctx.<span class="property">path</span>, &#123; <span class="attr">root</span>: process.<span class="title function_">cwd</span>(), <span class="attr">index</span>: <span class="string">&#x27;index.html&#x27;</span>&#125;)</span><br><span class="line">    <span class="keyword">await</span> <span class="title function_">next</span>()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">5000</span>)</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;服务器已经启动 http://localhost:5000&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="处理第三方模块"><a href="#处理第三方模块" class="headerlink" title="处理第三方模块"></a>处理第三方模块</h3><p>当代码中使用了第三方模块，可以通过修改第三方模块的路径，给他一个标识<code>@modules</code>，然后再服务器中拿到这个标识来处理这个模块。<br>代码见上</p>
<h3 id="单文件组件处理"><a href="#单文件组件处理" class="headerlink" title="单文件组件处理"></a>单文件组件处理</h3><p>浏览器只能识别 js,css 等常用资源，所以其他类型的资源都需要在服务端处理。当请求单文件组件的时候需要在服务器将单文件组件编译成 js 模块返回给浏览器。当浏览器第一次请求文件(App.vue)的时候，服务器会把单文件组件编译成一个对象，先加载这个组件，然后再创建一个对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">Hello</span> <span class="keyword">from</span> <span class="string">&quot;./src/components/Hello.vue&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> __script = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;App&quot;</span>,</span><br><span class="line">  <span class="attr">components</span>: &#123;</span><br><span class="line">    <span class="title class_">Hello</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>接着再去加载入口文件，这次会告诉服务器编译一下这个单文件组件的模板，返回一个 render 函数。然后将 render 函数挂载到刚创建的组件选项对象上，最后导出选项对象。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; render <span class="keyword">as</span> __render &#125; <span class="keyword">from</span> <span class="string">&quot;/src/App.vue?type=template&quot;</span>;</span><br><span class="line">__script.<span class="property">rener</span> = __render;</span><br><span class="line">__script.<span class="property">__hmrId</span> = <span class="string">&quot;/src/App.vue&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> __script;</span><br></pre></td></tr></table></figure>

<p>也就是说 vite 会发送两次请求（两个 import，一个导入组件，一个导入入口 vue），第一次请求会编译单文件文件，第二次请求是编译单文件模板返回一个 render 函数。</p>
<h4 id="编译单文件选项"><a href="#编译单文件选项" class="headerlink" title="编译单文件选项"></a>编译单文件选项</h4><p>把单文件组件编译成一个选项，这里用中间件来实现。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理单文件组件</span></span><br><span class="line">app.<span class="title function_">use</span>(<span class="keyword">async</span> (ctx, next) =&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (ctx.<span class="property">path</span>.<span class="title function_">endsWith</span>(<span class="string">&quot;.vue&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// 获取响应文件内容，转换成字符串</span></span><br><span class="line">    <span class="keyword">const</span> contents = <span class="keyword">await</span> <span class="title function_">streamToString</span>(ctx.<span class="property">body</span>);</span><br><span class="line">    <span class="comment">// 编译文件内容</span></span><br><span class="line">    <span class="keyword">const</span> &#123; descriptor &#125; = compilerSFC.<span class="title function_">parse</span>(contents);</span><br><span class="line">    <span class="comment">// 定义状态码</span></span><br><span class="line">    <span class="keyword">let</span> code;</span><br><span class="line">    <span class="comment">// 不存在type就是第一次请求</span></span><br><span class="line">    <span class="keyword">if</span> (!ctx.<span class="property">query</span>.<span class="property">type</span>) &#123;</span><br><span class="line">      code = descriptor.<span class="property">script</span>.<span class="property">content</span>;</span><br><span class="line">      <span class="comment">// 这里的code格式是, 需要改造成我们前面贴出来的vite中的样子</span></span><br><span class="line">      <span class="comment">// import Hello from &#x27;./components/Hello.vue&#x27;</span></span><br><span class="line">      <span class="comment">// export default &#123;</span></span><br><span class="line">      <span class="comment">//      name: &#x27;App&#x27;,</span></span><br><span class="line">      <span class="comment">//      components: &#123;</span></span><br><span class="line">      <span class="comment">//          Hello</span></span><br><span class="line">      <span class="comment">//      &#125;</span></span><br><span class="line">      <span class="comment">//  &#125;</span></span><br><span class="line">      <span class="comment">// 改造code的格式，将export default 替换为const __script =</span></span><br><span class="line">      code = code.<span class="title function_">relace</span>(<span class="regexp">/export\s+default\s+/g</span>, <span class="string">&quot;const __script = &quot;</span>);</span><br><span class="line">      code += <span class="string">`</span></span><br><span class="line"><span class="string">                import &#123; render as __render &#125; from &#x27;<span class="subst">$&#123;ctx.path&#125;</span>?type=template&#x27;</span></span><br><span class="line"><span class="string">                __script.rener = __render</span></span><br><span class="line"><span class="string">                export default __script</span></span><br><span class="line"><span class="string">            `</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 设置浏览器响应头为js</span></span><br><span class="line">    ctx.<span class="property">type</span> = <span class="string">&quot;application/javascript&quot;</span>;</span><br><span class="line">    <span class="comment">// 将字符串转换成数据流传给下一个中间件。</span></span><br><span class="line">    ctx.<span class="property">body</span> = <span class="title function_">stringToStream</span>(code);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">await</span> <span class="title function_">next</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">stringToStream</span> = (<span class="params">text</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> stream = <span class="keyword">new</span> <span class="title class_">Readable</span>();</span><br><span class="line">  stream.<span class="title function_">push</span>(text);</span><br><span class="line">  stream.<span class="title function_">push</span>(<span class="literal">null</span>);</span><br><span class="line">  <span class="keyword">return</span> stream;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="单文件组件模板编译成-render-函数"><a href="#单文件组件模板编译成-render-函数" class="headerlink" title="单文件组件模板编译成 render 函数"></a>单文件组件模板编译成 render 函数</h4><p>第二次请求 url 会带上 type=template 参数，我们需要将单文件组件模板编译成 render 函数</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!ctx.<span class="property">query</span>.<span class="property">type</span>) &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (ctx.<span class="property">query</span>.<span class="property">type</span> === <span class="string">&#x27;template&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取编译后的对象 code就是render函数</span></span><br><span class="line">    <span class="keyword">const</span> templateRender = compilerSFC.<span class="title function_">compileTemplate</span>(&#123; <span class="attr">source</span>: descriptor.<span class="property">template</span>.<span class="property">content</span> &#125;)</span><br><span class="line">    <span class="comment">// 将render函数赋值给code返回给浏览器</span></span><br><span class="line">    code = templateRender.<span class="property">code</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="全部"><a href="#全部" class="headerlink" title="全部"></a>全部</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Readable</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;stream)</span></span><br><span class="line"><span class="string">const Koa = require(&#x27;</span>koa<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">const send = require(&#x27;</span>koa-send<span class="string">&#x27;)</span></span><br><span class="line"><span class="string">const compilerSFC = require(&#x27;</span>@vue/compiler-sfc<span class="string">&#x27;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const app = new Koa()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const stream2string = (stream) =&gt; &#123;</span></span><br><span class="line"><span class="string">    return new Promise((resolve, reject) =&gt; &#123;</span></span><br><span class="line"><span class="string">        const chunks = [];</span></span><br><span class="line"><span class="string">        stream.on(&#x27;</span>data<span class="string">&#x27;, chunk =&gt; &#123;chunks.push(chunk)&#125;)</span></span><br><span class="line"><span class="string">        stream.on(&#x27;</span>end<span class="string">&#x27;, () =&gt; &#123; resolve(Buffer.concat(chunks).toString(&#x27;</span>utf-<span class="number">8</span><span class="string">&#x27;))&#125;)</span></span><br><span class="line"><span class="string">        stream.on(&#x27;</span>error<span class="string">&#x27;, reject)</span></span><br><span class="line"><span class="string">    &#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">const stringToStream = text =&gt; &#123;</span></span><br><span class="line"><span class="string">    const stream = new Readable();</span></span><br><span class="line"><span class="string">    stream.push(text);</span></span><br><span class="line"><span class="string">    stream.push(null);</span></span><br><span class="line"><span class="string">    return stream;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 加载第三方模块</span></span><br><span class="line"><span class="string">app.use(async (ctx, next) =&gt; &#123;</span></span><br><span class="line"><span class="string">    if (ctx.path.startsWith(&#x27;</span>/@modules/<span class="string">&#x27;)) &#123;</span></span><br><span class="line"><span class="string">        // 截取模块名称</span></span><br><span class="line"><span class="string">        const moduleName = ctx.path.substr(10);</span></span><br><span class="line"><span class="string">        // 找到模块路径</span></span><br><span class="line"><span class="string">        const pkgPath = path.join(process.pwd(), &#x27;</span>node_modules<span class="string">&#x27;, moduleName, &#x27;</span>package.<span class="property">json</span><span class="string">&#x27;);</span></span><br><span class="line"><span class="string">        const pkg = require(pkgPath);</span></span><br><span class="line"><span class="string">        // 重新给ctx.path赋值，需要重新设置一个存在的路径，因为之前的路径是不存在的</span></span><br><span class="line"><span class="string">        ctx.path = path.join(&#x27;</span>/node_modules<span class="string">&#x27;, moduleName, pkg.module);</span></span><br><span class="line"><span class="string">        // 执行下一个中间件</span></span><br><span class="line"><span class="string">        awiat next();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 开启静态文件服务器</span></span><br><span class="line"><span class="string">app.use(async (ctx, next) =&gt; &#123;</span></span><br><span class="line"><span class="string">    // 加载静态文件</span></span><br><span class="line"><span class="string">    await send(ctx, ctx.path, &#123; root: process.cwd(), index: &#x27;</span>index.<span class="property">html</span><span class="string">&#x27;&#125;)</span></span><br><span class="line"><span class="string">    await next()</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 处理单文件组件</span></span><br><span class="line"><span class="string">app.use(async (ctx, next) =&gt; &#123;</span></span><br><span class="line"><span class="string">    if (ctx.path.endsWith(&#x27;</span>.<span class="property">vue</span><span class="string">&#x27;)) &#123;</span></span><br><span class="line"><span class="string">        // 获取响应文件内容，转换成字符串</span></span><br><span class="line"><span class="string">        const contents = await streamToString(ctx.body);</span></span><br><span class="line"><span class="string">        // 编译文件内容</span></span><br><span class="line"><span class="string">        const &#123; descriptor &#125; = compilerSFC.parse(contents);</span></span><br><span class="line"><span class="string">        // 定义状态码</span></span><br><span class="line"><span class="string">        let code;</span></span><br><span class="line"><span class="string">        // 不存在type就是第一次请求</span></span><br><span class="line"><span class="string">        if (!ctx.query.type) &#123;</span></span><br><span class="line"><span class="string">            code = descriptor.script.content;</span></span><br><span class="line"><span class="string">            // 这里的code格式是, 需要改造成我们前面贴出来的vite中的样子</span></span><br><span class="line"><span class="string">            // import Hello from &#x27;</span>./components/<span class="title class_">Hello</span>.<span class="property">vue</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">            // export default &#123;</span></span><br><span class="line"><span class="string">            //      name: &#x27;</span><span class="title class_">App</span><span class="string">&#x27;,</span></span><br><span class="line"><span class="string">            //      components: &#123;</span></span><br><span class="line"><span class="string">            //          Hello</span></span><br><span class="line"><span class="string">            //      &#125;</span></span><br><span class="line"><span class="string">            //  &#125;</span></span><br><span class="line"><span class="string">            // 改造code的格式，将export default 替换为const __script =</span></span><br><span class="line"><span class="string">            code = code.relace(/export\s+default\s+/g, &#x27;</span><span class="keyword">const</span> __script = <span class="string">&#x27;)</span></span><br><span class="line"><span class="string">            code += `</span></span><br><span class="line"><span class="string">                import &#123; render as __render &#125; from &#x27;</span>$&#123;ctx.<span class="property">path</span>&#125;?type=template<span class="string">&#x27;</span></span><br><span class="line"><span class="string">                __script.rener = __render</span></span><br><span class="line"><span class="string">                export default __script</span></span><br><span class="line"><span class="string">            `</span></span><br><span class="line"><span class="string">        &#125; else if (ctx.query.type === &#x27;</span>template<span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">            // 获取编译后的对象 code就是render函数</span></span><br><span class="line"><span class="string">            const templateRender = compilerSFC.compileTemplate(&#123; source: descriptor.template.content &#125;)</span></span><br><span class="line"><span class="string">            // 将render函数赋值给code返回给浏览器</span></span><br><span class="line"><span class="string">            code = templateRender.code</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        // 设置浏览器响应头为js</span></span><br><span class="line"><span class="string">        ctx.type = &#x27;</span>application/javascript<span class="string">&#x27;</span></span><br><span class="line"><span class="string">        // 将字符串转换成数据流传给下一个中间件。</span></span><br><span class="line"><span class="string">        ctx.body = stringToStream(code);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    await next()</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// 修改第三方模块路径</span></span><br><span class="line"><span class="string">app.use(async (ctx, next) =&gt; &#123;</span></span><br><span class="line"><span class="string">    if (ctx.type === &#x27;</span>application/javascript<span class="string">&#x27;) &#123;</span></span><br><span class="line"><span class="string">        const contents = await stream2string(ctx.body);</span></span><br><span class="line"><span class="string">        // 将body中导入的路径修改一下，重新赋值给body返回给浏览器</span></span><br><span class="line"><span class="string">        // import vue from &#x27;</span>vue<span class="string">&#x27;, 匹配到from &#x27;</span>修改为<span class="keyword">from</span> <span class="string">&#x27;@modules/</span></span><br><span class="line"><span class="string">        ctx.body = contents.replace(/(from\s+[&#x27;</span><span class="string">&quot;])(?![\.\/])/g, &#x27;$1/@modules/&#x27;).replace(/process\.env\.NODE_ENV/g, &#x27;&quot;</span>development<span class="string">&quot;&#x27;);</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">app.listen(5000)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">console.log(&#x27;服务器已经启动 http://localhost:5000&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://github.com/lxchuan12/vue-dev-server-analysis">https://github.com/lxchuan12/vue-dev-server-analysis</a><br><a target="_blank" rel="noopener" href="https://github.com/vuejs/vue-dev-server">https://github.com/vuejs/vue-dev-server</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6972369882469892127">https://juejin.cn/post/6972369882469892127</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://catcherinsky.github.io/2021/09/27/%E7%A7%BB%E5%8A%A8%E7%AB%AF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="CatcherInSky">
      <meta itemprop="description" content="CatcherInSky的前端知识库">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knowlegde Bases of CatcherInSky">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/09/27/%E7%A7%BB%E5%8A%A8%E7%AB%AF/" class="post-title-link" itemprop="url">移动端</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-09-27 11:34:05" itemprop="dateCreated datePublished" datetime="2021-09-27T11:34:05+08:00">2021-09-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-02-14 19:41:04" itemprop="dateModified" datetime="2022-02-14T19:41:04+08:00">2022-02-14</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><h3 id="单位"><a href="#单位" class="headerlink" title="单位"></a>单位</h3><h4 id="显示分辨率（Display-Resolution）"><a href="#显示分辨率（Display-Resolution）" class="headerlink" title="显示分辨率（Display Resolution）"></a>显示分辨率（Display Resolution）</h4><p>简称分辨率，显示器显示的物理像素个数，通常用每行像素数列乘每列像素数列，例如：1024×768<br>​</p>
<h4 id="逻辑分辨率"><a href="#逻辑分辨率" class="headerlink" title="逻辑分辨率"></a>逻辑分辨率</h4><p>逻辑像素的行乘列，在浏览器中，是 screan.width * screan.height。也可以在开发者工具-&gt;移动端调试的顶部看到。单位 pt。<br><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1632732193303-e0fd9a0c-c159-4236-9bed-8911ff737a23.webp#clientId=u4afbb619-9660-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u9ded6b1c&margin=%5Bobject%20Object%5D&originHeight=58&originWidth=810&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u03bd358e-a0d0-4b03-b05c-264a25ebbe7&title="><br>​</p>
<h4 id="物理像素（device-pixel）"><a href="#物理像素（device-pixel）" class="headerlink" title="物理像素（device pixel）"></a>物理像素（device pixel）</h4><p>分辨率相关，取决于硬件<br>​</p>
<h4 id="逻辑像素（Density-Independent-Pixels）"><a href="#逻辑像素（Density-Independent-Pixels）" class="headerlink" title="逻辑像素（Density-Independent Pixels）"></a>逻辑像素（Density-Independent Pixels）</h4><p>又称设备独立像素，单位是 px，指独立于设备的用于逻辑上衡量像素的单位，用来描述<strong>图片尺寸</strong>或者<strong>css 样式</strong>。<br>为了保持在密度不同的屏幕上同一个元素物理尺寸一致，需要一个跟设备和像素密度无关的逻辑像素单位来衡量。<br>​</p>
<h4 id="像素密度（Dots-Per-Inch）"><a href="#像素密度（Dots-Per-Inch）" class="headerlink" title="像素密度（Dots Per Inch）"></a>像素密度（Dots Per Inch）</h4><p>每英寸像素数目，标准 dpi 为 160 px/inch，对应下图 mdpi。相同物理尺寸的屏幕 DPI 越高，每个像素点越小，图像更精细。为了同一个 DOM 元素在不同设备上物理尺寸相同，计算逻辑像素的时候需要乘上相应比例。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1632730484160-bcfaff3e-57d5-4962-90f6-6bda741a0c55.png#clientId=u4afbb619-9660-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=273&id=u4c667d83&margin=%5Bobject%20Object%5D&originHeight=612&originWidth=709&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u42089862-6a3a-49ea-922e-cd0d16a63c8&title=&width=315.99310302734375"></p>
<h4 id="像素密度-PPI-（Pixels-Per-Inch）"><a href="#像素密度-PPI-（Pixels-Per-Inch）" class="headerlink" title="像素密度 PPI （Pixels Per Inch）"></a>像素密度 PPI （Pixels Per Inch）</h4><p>DPI 的一种，指手机设备屏幕每英寸对角线上所拥有的像素（pixel）数目，公式如下：<br><img src="https://cdn.nlark.com/yuque/__latex/96d5bfe3f368e5b8436102174c5f21b3.svg#card=math&code=PPI%20%3D%20%5Cfrac%7B%5Csqrt%7B%E6%AF%8F%E8%A1%8C%E5%83%8F%E7%B4%A0%E6%95%B0%5E2%2B%E6%AF%8F%E5%88%97%E5%83%8F%E7%B4%A0%E6%95%B0%5E2%7D%7D%7B%E5%B1%8F%E5%B9%95%E5%B0%BA%E5%AF%B8%7D&id=hRk3i"><br>PPI 越高，图像越清晰，一般大于 300PPI 人眼无法分辨各像素，把大于 300 的屏幕称为视网膜屏（retina）。<br>以 iPhone6 为例，屏幕的显示分辨率为 750 _ 1334，经过计算 PPI 为 326，属于 xhdpi 设备，dpr 为 2，所以在 iPhone6 的逻辑分辨率为 375 _ 667。<br>​</p>
<h4 id="设备像素缩放比（Device-Pixel-Ratio）"><a href="#设备像素缩放比（Device-Pixel-Ratio）" class="headerlink" title="设备像素缩放比（Device Pixel Ratio）"></a>设备像素缩放比（Device Pixel Ratio）</h4><p>在浏览器中常用 dpr 来计算物理像素和逻辑像素的关系，公式如下<br><img src="https://cdn.nlark.com/yuque/__latex/35ba60ba7fdb8404813ea32fdd52cbe0.svg#card=math&code=dip%20%3D%20dpr%20%5Ctimes%20dp&id=kGn0l"><br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1632714728696-de7ba0a5-0047-4d69-9bc7-c5a44aa9ab42.png#clientId=u6d450a47-d6e5-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=QtJOR&margin=%5Bobject%20Object%5D&name=image.png&originHeight=115&originWidth=567&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=42296&status=done&style=none&taskId=u2fe8f1c6-e643-48b6-ab61-a2e18ab970c&title=" alt="image.png"><br>面积上，假如 dpr 等于 2，一个逻辑像素由四个物理像素构成<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1632732675308-5f2efb8b-a47c-4646-ba2d-68cab5813fff.png#clientId=u4afbb619-9660-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u58762557&margin=%5Bobject%20Object%5D&name=image.png&originHeight=165&originWidth=498&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=46886&status=done&style=none&taskId=u3e2c6bf1-338b-4a1e-8352-1ed17ff4951&title=" alt="image.png"><br>以 iPhone6 为例，屏幕的显示分辨率为 750 _ 1334，dpr 为 2，逻辑分辨率为 375 _ 667。设计师在给图的时候常给的是显示分辨率的 750，而实现的时候需要除以 dpr 2 才能得到逻辑像素的单位。而更高倍的 dpr 超出了 retina 的范围，可以通过简单调整比例来适配。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1634545832119-923c8aea-1526-4e0e-bb28-4fff9ba8a6a8.png#clientId=uc1f700a0-5be0-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ue658f946&margin=%5Bobject%20Object%5D&originHeight=409&originWidth=742&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=uab73ce01-c128-4fb5-9b21-83391cc83c8&title="><br>​</p>
<p>​</p>
<h3 id="视口（viewport）"><a href="#视口（viewport）" class="headerlink" title="视口（viewport）"></a>视口（viewport）</h3><p>通俗的讲，移动设备上的 viewport 就是设备的屏幕上能用来显示我们的网页的那一块区域。移动设备上的浏览器都会把自己默认的 viewport 设为 980px 或 1024px。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1632735090392-1fdbcc33-3c6c-44d3-8efa-6357e3f682d2.png#clientId=u4afbb619-9660-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=TA9DF&margin=%5Bobject%20Object%5D&originHeight=93&originWidth=657&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u3097bc05-5cba-47e1-8a08-56f3ca4bca3&title="></p>
<p>​</p>
<h4 id="布局视口（layout-viewport）"><a href="#布局视口（layout-viewport）" class="headerlink" title="布局视口（layout viewport）"></a>布局视口（layout viewport）</h4><p>可通过<code>document.documentElement.client[Width/Height]</code> 查询。而 vh vw 是基于布局视口的单位。媒体查询也是基于视口宽高而定。<br><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1632732404864-aa2731c7-79cf-4f2b-8f3e-97a2af9d5514.webp#clientId=u4afbb619-9660-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=338&id=u893929f3&margin=%5Bobject%20Object%5D&originHeight=809&originWidth=1080&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u256e3c9c-6f30-44fb-8268-bd7f36ea409&title=&width=450.76043701171875"></p>
<h4 id="视觉视口（visual-viewport）"><a href="#视觉视口（visual-viewport）" class="headerlink" title="视觉视口（visual viewport）"></a>视觉视口（visual viewport）</h4><p>视觉视口是屏幕的可视部分，由<code>window.inner[Width/Height]</code> 所组成的区域，不包括屏幕键盘，缩放外的区域。视觉视口比布局视口相同或者更小，并且可以变化。当使用触屏双指缩放，当动态键盘在手机上弹出的时候，或者之前隐藏的地址栏变得可见的时候，visual viewport 缩小了，但是 layout viewport 却保持不变。<br>​</p>
<p><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1632732419026-82eba292-df36-4a37-b8a6-139ad6761ef7.webp#clientId=u4afbb619-9660-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=313&id=u585c73f4&margin=%5Bobject%20Object%5D&originHeight=809&originWidth=1080&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=ubec30074-0dbc-4b20-96a0-ec569352002&title=&width=417.76043701171875"></p>
<h4 id="理想视口（ideal-viewport）"><a href="#理想视口（ideal-viewport）" class="headerlink" title="理想视口（ideal viewport）"></a>理想视口（ideal viewport）</h4><p>iPhone6 宽度为 375px，理想视口也跟宽度一致<br>假如浏览器设置 viewport 为 980px 的话，浏览器会出现横向滚动条。<br>把 dpr 改成 1 来缩放页面，会让网页元素会变小而无法分辨。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在缩放级别为100%时，1单位的CSS的pixel是严格相等于1单位的设备pixel</span><br></pre></td></tr></table></figure>

<p>​</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span></span></span><br><span class="line"><span class="tag">  <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br></pre></td></tr></table></figure>

<p>这个标签可以将视口宽度与设备宽度对应，并设置初始缩放比，就是理想视口。<br>ideal viewport 的意义在于，无论在何种分辨率的屏幕下，那些针对 ideal viewport 而设计的网站，不需要用户手动缩放，也不需要出现横向滚动条，都可以完美的呈现给用户。</p>
<p>visual viewport = ideal viewport / scale<br>​</p>
<h2 id="适配"><a href="#适配" class="headerlink" title="适配"></a>适配</h2><h3 id="基本思路"><a href="#基本思路" class="headerlink" title="基本思路"></a>基本思路</h3><ul>
<li>选择一种尺寸作为设计和开发基准</li>
<li>定义一套适配规则，自动适配剩下的两种尺寸(其实不仅这两种，你懂的)</li>
<li>特殊适配效果给出设计效果</li>
</ul>
<p><strong>设计师常选择 iPhone6 作为基准设计尺寸，交付给前端的设计尺寸是按 750px * 1334px 为准(高度会随着内容多少而改变)。前端开发人员通过一套适配规则自动适配到其他的尺寸</strong></p>
<h3 id="方案"><a href="#方案" class="headerlink" title="方案"></a>方案</h3><h4 id="rem"><a href="#rem" class="headerlink" title="rem"></a>rem</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="property">documentElement</span>.<span class="property">style</span>.<span class="property">fontSize</span> = <span class="string">`<span class="subst">$&#123;</span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="language-javascript">    <span class="variable language_">document</span>.documentElement.clientWidth / <span class="number">7.5</span></span></span></span></span><br><span class="line"><span class="subst"><span class="string"><span class="language-javascript">  &#125;</span>px`</span>;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>布局视口等于理想视口后，假设以 750px 宽的设计图为标准的 html 标签的 font-size 为 100px，那么这个设计图总宽就有 7.5rem，所以 1rem = 100px。当布局视口为 375px 时，1rem = 50px。可以使用 scss 函数对 px 单位进行自动换算。<br>​</p>
<h4 id="flexible（动态-REM）"><a href="#flexible（动态-REM）" class="headerlink" title="flexible（动态 REM）"></a>flexible（动态 REM）</h4><p>Retina 屏将 viewport 缩放为 1 / dpr 最终产生的效果是，1px css 像素严格等于 1px 设备像素进而全局解决 1px 边框问题。在设定了布局视口与设备宽度一致后，采用 rem 为单位设置元素大小。对于不同屏幕，我们只需要动态修改根元素字体大小，元素大小就会同比例改变，从而做到页面的自动适配效果。通过 scss 函数对 px 单位进行自动换算。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> isAndroid = win.<span class="property">navigator</span>.<span class="property">appVersion</span>.<span class="title function_">match</span>(<span class="regexp">/android/gi</span>);</span><br><span class="line"><span class="keyword">var</span> isIPhone = win.<span class="property">navigator</span>.<span class="property">appVersion</span>.<span class="title function_">match</span>(<span class="regexp">/iphone/gi</span>);</span><br><span class="line"><span class="keyword">var</span> devicePixelRatio = win.<span class="property">devicePixelRatio</span>;</span><br><span class="line"><span class="keyword">var</span> drp, scale;</span><br><span class="line"><span class="keyword">if</span> (isIPhone) &#123;</span><br><span class="line">  <span class="keyword">if</span> (devicePixelRatio &gt;= <span class="number">3</span> &amp;&amp; (!dpr || dpr &gt;= <span class="number">3</span>)) &#123;</span><br><span class="line">    dpr = <span class="number">3</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (devicePixelRatio &gt;= <span class="number">2</span> &amp;&amp; (!dpr || dpr &gt;= <span class="number">2</span>)) &#123;</span><br><span class="line">    dpr = <span class="number">2</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    dpr = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 其他设备下，仍旧使用1倍的方案</span></span><br><span class="line">  dpr = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">scale = <span class="number">1</span> / dpr;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">`&lt;meta name=&quot;viewport&quot; content=&quot;initial-scale=<span class="subst">$&#123;scale&#125;</span>&quot;&gt;`</span>);</span><br></pre></td></tr></table></figure>

<h4 id="viewport"><a href="#viewport" class="headerlink" title="viewport"></a>viewport</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">const</span> scale = <span class="variable language_">window</span>.<span class="property">screen</span>.<span class="property">width</span> / <span class="number">750</span>;</span></span><br><span class="line"><span class="language-javascript">  <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="string">`&lt;meta name=&quot;viewport&quot; content=&quot;initial-scale=<span class="subst">$&#123;scale&#125;</span>&quot;&gt;`</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>直接缩放布局视口为视觉视口。因为 viewport 的设置是影响全局的，这样一来虽然可以直接将设计图量得的尺寸写到 css 上，但如果有一些需要地方不需要等比缩放而需要设置固定尺寸，比如要求在不同尺寸屏幕上显示固定大小的文字，或者你引进了一个库，里面的有样式你也不知道人家是按照怎样的适配方案进行适配的，那么到了你的项目里由于全局的 viewport 缩放，可能会影响到这个库的显示效果。</p>
<h4 id="vw-vh"><a href="#vw-vh" class="headerlink" title="vw/vh"></a>vw/vh</h4><p>大部分浏览器支持 vw vh 等单位后，使用 vw 来代替 rem 来进行开发。</p>
<ul>
<li>vw：是 Viewport’s width 的简写,1vw 等于 window.innerWidth 的 1%</li>
<li>vh：和 vw 类似，是 Viewport’s height 的简写，1vh 等于 window.innerHeihgt 的 1%</li>
<li>vmin：vmin 的值是当前 vw 和 vh 中较小的值</li>
<li>vmax：vmax 的值是当前 vw 和 vh 中较大的值</li>
</ul>
<p>流程：</p>
<ul>
<li>meta 标签设置 viewport 宽度为屏幕宽度；</li>
<li>开发环境配置 <a href="https://link.juejin.cn/?target=https://www.npmjs.com/package/postcss-px-to-viewport">postcss-px-to-viewport</a> 或者类似插件；</li>
<li>根据设计稿写样式，元素宽高直接取设计稿宽高即可，单位为 px，插件会将其转换为 vw；</li>
<li>段落文本也按照设计稿写，单位为 px，不需要转换为 vw；</li>
</ul>
<p>​</p>
<p>​</p>
<h4 id="响应式"><a href="#响应式" class="headerlink" title="响应式"></a>响应式</h4><p>通过媒体查询，在不同尺寸的屏幕下加载不同的样式文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">media</span>=<span class="string">&quot;(max-width: 500px)&quot;</span> <span class="attr">href</span>=<span class="string">&quot;mobile.css&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">media</span>=<span class="string">&quot;(min-width: 980px)&quot;</span> <span class="attr">href</span>=<span class="string">&quot;pc.css&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>适用于：</p>
<ul>
<li>不同尺寸 html 结构变化不大</li>
<li>布局有较大差别</li>
</ul>
<p>​</p>
<p>​</p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><h4 id="hashchange-与大图"><a href="#hashchange-与大图" class="headerlink" title="hashchange 与大图"></a>hashchange 与大图</h4><p>点击放大时，给图片用 a 标签包裹+href=”#XXX”，点击放大时触发 URL 添加，后退时返回原页面而不是原页面的上级页面，监听 hashchange 隐藏图片可解决</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;#imgSlider&quot;</span>&gt;触发大图&lt;/a&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 假设大图展示状态的hash为imgSlider</span></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;hashchange&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> re = <span class="regexp">/#imgSlider$/</span>;</span><br><span class="line">    <span class="keyword">if</span> (re.<span class="title function_">test</span>(e.<span class="property">oldURL</span>) &amp;&amp; !re.<span class="title function_">test</span>(e.<span class="property">newURL</span>)) &#123;</span><br><span class="line">      <span class="comment">// 假设imgSlider为大图展示组件对象</span></span><br><span class="line">      <span class="comment">// 隐藏大图</span></span><br><span class="line">      imgSlider.<span class="title function_">hide</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="click-touch-tap"><a href="#click-touch-tap" class="headerlink" title="click touch tap"></a>click touch tap</h4><p>移动端中，连续 click 的触发有 200ms ~ 300ms 的延迟<br>触摸事件，有 touchstart touchmove touchend touchcancel 参数是数组，代表多个手指<br>一般用于代替 click 事件，有 tap longTap singleTap doubleTap 四种之分<br>滑动事件，有 swipe swipeLeft swipeRight swipeUp swipeDown 五种之分<br>​</p>
<p>移动端，当用户点击屏幕时，会依次触发 touchstart，touchmove(0 次或多次)，touchend，mousemove，mousedown，mouseup，click。 touchmove 。只有当手指在屏幕发生移动的时候才会触发 touchmove 事件。在 touchstart ，touchmove 或者 touchend 事件中的任意一个调用 event.preventDefault，mouse 事件 以及 click 事件将不会触发。<br>​</p>
<p>​</p>
<h4 id="异形屏"><a href="#异形屏" class="headerlink" title="异形屏"></a>异形屏</h4><p><strong>苹果</strong><br>​</p>
<p>Apple 在发布 iPhone X 后引入了一个新概念：安全区域（Safe Area），安全区域指屏幕内不受圆角、刘海、底部小黑条等元素影响的可视窗口。如下图：<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1634727278702-dd082cef-7f5c-4caa-a8f8-79c0116f6265.png#clientId=u285efd4d-d994-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u412417d9&margin=%5Bobject%20Object%5D&name=image.png&originHeight=948&originWidth=1913&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=472760&status=done&style=none&taskId=u53382fe8-0524-4f4e-ba98-c4b8ba29753&title=" alt="image.png"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta name=<span class="string">&quot;viewport&quot;</span> content=<span class="string">&quot;viewport-fit=cover&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"> <span class="selector-class">.safe-area</span> &#123;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding-top</span>: <span class="built_in">env</span>(safe-area-inset-top);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding-left</span>: <span class="built_in">env</span>(safe-area-inset-left);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding-right</span>: <span class="built_in">env</span>(safe-area-inset-right);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml">  <span class="attribute">padding-bottom</span>: <span class="built_in">env</span>(safe-area-inset-bottom);</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"> &#125;</span></span></span><br><span class="line"><span class="language-css"><span class="language-xml"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p><strong>安卓</strong><br>​</p>
<ol>
<li>保留顶部安全高度，或者保留导航栏；</li>
<li>App 通过 jsbridge 告诉 H5 需要留出多少距离。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">bridge.getStatusBarHeight((&#123; height &#125;) =&gt; &#123;</span><br><span class="line">  <span class="type">const</span> <span class="variable">h</span> <span class="operator">=</span> height / window.devicePixelRatio; <span class="comment">// 根据需要转换成 CSS 中的 px 高度</span></span><br><span class="line">  <span class="type">const</span> <span class="variable">root</span> <span class="operator">=</span> document.documentElement;</span><br><span class="line">  root.style.setProperty(<span class="string">&#x27;--safe-top&#x27;</span>, `$&#123;h&#125;px`);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="1px-问题"><a href="#1px-问题" class="headerlink" title="1px 问题"></a>1px 问题</h4><p>iPhone6 屏幕像素 375px，分辨率宽度为 750，设计师设计稿也是 750px。在 retina 屏幕中，dpr 为 2，设计稿中的 1px，相当于 1 物理像素，0.5 逻辑像素。css 不支持 0.5px，所以只能通过缩放实现<br>推荐使用伪元素 + transform</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.border-1px &#123;</span><br><span class="line">  position: relative;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">.border-1px::after &#123;</span><br><span class="line">  content: <span class="string">&#x27; &#x27;</span>;</span><br><span class="line">  position: absolute;</span><br><span class="line">  width: <span class="number">200</span>%;</span><br><span class="line">  height: <span class="number">200</span>%;</span><br><span class="line">  border: 1px solid #ddd;</span><br><span class="line">  pointer-events: none;</span><br><span class="line">  transform: scale(<span class="number">0.5</span>);</span><br><span class="line">  transform-origin: <span class="number">0</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="图片"><a href="#图片" class="headerlink" title="图片"></a>图片</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">selector &#123; background-image: url(no-image-set.png); background:</span><br><span class="line">image-set(url(foo-lowres.png) 1x,url(foo-highres.png) 2x) center; &#125;</span><br></pre></td></tr></table></figure>

<p>image-set 的语法，类似于不同的文本，图像也会显示成不同的：</p>
<ol>
<li>不支持 image-set：在不支持 image-set 的浏览器下，他会支持 background-image 图像，也就是说不支持 image-set 的浏览器下，他们解析 background-image 中的背景图像；</li>
<li>支持 image-set：如果你的浏览器支持 image-sete，而且是普通显屏下，此时浏览器会选择 image-set 中的@1x 背景图像；</li>
<li>Retina 屏幕下的 image-set：如果你的浏览器支持 image-set，而且是在 Retina 屏幕下，此时浏览器会选择 image-set 中的@2x 背景图像。</li>
</ol>
<h4 id="重力"><a href="#重力" class="headerlink" title="重力"></a>重力</h4><p>deviceMotionEvent 是 HTML5 新增的事件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">if (window.DeviceMotionEvent) &#123;</span><br><span class="line">window.addEventListener(&#x27;devicemotion&#x27;,deviceMotionHandler, false); &#125; var speed</span><br><span class="line">= 30;//speed var x = y = z = lastX = lastY = lastZ = 0; function</span><br><span class="line">deviceMotionHandler(eventData) &#123; var acceleration</span><br><span class="line">=event.accelerationIncludingGravity; x = acceleration.x; y = acceleration.y; z =</span><br><span class="line">acceleration.z; if(Math.abs(x-lastX) &gt; speed || Math.abs(y-lastY) &gt; speed ||</span><br><span class="line">Math.abs(z-lastZ) &gt; speed) &#123; //简单的摇一摇触发代码 alert(1); &#125; lastX = x; lastY</span><br><span class="line">= y; lastZ = z; &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;onorientationchange&quot;</span> <span class="keyword">in</span> <span class="variable language_">window</span> ? <span class="string">&quot;orientationchange&quot;</span> : <span class="string">&quot;resize&quot;</span>,</span><br><span class="line">  <span class="function">() =&gt;</span> &#123;&#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="屏幕旋转"><a href="#屏幕旋转" class="headerlink" title="屏幕旋转"></a>屏幕旋转</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/* 竖屏 */ @media all and (orientation: portrait) &#123; /* 自定义样式 */ &#125; /* 横屏</span><br><span class="line">*/ @media all and (orientation: landscape) &#123; /* 自定义样式 */ &#125;</span><br></pre></td></tr></table></figure>

<h4 id="触屏"><a href="#触屏" class="headerlink" title="触屏"></a>触屏</h4><p>touchstart -&gt; touchmove -&gt; touchend -&gt;touchcancel<br>​</p>
<p>​</p>
<h4 id="点击穿透（单击延迟）"><a href="#点击穿透（单击延迟）" class="headerlink" title="点击穿透（单击延迟）"></a>点击穿透（单击延迟）</h4><p>click 事件因为要等待双击确认，会有 300ms 的延迟。可以使用封装的 tap 事件来代替 click 事件。 tap 事件由 touchstart 事件 + touchmove 判断 + touchend 事件封装组成。</p>
<h4 id="滑动穿透"><a href="#滑动穿透" class="headerlink" title="滑动穿透"></a>滑动穿透</h4><p>移动端浏览器里出现弹窗时，若在屏幕上滑动能触发弹窗底下的内容跟着滚动。<br>首先明确解决滑动穿透需保持哪些交互行为，那就是除了弹窗内容能点击或滚动，其他内容都不能点击或滚动。<br>当打开弹窗时给<body>声明<code>position:fixed;left:0;width:100%</code>并动态声明 top。声明 position:fixed 会导致<body>滚动条消失，此时会发现虽然无滑动穿透，但页面滚动位置早已丢失。通过 scrollingElement 获取页面当前滚动条偏移量并将其取负值且赋值给 top，那么在视觉上就无任何变化。当关闭弹窗时移除<code>position:fixed;left:0;width:100%</code>和动态 top。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">body.static &#123; position: fixed; left: 0; width: 100%; &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> body = <span class="variable language_">document</span>.<span class="property">body</span>;</span><br><span class="line"><span class="keyword">const</span> openBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;open-btn&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> closeBtn = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;close-btn&quot;</span>);</span><br><span class="line">openBtn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">  <span class="keyword">const</span> scrollTop = <span class="variable language_">document</span>.<span class="property">scrollingElement</span>.<span class="property">scrollTop</span>;</span><br><span class="line">  body.<span class="property">classList</span>.<span class="title function_">add</span>(<span class="string">&quot;static&quot;</span>);</span><br><span class="line">  body.<span class="property">style</span>.<span class="property">top</span> = <span class="string">`-<span class="subst">$&#123;scrollTop&#125;</span>px`</span>;</span><br><span class="line">&#125;);</span><br><span class="line">closeBtn.<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  e.<span class="title function_">stopPropagation</span>();</span><br><span class="line">  body.<span class="property">classList</span>.<span class="title function_">remove</span>(<span class="string">&quot;static&quot;</span>);</span><br><span class="line">  body.<span class="property">style</span>.<span class="property">top</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="禁止滚动传播"><a href="#禁止滚动传播" class="headerlink" title="禁止滚动传播"></a>禁止滚动传播</h4><p>移动端浏览器当页面包含多个滚动区域时，滚完一个区域后若还存在滚动动量则会将这些剩余动量传播到下一个滚动区域，造成该区域也滚动起来。这种行为称为滚动传播。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.elem &#123; overscroll-behavior: contain; &#125;</span><br></pre></td></tr></table></figure>

<h4 id="禁止长按操作"><a href="#禁止长按操作" class="headerlink" title="禁止长按操作"></a>禁止长按操作</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;contextmenu&quot;</span>, <span class="keyword">function</span> (<span class="params">e</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`禁用长按菜单`</span>);</span><br><span class="line">  e.<span class="title function_">preventDefault</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* &#123; /* pointer-events: none; */ /* 微信浏览器还需附加该属性才有效 */</span><br><span class="line">user-select: none; /* 禁止长按选择文字 */ -webkit-touch-callout: none; &#125;</span><br></pre></td></tr></table></figure>

<h4 id="手势"><a href="#手势" class="headerlink" title="手势"></a>手势</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 多指</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;touchstart&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.<span class="property">touches</span>.<span class="property">length</span> &gt; <span class="number">1</span>) &#123;</span><br><span class="line">    event.<span class="title function_">preventDefault</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手势</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;gesturestart&quot;</span>, <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">  event.<span class="title function_">preventDefault</span>();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 连点</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lastTouchEnd = <span class="number">0</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(</span><br><span class="line">  <span class="string">&quot;touchend&quot;</span>,</span><br><span class="line">  <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>();</span><br><span class="line">    <span class="keyword">if</span> (now - lastTouchEnd &lt;= <span class="number">300</span>) &#123;</span><br><span class="line">      event.<span class="title function_">preventDefault</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    lastTouchEnd = now;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="literal">false</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4 id="IOS-兼容"><a href="#IOS-兼容" class="headerlink" title="IOS 兼容"></a>IOS 兼容</h4><p>fixed 的文本框焦点居中?<br>​</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 改变Safari状态栏样式，可选default/black/black-translucent，需在上述全屏模式下才有效 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;apple-mobile-web-app-status-bar-style&quot;</span> <span class="attr">content</span>=<span class="string">&quot;black&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 添加页面启动占位图 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span></span></span><br><span class="line"><span class="tag">  <span class="attr">rel</span>=<span class="string">&quot;apple-touch-startup-image&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">href</span>=<span class="string">&quot;pig.jpg&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">media</span>=<span class="string">&quot;(device-width: 375px)&quot;</span></span></span><br><span class="line"><span class="tag">/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 保存网站到桌面时添加图标 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon&quot;</span> <span class="attr">sizes</span>=<span class="string">&quot;76x76&quot;</span> <span class="attr">href</span>=<span class="string">&quot;pig.jpg&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 保存网站到桌面时添加图标且清除默认光泽 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;apple-touch-icon-precomposed&quot;</span> <span class="attr">href</span>=<span class="string">&quot;pig.jpg&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="其他浏览器"><a href="#其他浏览器" class="headerlink" title="其他浏览器"></a>其他浏览器</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 强制QQ浏览器竖屏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;x5-orientation&quot;</span> <span class="attr">content</span>=<span class="string">&quot;portrait&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 强制QQ浏览器全屏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;x5-fullscreen&quot;</span> <span class="attr">content</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 开启QQ浏览器应用模式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;x5-page-mode&quot;</span> <span class="attr">content</span>=<span class="string">&quot;app&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 强制UC浏览器竖屏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;screen-orientation&quot;</span> <span class="attr">content</span>=<span class="string">&quot;portrait&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 强制UC浏览器全屏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;full-screen&quot;</span> <span class="attr">content</span>=<span class="string">&quot;yes&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 开启UC浏览器应用模式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;browsermode&quot;</span> <span class="attr">content</span>=<span class="string">&quot;application&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 开启360浏览器极速模式 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;renderer&quot;</span> <span class="attr">content</span>=<span class="string">&quot;webkit&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="让-active-有效，让-hover-无效"><a href="#让-active-有效，让-hover-无效" class="headerlink" title="让:active 有效，让:hover 无效"></a>让:active 有效，让:hover 无效</h4><p>有些元素的:active 可能会无效，而元素的:hover 在点击后会一直处于点击状态，需点击其他位置才能解除点击状态。给<body>注册一个空的 touchstart 事件可将两种状态反转。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">ontouchstart</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h2><p>​</p>
<p>​</p>
<h2 id="开发模式"><a href="#开发模式" class="headerlink" title="开发模式"></a>开发模式</h2><p><img src="https://cdn.nlark.com/yuque/0/2021/webp/106384/1635143563846-ed76e704-4433-413f-9d43-f35f0856fd40.webp#clientId=uac05b13d-fffe-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ue0888fe3&margin=%5Bobject%20Object%5D&originHeight=397&originWidth=800&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u51068920-e270-414f-9b38-6a3057dfb64&title="></p>
<h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1635145364961-5993f1bc-ab41-4dc4-976a-575fb997925f.png#clientId=uac05b13d-fffe-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ub7db8a29&margin=%5Bobject%20Object%5D&originHeight=344&originWidth=539&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u99a6a7dd-a91e-4dd9-997c-5627e14511a&title="></h3><h3 id="Native"><a href="#Native" class="headerlink" title="Native"></a>Native</h3><p>使用原生程序编写出来的 App<br><strong>优点：</strong></p>
<ul>
<li>提供最佳用户体验，最优质的用户界面，流畅的交互</li>
<li>可以访问本地资源</li>
<li>可以调用移动硬件设备，比如摄像头、麦克风等</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>开发成本高。每种移动操作系统都需要独立的开发项目，针对不同平台提供不同体验；</li>
<li>发布新版本慢。下载是用户控制的，很多用户不愿意下载更新（比如说，版本发布到了 3.0，但还是有很多 1.0 的用户，你可能就得继续维护 1.0 版本的 API）</li>
<li>应用商店发布审核周期长。安卓平台大概要 1~3 天，而 iOS 平台需要的时间更长</li>
</ul>
<h3 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h3><p>运行基于浏览器<br><strong>优点：</strong></p>
<ul>
<li>不需要安装包，节约手机空间</li>
<li>整体量级轻，开发成本低</li>
<li>不需要用户进行手动更新，由应用开发者直接在后台更新，推送到用户面前的都是全新版本，更便于业务的开展</li>
<li>基于浏览器，可以跨平台使用</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>页面跳转费力，不稳定感更强。在网速受到限制时，很多时候出现卡顿或者卡死现象，交互效果受到限制</li>
<li>安全性相对较低，数据容易泄露或者被劫持</li>
</ul>
<p>​</p>
<h4 id="渐进式-Web-应用（Progressive-Web-Apps）"><a href="#渐进式-Web-应用（Progressive-Web-Apps）" class="headerlink" title="渐进式 Web 应用（Progressive Web Apps）"></a>渐进式 Web 应用（Progressive Web Apps）</h4><p>运用现代的 Web API 以及传统的渐进式增强策略来创建跨平台 Web 应用程序。可以通过 Web 技术编写出一个网页应用. 随后添加上 App Manifest 和 Service Worker 来实现 PWA 的安装和离线等功能。在移动端中，可以将页面作为 PWA 应用安装到设备上（苹果兼容性存在问题）。<br>​</p>
<p><strong>优点</strong></p>
<ul>
<li>可以将 app 的快捷方式放置到桌面上，全屏运行，与原生 app 无异</li>
<li>能够在各种网络环境下使用，包括网络差和断网条件下，不会显示 undefind</li>
<li>推送消息的能力</li>
<li>其本质是一个网页，没有原生 app 的各种启动条件，快速响应用户指令</li>
</ul>
<p>​</p>
<p><strong>缺点</strong></p>
<ul>
<li>支持率不高:现在 ios 手机端不支持 pwa，IE 也暂时不支持</li>
<li>Chrome 在中国桌面版占有率还是不错的，安卓移动端上的占有率却很低</li>
<li>各大厂商还未明确支持 pwa</li>
<li>依赖的 GCM 服务在国内无法使用</li>
<li>微信小程序的竞争</li>
</ul>
<p>​</p>
<h3 id="Hybrid"><a href="#Hybrid" class="headerlink" title="Hybrid"></a>Hybrid</h3><p>native 和 web 的混合，比如在 native app 中内置浏览器，合适的功能页面采用网页的形式呈现。比如一些营销页面等改动频繁的页面。</p>
<ul>
<li>无需更新 app 也能实现内容的更新。</li>
<li>在应用内部打开 Web 网页，省去了跳转浏览器的麻烦。</li>
<li>主要功能区相对稳定下，增加的功能区采用 Web 形式，使得迭代更加方便。</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1635145408258-ddf12a44-0079-4f35-a3ec-d470355289f8.png#clientId=uac05b13d-fffe-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u6ec63bf7&margin=%5Bobject%20Object%5D&originHeight=220&originWidth=490&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&status=done&style=none&taskId=u3e1604ed-0535-4499-9f3b-4b913861836&title="><br>Hybrid App 按网页语言与程序语言的混合，通常分为三种类型：多 View 混合型，单 View 混合型，Web 主体型。</p>
<h4 id="多-View-混合型"><a href="#多-View-混合型" class="headerlink" title="多 View 混合型"></a>多 View 混合型</h4><p>即 Native View 和 Web View 独立展示，交替出现。2012 年常见的 Hybrid App 是 Native View 与 WebView 交替的场景出现。这种应用混合逻辑相对简单。即在需要的时候，将 WebView 当成一个独立的 View（Activity）运行起来，在 WebView 内完成相关的展示操作。这种移动应用主体通常是 Native App，Web 技术只是起到补充作用。开发难度和 Native App 基本相当。<br>​</p>
<h4 id="单-View-混合型"><a href="#单-View-混合型" class="headerlink" title="单 View 混合型"></a>单 View 混合型</h4><p>即在同一个 View 内，同时包括 Native View 和 Web View。互相之间是覆盖（层叠）的关系。这种 Hybrid App 的开发成本较高，开发难度较大，但是体验较好。如百度搜索为代表的单 View 混合型移动应用，既可以实现充分的灵活性，又能实现较好的用户体验。<br>​</p>
<h4 id="Web-主体型"><a href="#Web-主体型" class="headerlink" title="Web 主体型"></a>Web 主体型</h4><p>即移动应用的主体是 Web View，主要以网页语言编写，穿插 Native 功能的 Hybrid App 开发类型。这种类型开发的移动应用体验相对而言存在缺陷，但整体开发难度大幅降低，并且基本可以实现跨平台。Web 主体型的移动应用用户体验的好坏，主要取决于底层中间件的交互与跨平台的能力。<br>​</p>
<h3 id="跨端开发"><a href="#跨端开发" class="headerlink" title="跨端开发"></a>跨端开发</h3><p><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1635146175843-2f4f676b-aebf-4869-b980-bbd204c26668.png#clientId=uac05b13d-fffe-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=ua9d15089&margin=%5Bobject%20Object%5D&name=image.png&originHeight=850&originWidth=1080&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=352770&status=done&style=none&taskId=u8ca98386-5150-4ba4-a64d-24587a55a4e&title=" alt="image.png"></p>
<h4 id="内嵌-Webview"><a href="#内嵌-Webview" class="headerlink" title="内嵌 Webview"></a>内嵌 Webview</h4><p>开发简单粗暴，在 APP 的 WebView 容器上我们能做更多的工作，例如通过容器来提供一些端内的能力，结合 Native 能力实现的并行数据加载，页面保活等等。但在移动平台上尤其是早期 WebView 的性能体验非常糟糕，差距主要来自于 Web 生态本身沉重的历史负担：</p>
<ul>
<li>W3C 标准作为开放技术标准，历史包袱多，逻辑复杂。</li>
<li>Web 标准在设计上不是 Design for Performance 的，导致很多地方难以进一步改善，例如 JS 执行和 Layout、渲染互斥无法并行，导致过长的 JS 执行任务会执行正常的渲染导致卡顿。</li>
<li>Web 的标准化在推进上也比较慢，新的能力可能要比较长的时间才能使用。</li>
</ul>
<h4 id="小程序"><a href="#小程序" class="headerlink" title="小程序"></a>小程序</h4><p>各家小程序出于商业上的考量主动在 Web 生态的基础上构造了相对封闭的生态。导致和 Web 生态格格不入。然而有多端小程序投放，或者同时投放小程序和 Web 端的场景难以接受使用。<br>由于小程序的端封闭且不受控，要解决小程序的跨端问题往往只能从研发框架层面出发。<br>​</p>
<h5 id="编译时方案"><a href="#编译时方案" class="headerlink" title="编译时方案"></a>编译时方案</h5><p>Taro，大致的原理可以解释为将 JSX 编译到小程序的 WXML/WXSS/JS 上，而这类框架的实现原理其实并非真的是一个 React 或者类 React 框架，而是把看起来像是 JSX 的模板通过静态编译的方式翻译成小程序自身的模板。<br>这样做的限制非常明显，那就是 JSX 是 JavaScript 的拓展语言（React Blog 写的是 is a syntax extension to JavaScript），而小程序所采用的 WXML 却是一个表达能力非常受限的模板语言，我们不可能完成从一个通用编程语言到模板语言的编译。<br>而静态编译类框架为了做到这一点，采取的方式就是限制开发者的写法，这也是为什么 taro 对 JSX 的写法做出了诸多限制。这一点直接导致了无穷尽的维护成本和严重受损的开发体验，而后 taro/next 也转向了运行时方案 + 静态编译优化的结合。<br>​</p>
<h5 id="运行时方案"><a href="#运行时方案" class="headerlink" title="运行时方案"></a>运行时方案</h5><p>remax，通过 React Reconciler（类似于 Rax Driver）我们可以让运行在小程序容器中的 React 不去直接操作 DOM，而是把操作的数据通过 setData 传递给小程序的 View 层映射到最后的界面上。<br>虽然 Remax、Rax 运行时、Taro Next 等几种方案不尽相同，但是思路大同小异，就是利用小程序模板一定程度上的动态化能力 + 类 React 框架的 VirtualDOM 来进行渲染。当然这种做法相对于小程序原生的渲染方式存在一定的性能损耗。<br>在部分场景下，这种损耗是值得的。这些运行时框架也都在陆续通过允许关掉编译产生的模板中的不用的属性、部分静态编译、虚拟列表等方式来改进性能。</p>
<h4 id="React-Native-Weex-类方案"><a href="#React-Native-Weex-类方案" class="headerlink" title="React-Native/Weex 类方案"></a>React-Native/Weex 类方案</h4><p>React-Native/Weex 这类方案通过尽可能的取长补短，通过结合 Web 的生态和 Native 的组件，让 JS 执行代码后用 Native 的组件进行渲染。<br>RN 就如下图中，把 JS 执行、布局（Yoga）和渲染（Native 组件）放在三个进程分开执行，避免了 JS 执行复杂任务时界面卡顿。通过抛弃 CSS 中的大量标准，只支持部分 flex 布局能力来减少布局和渲染的复杂度。<br><img src="https://cdn.nlark.com/yuque/0/2021/png/106384/1635146500942-9d88bb9c-4e44-4c0d-b588-0fe283ab5830.png#clientId=uac05b13d-fffe-4&crop=0&crop=0&crop=1&crop=1&from=paste&id=u23df4fd8&margin=%5Bobject%20Object%5D&name=image.png&originHeight=607&originWidth=880&originalType=url%E2%88%B6=1&rotation=0&showTitle=false&size=203277&status=done&style=none&taskId=ubc9ba243-0f4e-49d7-a317-70db89d3f30&title=" alt="image.png"><br>缺陷：</p>
<ul>
<li>iOS/Android 双端本身不一致的组件和布局机制，让双端一致性难以得到保障。</li>
<li>依赖于 Native 机制也让一些 CSS 属性实现起来比较困难，例如老大难的 z-index 问题。</li>
</ul>
<h4 id="Flutter"><a href="#Flutter" class="headerlink" title="Flutter"></a>Flutter</h4><p>Flutter 要解决的问题和上面的方案不同，完全不打算继续在 Web 生态上借力，从设计之初也并没有把 Web 生态考虑进去。相比于 RN 依赖 Native View 渲染，Flutter 则是自绘的组件，直接通过 Skia 绘制到屏幕上。<br>由于可以完全发挥 GPU 的能力，也不需要去 Native 绕一圈。Flutter 理论上能做到更好的性能和两端一致性，这一意味着理论上未来可能基于 Flutter 的 JS 动态化方案能够在样式上支持的比 WEEX 更好。<br>​</p>
<h3 id="项目"><a href="#项目" class="headerlink" title="项目"></a>项目</h3><p>考虑到部门没有专门 native 开发，PWA 技术还不够成熟（重力感应处理麻烦，deviceMotionEvent 是 HTML5 新增的事件），只能采取 Web 主体的 Hybrid 开发或者跨端开发。而 Flutter、Weex 方案存在学习成本，小程序方案上线受限于微信审核。最后采用双端套壳浏览器隐藏 UI 指定访问 WEB 的 SPA 应用。<br>​</p>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><p>缓存，Nginx 配置成不缓存 index.html<br>iOS 更新 15，我们忘记签名，导致不能使用<br>​</p>
<p>​</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/fngy123/article/details/48346705">https://blog.csdn.net/fngy123/article/details/48346705</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6959047144065990663">https://juejin.cn/post/6959047144065990663</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/2050/p/3877280.html">https://www.cnblogs.com/2050/p/3877280.html</a><br><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/Viewport_concepts">https://developer.mozilla.org/zh-CN/docs/Web/CSS/Viewport_concepts</a><br><a target="_blank" rel="noopener" href="https://github.com/amfe/article/issues/17">https://github.com/amfe/article/issues/17</a><br><a target="_blank" rel="noopener" href="https://www.w3cplus.com/css/vw-for-layout.html">https://www.w3cplus.com/css/vw-for-layout.html</a><br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000017784801">https://segmentfault.com/a/1190000017784801</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/49449089">https://zhuanlan.zhihu.com/p/49449089</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6921886428158754829">https://juejin.cn/post/6921886428158754829</a><br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/24bf070a4dcb">https://www.jianshu.com/p/24bf070a4dcb</a><br><a target="_blank" rel="noopener" href="http://www.woshipm.com/pd/321844.html">http://www.woshipm.com/pd/321844.html</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_37293612/article/details/56835694">https://blog.csdn.net/qq_37293612/article/details/56835694</a><br><a target="_blank" rel="noopener" href="https://developer.aliyun.com/article/778539">https://developer.aliyun.com/article/778539</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="CatcherInSky"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">CatcherInSky</p>
  <div class="site-description" itemprop="description">CatcherInSky的前端知识库</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/CatcherInSky" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;CatcherInSky" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhangchunxiang98@outlook.com" title="E-Mail → mailto:zhangchunxiang98@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">CatcherInSky</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
